<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-US">
<head>
<meta http-equiv="Content-type" content="text/html; charset=utf-8">
<title>Using Enterprise JavaBeans Technology - Sun GlassFish Enterprise Server v3 Prelude Developer's Guide</title>
<meta name="robots" content="index,follow">
<meta name="robots" content="index,follow">
<meta name="date" content="2008-10-01">
</head>

<body>


<table border="0" cellpadding="5" cellspacing="0" width="100%">
<tr><td colspan="5"></td></tr>
<tr>
<td></td>
<td style="width: 60%">&#160;</td>
<td><a href="p12.html">Previous</a></td>
<td></td>
<td><a href="idx-1.html">Index</a></td>
<td><a href="p14.html">Next</a></td>
</tr>
</table>


<a name="beahl"></a>Chapter&#160;8<h3>Using Enterprise JavaBeans Technology</h3><p>This chapter describes how Enterprise JavaBeans<sup>TM</sup> (EJB<sup>TM</sup>) technology is supported in the
Sun GlassFish Enterprise Server. This chapter addresses the following topics:</p>
<ul><li><p><a href="#beahm">Summary of EJB 3.1 Changes</a></p></li>
<li><p><a href="#beahn">Value Added Features</a></p></li>
<li><p><a href="#beahw">EJB Timer Service</a></p></li>
<li><p><a href="#beahx">Using Session Beans</a></p></li>
<li><p><a href="#beaje">Handling Transactions With Enterprise Beans</a></p></li></ul>
<p>For general information about enterprise beans, see &#8220;Part Three: Enterprise Beans&#8221; in the
<a href="http://java.sun.com/javaee/5/docs/tutorial/doc/index.html">Java EE 5 Tutorial</a>.</p>
<hr><p><b>Note - </b>For GlassFish v3 Prelude, EJB modules are not supported unless the optional EJB
container add-on component is downloaded from the Update Tool. For information about the
Update Tool, see the <a href="http://docs.sun.com/doc/820-5968"><i>Sun GlassFish Enterprise Server v3 Prelude Installation Guide</i></a>.</p><p>For GlassFish v3 Prelude, only stateless session beans with local interfaces and entity beans
that use the Java Persistence API are supported. Stateful, message-driven, and EJB 2.0
and 2.1 entity beans are not supported. Remote interfaces and remote business interfaces
for any of the bean types are not supported.</p>
<hr>


<a name="beahm"></a><h3>Summary of EJB 3.1 Changes</h3>
<p><a name="indexterm-316"></a><a name="indexterm-317"></a><a name="indexterm-318"></a>The Enterprise Server supports and is compliant with the Sun Microsystems Enterprise JavaBeans
(EJB) architecture as defined by the Enterprise JavaBeans Specification, v3.1, also known as
<a href="http://jcp.org/en/jsr/detail?id=318">JSR 318</a>.</p><p>The main changes in the Enterprise JavaBeans Specification, v3.1 that impact enterprise beans
in the Enterprise Server environment are as follows:</p>
<ul><li><p>An EJB component need not implement any interface as long as it contains one of the component defining annotations or the XML equivalent. Essentially, the local business interface is optional. For example, the following is a simple no-interface bean:</p><pre>@Stateless
public class HelloBean {
   public String sayHello(String msg) {
      return "Hello " + msg;
   }
}</pre><p>Even though the bean doesn't implement any interface, the client can still inject (or look up) a reference to the session bean. The client still has to perform a JNDI lookup or inject a reference of the bean. More specifically, it <b>cannot</b> use the new operator to construct the bean.</p><pre>@EJB HelloBean h;
...
h.sayHello("bob");</pre></li>
<li><p>EJB classes can be packaged inside WAR files. These classes must reside under <tt>WEB-INF/classes</tt>. For example, the structure of a <tt>hello.war</tt> file might look like this:</p><pre>index.jsp
META-INF/
   MANIFEST.MF
WEB-INF/
   web.xml
   classes/
      com/
         sun/
            v3/
               demo/
                  HelloEJB.class
                  HelloServlet.class</pre><p>For more information about web applications, see <a href="p12.html">Chapter&#160;7, Developing Web Applications</a>.</p></li></ul>


<a name="beahn"></a><h3>Value Added Features</h3>
<a name="indexterm-319"></a><p>The Enterprise Server provides a number of value additions that relate to EJB
development. These capabilities are discussed in the following sections. References to more in-depth
material are included.</p>
<ul><li><p><a href="#beaht">Bean-Level Container-Managed Transaction Timeouts</a></p></li></ul>


<a name="beaht"></a><h4>Bean-Level Container-Managed Transaction Timeouts</h4>
<p>The default <a name="indexterm-320"></a>transaction timeout for the domain is specified using the Transaction Timeout
setting of the Transaction Service. A transaction started by the container must commit
(or rollback) within this time, regardless of whether the transaction is suspended (and resumed),
or the transaction is marked for rollback.</p><p>To override this timeout for an individual bean, use the optional <tt>cmt-timeout-in-seconds</tt>
element in <tt>sun-ejb-jar.xml</tt>. The default value, <tt>0</tt>, specifies that the default Transaction Service timeout
is used. The value of <tt>cmt-timeout-in-seconds</tt> is used for all methods in
the bean that start a new container-managed transaction. This value is <b>not</b> used
if the bean joins a client transaction.</p>

<a name="beahw"></a><h3>EJB Timer Service</h3>
<a name="indexterm-321"></a><p>The EJB Timer Service uses a database to store persistent information about EJB
timers. </p><p>The EJB Timer Service in Enterprise Server is preconfigured to use an embedded
version of the Java DB database.</p>
<hr><p><b>Note - </b>If the optional JTS add-on component has not been downloaded from the Update
Tool, you must reconfigure the JDBC resource named <tt>jdbc/__TimerPool</tt>. If the optional JTS add-on
component has been downloaded, this is not necessary. For information about the Update
Tool, see the <a href="http://docs.sun.com/doc/820-5968"><i>Sun GlassFish Enterprise Server v3 Prelude Installation Guide</i></a>.</p><p>In the Administration Console, open the Resources component and select JDBC Resources. For details,
click the Help button in the Administration Console. Change the connection pool name
for the JDBC resource named <tt>jdbc/__TimerPool</tt> to point to the same connection
pool as the one you are using for the rest of your data.
Then start the database.</p>
<hr>
<p>To enable the timer service, deploy the following application:</p><pre><i>as-install</i><tt>/lib/install/applications/ejb-timer-service-app.war</tt></pre><p>You can verify that it was deployed successfully by accessing the following URL:</p><pre><tt>http://localhost:8080/ejb-timer-service-app/timer</tt></pre><p>The EJB Timer Service configuration can store persistent timer information in any database
supported by the Enterprise Server for persistence. For a list of the JDBC
drivers currently supported by the Enterprise Server, see the <i><a href="http://docs.sun.com/doc/820-4494"><i>Sun GlassFish Enterprise Server v3 Prelude Release Notes</i></a></i>. For configurations of supported
and other drivers, see <a href="http://docs.sun.com/doc/820-4495/beamw?a=view">Configuration Specifics for JDBC Drivers in <i>Sun GlassFish Enterprise Server v3 Prelude Administration Guide</i></a>.</p><p>To change the database used by the EJB Timer Service, set the EJB
Timer Service&#8217;s Timer DataSource setting to a valid JDBC resource. You must also
create the timer database table. DDL files are located in <i>as-install</i><tt>/lib/install/databases</tt>. </p><p>Using the EJB Timer Service is equivalent to interacting with a single JDBC
resource manager. If an EJB component or application accesses a database either directly
through JDBC or indirectly (for example, through an entity bean&#8217;s persistence mechanism), and also
interacts with the EJB Timer Service, its data source must be configured with
an XA JDBC driver.</p><p>You can change the following EJB Timer Service settings. You must restart the
server for the changes to take effect.</p>
<ul><li><p>Minimum Delivery Interval - Specifies the minimum time in milliseconds before an expiration for a particular timer can occur. This guards against extremely small timer increments that can overload the server. The default is <tt>7000</tt>.</p></li>
<li><p>Maximum Redeliveries - Specifies the maximum number of times the EJB timer service attempts to redeliver a timer expiration due for exception or rollback. The default is <tt>1</tt>.</p></li>
<li><p>Redelivery Interval - Specifies how long in milliseconds the EJB timer service waits after a failed <tt>ejbTimeout</tt> delivery before attempting a redelivery. The default is <tt>5000</tt>.</p></li></ul>


<a name="beahx"></a><h3>Using Session Beans</h3>
<p>This section provides guidelines for creating <a name="indexterm-322"></a>session beans in the Enterprise Server
environment. This section addresses the following topics:</p>
<ul><li><p><a href="#beahy">About the Session Bean Containers</a></p></li>
<li><p><a href="#beaii">Session Bean Restrictions and Optimizations</a></p></li></ul>
<p>Information on session beans is contained in the Enterprise JavaBeans Specification, v3.1.</p>

<a name="beahy"></a><h4>About the Session Bean Containers</h4>
<a name="indexterm-323"></a><p>Like an entity bean, a session bean can access a database through Java
Database Connectivity (JDBC) calls. A session bean can also provide transaction settings. These
transaction settings and JDBC calls are referenced by the session bean&#8217;s container, allowing
it to participate in transactions managed by the container.</p>

<a name="beahz"></a><h5>Stateless Container</h5>
<a name="indexterm-324"></a><p>The <b>stateless container</b> manages stateless session beans, which, by definition, do not carry client-specific states.
All session beans (of a particular type) are considered equal.</p><p><a name="indexterm-325"></a>A stateless session bean container uses a bean pool to service requests. The
Enterprise Server specific deployment descriptor file, <tt>sun-ejb-jar.xml</tt>, contains the properties that define the pool:</p>
<ul><li><p><tt>steady-pool-size</tt></p></li>
<li><p><tt>resize-quantity</tt></p></li>
<li><p><tt>max-pool-size</tt></p></li>
<li><p><tt>pool-idle-timeout-in-seconds</tt></p></li></ul>
<p>For more information about <tt>sun-ejb-jar.xml</tt>, see <a href="http://docs.sun.com/doc/820-4502/beaqm?a=view">The sun-ejb-jar.xml File in <i>Sun GlassFish Enterprise Server v3 Prelude Application Deployment Guide</i></a>.</p><p>The Enterprise Server provides the <tt>wscompile</tt> and <tt>wsdeploy</tt> tools to help you
implement a web service endpoint as a stateless session bean. For more information
about these tools, see the <i><a href="http://docs.sun.com/doc/820-4497"><i>Sun GlassFish Enterprise Server v3 Prelude Reference Manual</i></a></i>.</p>

<a name="beaii"></a><h4>Session Bean Restrictions and Optimizations</h4>
<p>This section discusses restrictions on developing session beans and provides some optimization guidelines.</p>

<a name="beaik"></a><h5>Restricting Transactions</h5>
<a name="indexterm-326"></a><p>The following restrictions on transactions are enforced by the container and must be
observed as session beans are developed:</p>
<ul><li><p>A session bean can participate in, at most, a single transaction at a time.</p></li>
<li><p>If a session bean is participating in a transaction, a client cannot invoke a method on the bean such that the <tt>trans-attribute</tt> element (or <tt>@TransactionAttribute</tt> annotation) in the <tt>ejb-jar.xml</tt> file would cause the container to execute the method in a different or unspecified transaction context or an exception is thrown.</p></li>
<li><p>If a session bean instance is participating in a transaction, a client cannot invoke the <tt>remove</tt> method on the session object&#8217;s home or business interface object, or an exception is thrown.</p></li></ul>


<a name="beaje"></a><h3>Handling Transactions With Enterprise Beans</h3>
<a name="indexterm-327"></a><p>This section describes the transaction support built into the Enterprise JavaBeans programming model
for the Enterprise Server.</p><p>As a developer, you can write an application that updates data in multiple
databases distributed across multiple sites. The site might use EJB servers from different
vendors. This section provides overview information on the following topics:</p>
<ul><li><p><a href="#beajf">Flat Transactions</a></p></li>
<li><p><a href="#beajg">Global and Local Transactions</a></p></li>
<li><p><a href="#beaji">Administration and Monitoring</a></p></li></ul>

<hr><p><b>Note - </b>For GlassFish v3 Prelude, global (XA) transactions are not supported unless the optional
JTS add-on component is downloaded from the Update Tool. Without the JTS add-on component,
only local transactions are supported. For information about the Update Tool, see the
<a href="http://docs.sun.com/doc/820-5968"><i>Sun GlassFish Enterprise Server v3 Prelude Installation Guide</i></a>.</p>
<hr>


<a name="beajf"></a><h4>Flat Transactions</h4>
<a name="indexterm-328"></a><a name="indexterm-329"></a><a name="indexterm-330"></a><a name="indexterm-331"></a><p>The Enterprise JavaBeans Specification, v3.0 requires support for flat (as opposed to nested)
transactions. In a flat transaction, each transaction is decoupled from and independent of
other transactions in the system. Another transaction cannot start in the same thread until
the current transaction ends.</p><p>Flat transactions are the most prevalent model and are supported by most commercial
database systems. Although nested transactions offer a finer granularity of control over transactions,
they are supported by far fewer commercial database systems.</p>

<a name="beajg"></a><h4>Global and Local Transactions</h4>
<a name="indexterm-332"></a><a name="indexterm-333"></a><p>Understanding the distinction between global and local transactions is crucial in understanding the
Enterprise Server support for transactions. See <a href="p16.html#beano">Transaction Scope</a>.</p><p>Both local and global transactions are demarcated using the <tt>javax.transaction.UserTransaction</tt> interface, which
the client must use. Local transactions bypass the transaction manager and are faster. For
more information, see <a href="p16.html#gaxit">The Transaction Manager, the Transaction Synchronization Registry, and <tt>UserTransaction</tt></a>.</p>

<a name="beaji"></a><h4>Administration and Monitoring</h4>
<a name="indexterm-334"></a><p>An administrator can control a number of domain-level Transaction Service settings. For details,
see <a href="p16.html#beanp">Configuring the Transaction Service</a>.</p><p>The Transaction Timeout setting can be overridden by a bean. See <a href="#beaht">Bean-Level Container-Managed Transaction Timeouts</a>.</p><p>In addition, the administrator can monitor transactions using statistics from the transaction manager
that provide information on such activities as the number of transactions completed, rolled
back, or recovered since server startup, and transactions presently being processed.</p>


<table border="0" cellpadding="5" cellspacing="0" width="100%">
<tr valign="bottom">
<td></td>
<td style="width: 60%"></td>
<td><a href="p12.html">Previous</a></td>
<td></td>
<td><a href="idx-1.html">Index</a></td>
<td><a href="p14.html">Next</a></td>
</tr>
</table>



</body>
</html>

