<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-US">
<head>
<meta http-equiv="Content-type" content="text/html; charset=utf-8">
<title>Using the Java Naming and Directory Interface - Sun GlassFish Enterprise Server v3 Prelude Developer's Guide</title>
<meta name="robots" content="index,follow">
<meta name="robots" content="index,follow">
<meta name="date" content="2008-10-01">
</head>

<body>


<table border="0" cellpadding="5" cellspacing="0" width="100%">
<tr><td colspan="5"></td></tr>
<tr>
<td></td>
<td style="width: 60%">&#160;</td>
<td><a href="p16.html">Previous</a></td>
<td></td>
<td><a href="idx-1.html">Index</a></td>
<td><a href="idx-1.html">Next</a></td>
</tr>
</table>


<a name="beanr"></a>Chapter&#160;11<h3>Using the Java Naming and Directory Interface</h3><a name="indexterm-399"></a><a name="indexterm-400"></a><a name="indexterm-401"></a><p>A <b>naming service</b> maintains a set of bindings, which relate names to objects. The
Java EE naming service is based on the Java Naming and Directory Interface<sup>TM</sup> (JNDI) API. The JNDI API
allows application components and clients to look up distributed resources, services, and EJB
components. For general information about the JNDI API, see <a href="http://java.sun.com/products/jndi/">http://java.sun.com/products/jndi/</a>.</p><p><a name="indexterm-402"></a>You can also see the JNDI tutorial at <a href="http://java.sun.com/products/jndi/tutorial/">http://java.sun.com/products/jndi/tutorial/</a>.</p><p>This chapter contains the following sections:</p>
<ul><li><p><a href="#beans">Accessing the Naming Context</a></p></li>
<li><p><a href="#beaoa">Mapping References</a></p></li></ul>

<hr><p><b>Note - </b>For GlassFish v3 Prelude, EJB modules are not supported unless the optional EJB
container add-on component is downloaded from the Update Tool. For information about the Update
Tool, see the <a href="http://docs.sun.com/doc/820-5968"><i>Sun GlassFish Enterprise Server v3 Prelude Installation Guide</i></a>.</p><p>For GlassFish v3 Prelude, only stateless session beans with local interfaces and entity
beans that use the Java Persistence API are supported. Stateful, message-driven, and EJB 2.0
and 2.1 entity beans are not supported. Remote interfaces and remote business interfaces
for any of the bean types are not supported.</p>
<hr>


<a name="beans"></a><h3>Accessing the Naming Context</h3>
<a name="indexterm-403"></a><a name="indexterm-404"></a><p>The Enterprise Server provides a naming environment, or <b>context</b>, which is compliant
with standard Java EE requirements. A <tt>Context</tt> object provides the methods for binding names
to objects, unbinding names from objects, renaming objects, and listing the bindings. The
<tt>InitialContext</tt> is the handle to the Java EE naming service that application components and
clients use for lookups.</p><p>The JNDI API also provides subcontext functionality. Much like a directory in a
file system, a subcontext is a context within a context. This hierarchical structure
permits better organization of information. For naming services that support subcontexts, the <tt>Context</tt>
class also provides methods for creating and destroying subcontexts.</p>
<hr><p><b>Note - </b>Each resource within the server must have a unique name.</p>
<hr>


<a name="gcjkd"></a><h4>Global JNDI Names</h4>
<a name="indexterm-405"></a><p>Global JNDI names are assigned according to the following precedence rules:</p>
<ol><li><p>A global JNDI name assigned in the <tt>sun-ejb-jar.xml</tt>, <tt>sun-web.xml</tt> deployment descriptor file has the highest precedence. See <a href="#beaoa">Mapping References</a>.</p></li>
<li><p>A global JNDI name assigned in a <tt>mapped-name</tt> element in the <tt>ejb-jar.xml</tt>, <tt>web.xml</tt> deployment descriptor file has the second highest precedence. The following elements have <tt>mapped-name</tt> subelements: <tt>resource-ref</tt>, <tt>resource-env-ref</tt>, <tt>ejb-ref</tt>, <tt>message-destination</tt>, <tt>message-destination-ref</tt>, <tt>session</tt>, and <tt>entity</tt>.</p></li>
<li><p><a name="indexterm-406"></a>A global JNDI name assigned in a <tt>mappedName</tt> attribute of an annotation has the third highest precedence. The following annotations have <tt>mappedName</tt> attributes: <tt>@javax.annotation.Resource</tt>, <tt>@javax.ejb.EJB</tt>, <tt>@javax.ejb.Stateless</tt>.</p></li>
<li><p>A default global JNDI name is assigned in some cases if no name is assigned in deployment descriptors or annotations.</p>
<ul><li><p>For component dependencies that must be mapped to global JNDI names, the default is the name of the dependency relative to <tt>java:comp/env</tt>. For example, in the <tt>@Resource(name="jdbc/Foo") DataSource ds;</tt> annotation, the global JNDI name is <tt>jdbc/Foo</tt>.</p></li></ul>
</li></ol>


<a name="gcpge"></a><h3>Using a Custom <tt>jndi.properties</tt> File</h3>
<p>To use a custom <tt>jndi.properties</tt> file, place the file in the <i>domain-dir</i><tt>/lib/classes</tt> directory or
JAR it and place it in the <i>domain-dir</i><tt>/lib</tt> directory. This adds the custom
<tt>jndi.properties</tt> file to the Common class loader. For more information about class loading,
see <a href="p6.html">Chapter&#160;2, Class Loaders</a>.</p><p>For each property found in more than one <tt>jndi.properties</tt> file, the Java EE
naming service either uses the first value found or concatenates all of the
values, whichever makes sense.</p>

<a name="beaoa"></a><h3>Mapping References</h3>
<a name="indexterm-407"></a><a name="indexterm-408"></a><a name="indexterm-409"></a><p>The following XML elements in the Enterprise Server deployment descriptors map resource references
in EJB and web application components to JNDI names configured in the Enterprise Server:</p>
<ul><li><p><a name="indexterm-410"></a><tt>resource-env-ref</tt> - Maps the <tt>@Resource</tt> or <tt>@Resources</tt> annotation (or the <tt>resource-env-ref</tt> element in the corresponding Java EE XML file) to the absolute JNDI name configured in the Enterprise Server.</p></li>
<li><p><a name="indexterm-411"></a><tt>resource-ref</tt> - Maps the <tt>@Resource</tt> or <tt>@Resources</tt> annotation (or the <tt>resource-ref</tt> element in the corresponding Java EE XML file) to the absolute JNDI name configured in the Enterprise Server.</p></li>
<li><p><a name="indexterm-412"></a><tt>ejb-ref</tt> - Maps the <tt>@EJB</tt> annotation (or the <tt>ejb-ref</tt> element in the corresponding Java EE XML file) to the absolute JNDI name configured in the Enterprise Server.</p><p><a name="indexterm-413"></a>JNDI names for EJB components must be unique. For example, appending the application name and the module name to the EJB name is one way to guarantee unique names. In this case, <tt>mycompany.pkging.pkgingEJB.MyEJB</tt> would be the JNDI name for an EJB in the module <tt>pkgingEJB.jar</tt>, which is packaged in the <tt>pkging.ear</tt> application.</p></li></ul>
<p><a name="indexterm-414"></a>These elements are part of the <tt>sun-web.xml</tt> and <tt>sun-ejb-ref.xml</tt> deployment descriptor files. For
more information about how these elements behave in each of the deployment descriptor
files, see <a href="http://docs.sun.com/doc/820-4502/beaqi?a=view">Appendix A, <i>Deployment Descriptor Files,</i> in <i>Sun GlassFish Enterprise Server v3 Prelude Application Deployment Guide</i></a>.</p><p>The rest of this section uses an example of a JDBC resource lookup
to describe how to reference resource factories.</p><p>The <tt>@Resource</tt> annotation in the application code looks like this:</p><pre>@Resource(name="jdbc/helloDbDs") javax.sql.DataSource ds;</pre><p>This references a resource with the JNDI name of <tt>java:comp/env/jdbc/helloDbDs</tt>. If this
is the JNDI name of the JDBC resource configured in the Enterprise Server,
the annotation alone is enough to reference the resource.</p><p>However, you can use an Enterprise Server specific deployment descriptor to override the
annotation. For example, the <tt>resource-ref</tt> element in the <tt>sun-web.xml</tt> file maps the <tt>res-ref-name</tt>
(the name specified in the annotation) to the JNDI name of another JDBC
resource configured in the Enterprise Server.</p><pre>&#60;resource-ref>
   &#60;res-ref-name>jdbc/helloDbDs&#60;/res-ref-name>
   &#60;jndi-name>jdbc/helloDbDataSource&#60;/jndi-name>
&#60;/resource-ref></pre>


<table border="0" cellpadding="5" cellspacing="0" width="100%">
<tr valign="bottom">
<td></td>
<td style="width: 60%"></td>
<td><a href="p16.html">Previous</a></td>
<td></td>
<td><a href="idx-1.html">Index</a></td>
<td><a href="idx-1.html">Next</a></td>
</tr>
</table>



</body>
</html>

