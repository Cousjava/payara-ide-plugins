<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-US">
<head>
<meta http-equiv="Content-type" content="text/html; charset=utf-8">
<title>Using the Transaction Service - Sun GlassFish Enterprise Server v3 Prelude Developer's Guide</title>
<meta name="robots" content="index,follow">
<meta name="robots" content="index,follow">
<meta name="date" content="2008-10-01">
</head>

<body>


<table border="0" cellpadding="5" cellspacing="0" width="100%">
<tr><td colspan="5"></td></tr>
<tr>
<td></td>
<td style="width: 60%">&#160;</td>
<td><a href="p15.html">Previous</a></td>
<td></td>
<td><a href="idx-1.html">Index</a></td>
<td><a href="p17.html">Next</a></td>
</tr>
</table>


<a name="beanm"></a>Chapter&#160;10<h3>Using the Transaction Service</h3><a name="indexterm-383"></a><a name="indexterm-384"></a><a name="indexterm-385"></a><a name="indexterm-386"></a><p>The Java EE platform provides several abstractions that simplify development of dependable transaction
processing for applications. This chapter discusses Java EE transactions and transaction support in the
Sun GlassFish Enterprise Server.</p><p>This chapter contains the following sections:</p>
<ul><li><p><a href="#beano">Transaction Scope</a></p></li>
<li><p><a href="#beanp">Configuring the Transaction Service</a></p></li>
<li><p><a href="#gaxit">The Transaction Manager, the Transaction Synchronization Registry, and <tt>UserTransaction</tt></a></p></li></ul>
<p>For more information about the Java<sup>TM</sup> Transaction API (JTA) and Java Transaction Service
(JTS), see the following sites: <a href="http://java.sun.com/products/jta/">http://java.sun.com/products/jta/</a> and <a href="http://java.sun.com/products/jts/">http://java.sun.com/products/jts/</a>.</p><p>You might also want to read &#8220;Chapter 35: Transactions&#8221; in the <a href="http://java.sun.com/javaee/5/docs/tutorial/doc/index.html">Java EE 5 Tutorial</a>.</p><p>For information about JDBC transaction isolation levels, see <a href="p15.html#beamv">Using JDBC Transaction Isolation Levels</a>.</p>
<hr><p><b>Note - </b>For GlassFish v3 Prelude, global (XA) transactions are not supported unless the optional JTS
add-on component, including the dependent Object Management Group (OMG) subcomponent, is downloaded from
the Update Tool. Without this add-on component, only local transactions are supported. For information
about the Update Tool, see the <a href="http://docs.sun.com/doc/820-5968"><i>Sun GlassFish Enterprise Server v3 Prelude Installation Guide</i></a>.</p><p>Transaction recovery is not implemented for GlassFish v3 Prelude, even if the JTS
and OMG add-on components are installed. Therefore, all transaction service attributes and properties pertaining
to transaction recovery or transaction logs are not implemented.</p>
<hr>


<a name="beano"></a><h3>Transaction Scope</h3>
<a name="indexterm-387"></a><a name="indexterm-388"></a><p>A <b>local</b> transaction involves only one non-XA resource and requires that all participating
application components execute within one process. Local transaction optimization is specific to the resource
manager and is transparent to the Java EE application.</p><p>In the Enterprise Server, a JDBC resource is non-XA if it meets any
of the following criteria:</p>
<ul><li><p>In the JDBC connection pool configuration, the DataSource class does not implement the <tt>javax.sql.XADataSource</tt> interface.</p></li>
<li><p>The Global Transaction Support box is not checked, or the Resource Type setting does not exist or is not set to <tt>javax.sql.XADataSource</tt>.</p></li></ul>
<p>A transaction remains local if the following conditions remain true:</p>
<ul><li><p>One and only one non-XA resource is used. If any additional non-XA resource is used, the transaction is aborted.</p></li>
<li><p>No transaction importing or exporting occurs.</p></li></ul>
<p><a name="indexterm-389"></a>Transactions that involve multiple resources are <b>global</b> transactions. A global transaction can involve
one non-XA resource if last agent optimization is enabled. Otherwise, all resourced must be
XA. The <tt>use-last-agent-optimization</tt> property is set to <tt>true</tt> by default. For details about
how to set this property, see <a href="#beanp">Configuring the Transaction Service</a>.</p>
<hr><p><b>Note - </b>For GlassFish v3 Prelude, transaction propagation between multiple participant processes, applications, or JVM machines
is not supported.</p>
<hr>
<p>If only one XA resource is used in a transaction, one-phase commit occurs,
otherwise the transaction is coordinated with a two-phase commit protocol.</p><p>A two-phase commit protocol between the transaction manager and all the resources enlisted
for a transaction ensures that either all the resource managers commit the transaction
or they all abort. When the application requests the commitment of a transaction,
the transaction manager issues a <tt>PREPARE_TO_COMMIT</tt> request to all the resource managers involved. Each
of these resources can in turn send a reply indicating whether it is
ready for commit (<tt>PREPARED</tt>) or not (<tt>NO</tt>). Only when all the resource managers
are ready for a commit does the transaction manager issue a commit request
(<tt>COMMIT</tt>) to all the resource managers. Otherwise, the transaction manager issues a rollback request
(<tt>ABORT</tt>) and the transaction is rolled back.</p>

<a name="beanp"></a><h3>Configuring the Transaction Service</h3>
<a name="indexterm-390"></a><p>You can configure the transaction service in the Enterprise Server in the following
ways:</p>
<ul><li><p><a name="indexterm-391"></a><a name="indexterm-392"></a>To configure the transaction service, use the <tt>asadmin set</tt> command to set the following attributes and properties.</p><pre>server-config.transaction-service.automatic-recovery = false
server-config.transaction-service.heuristic-decision = rollback
server-config.transaction-service.keypoint-interval = 2048
server-config.transaction-service.retry-timeout-in-seconds = 600
server-config.transaction-service.timeout-in-seconds = 0
server-config.transaction-service.tx-log-dir = <i>domain-dir</i>/logs
server-config.transaction-service.property.use-last-agent-optimization = true</pre><p><a name="indexterm-393"></a><a name="indexterm-394"></a>You can use the <tt>asadmin get</tt> command to list all the transaction service attributes and properties. For details, see the <a href="http://docs.sun.com/doc/820-4497"><i>Sun GlassFish Enterprise Server v3 Prelude Reference Manual</i></a>.</p></li></ul>
<p>Changing <tt>keypoint-interval</tt>, <tt>retry-timeout-in-seconds</tt>, or <tt>timeout-in-seconds</tt> does not require a server restart. Changing other
attributes or properties requires a server restart.</p><p>Transaction recovery is not implemented for GlassFish v3 Prelude, even if the JTS
and OMG add-on components are installed. Therefore, all transaction service attributes and properties pertaining
to transaction recovery or transaction logs are not implemented.</p>

<a name="gaxit"></a><h3>The Transaction Manager, the Transaction Synchronization Registry, and <tt>UserTransaction</tt></h3>
<a name="indexterm-395"></a><a name="indexterm-396"></a><a name="indexterm-397"></a><a name="indexterm-398"></a><p>To access a <tt>UserTransaction</tt> instance, you can either look it up using the
<tt>java:comp/UserTransaction</tt> JNDI name or inject it using the <tt>@Resource</tt> annotation.</p><p>If you need to access the <tt>javax.transaction.TransactionManager</tt> implementation, you can look up
the Enterprise Server implementation of this interface using the JNDI name <tt>java:appserver/TransactionManager</tt>. If
possible, you should use the <tt>javax.transaction.TransactionSynchronizationRegistry</tt> interface instead, for portability. You can
look up the implementation of this interface by using the JNDI name <tt>java:comp/TransactionSynchronizationRegistry</tt>.
For details, see the Javadoc page for <a href="http://java.sun.com/javaee/5/docs/api/javax/transaction/TransactionSynchronizationRegistry.html">Interface TransactionSynchronizationRegistry</a> and <a href="http://www.jcp.org/en/jsr/detail?id=907">Java Specification Request (JSR) 907</a>.</p>


<table border="0" cellpadding="5" cellspacing="0" width="100%">
<tr valign="bottom">
<td></td>
<td style="width: 60%"></td>
<td><a href="p15.html">Previous</a></td>
<td></td>
<td><a href="idx-1.html">Index</a></td>
<td><a href="p17.html">Next</a></td>
</tr>
</table>



</body>
</html>

