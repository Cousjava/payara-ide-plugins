<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-US">
<head>
<meta http-equiv="Content-type" content="text/html; charset=utf-8">
<title>Developing Web Applications - Sun GlassFish Enterprise Server v3 Prelude Developer's Guide</title>
<meta name="robots" content="index,follow">
<meta name="robots" content="index,follow">
<meta name="date" content="2008-10-01">
</head>

<body>


<table border="0" cellpadding="5" cellspacing="0" width="100%">
<tr><td colspan="5"></td></tr>
<tr>
<td></td>
<td style="width: 60%">&#160;</td>
<td><a href="p11.html">Previous</a></td>
<td></td>
<td><a href="idx-1.html">Index</a></td>
<td><a href="p13.html">Next</a></td>
</tr>
</table>


<a name="beafs"></a>Chapter&#160;7<h3>Developing Web Applications</h3><a name="indexterm-198"></a><p>This chapter describes how web applications are supported in the Sun GlassFish Enterprise
Server and includes the following sections:</p>
<ul><li><p><a href="#ggsxa">Packaging an EJB JAR File in a Web Application</a></p></li>
<li><p><a href="#beagj">Using Servlets</a></p></li>
<li><p><a href="#beagu">Using JavaServer Pages</a></p></li>
<li><p><a href="#beaha">Creating and Managing Sessions</a></p></li>
<li><p><a href="#ggrgt">Using Comet</a></p></li>
<li><p><a href="#ghfme">Developing Grails Applications</a></p></li>
<li><p><a href="#beaft">Advanced Web Application Features</a></p></li></ul>
<p>For general information about web applications, see &#8220;Part One: The Web Tier&#8221; in
the <a name="indexterm-199"></a><a href="http://java.sun.com/javaee/5/docs/tutorial/doc/index.html">Java EE 5 Tutorial</a>.</p>

<a name="ggsxa"></a><h3>Packaging an EJB JAR File in a Web Application</h3>
<p>The Enterprise Server supports the EJB 3.1 specification, which allows EJB JAR files
to be packaged in WAR files. EJB classes must reside under <tt>WEB-INF/classes</tt>. For
example, the structure of a <tt>hello.war</tt> file might look like this:</p><pre>index.jsp
META-INF/
   MANIFEST.MF
WEB-INF/
   web.xml
   classes/
      com/
         sun/
            v3/
               demo/
                  HelloEJB.class
                  HelloServlet.class</pre><p>For more information about EJB components, see <a href="p13.html">Chapter&#160;8, Using Enterprise JavaBeans Technology</a>.</p>
<hr><p><b>Note - </b>For GlassFish v3 Prelude, EJB modules are not supported unless the optional EJB
container add-on component is downloaded from the Update Tool. For information about the
Update Tool, see the <a href="http://docs.sun.com/doc/820-5968"><i>Sun GlassFish Enterprise Server v3 Prelude Installation Guide</i></a>.</p><p>For GlassFish v3 Prelude, only stateless session beans with local interfaces and entity
beans that use the Java Persistence API are supported. Stateful, message-driven, and EJB
2.0 and 2.1 entity beans are not supported. Remote interfaces and remote business
interfaces for any of the bean types are not supported.</p>
<hr>


<a name="beagj"></a><h3>Using Servlets</h3>
<a name="indexterm-200"></a><p>Enterprise Server supports the Java Servlet Specification version 2.5.</p>
<hr><p><b>Note - </b>Servlet API version 2.5 is fully backward compatible with versions 2.3 and 2.4,
so all existing servlets should work without modification or recompilation.</p>
<hr>
<p><a name="indexterm-201"></a><a name="indexterm-202"></a><a name="indexterm-203"></a>To develop servlets, use Sun Microsystems&#8217; Java Servlet API. For information about using
the Java Servlet API, see the documentation provided by Sun Microsystems at <a href="http://java.sun.com/products/servlet/index.html">http://java.sun.com/products/servlet/index.html</a>.</p><p>The Enterprise Server provides the <tt>wscompile</tt> and <tt>wsdeploy</tt> tools to help you
implement a web service endpoint as a servlet. For more information about these
tools, see the <i><a href="http://docs.sun.com/doc/820-4497"><i>Sun GlassFish Enterprise Server v3 Prelude Reference Manual</i></a></i>.</p><p>This section describes how to create effective servlets to control application interactions running
on an Enterprise Server, including standard-based servlets. In addition, this section describes the
Enterprise Server features to use to augment the standards.</p><p>This section contains the following topics:</p>
<ul><li><p><a href="#beagk">Invoking a Servlet With a URL</a></p></li>
<li><p><a href="#beagl">Servlet Output</a></p></li>
<li><p><a href="#beagm">Caching Servlet Results</a></p></li>
<li><p><a href="#beagr">About the Servlet Engine</a></p></li></ul>


<a name="beagk"></a><h4>Invoking a Servlet With a URL</h4>
<a name="indexterm-204"></a><p>You can call a servlet deployed to the Enterprise Server by using a
URL in a browser or embedded as a link in an HTML
or JSP file. The format of a servlet invocation URL is as follows:</p><pre>http://<i>server</i>:<i>port</i>/<i>context-root</i>/<i>servlet-mapping</i>?<i>name</i>=<i>value</i></pre><p>The following table describes each URL section.</p><a name="fvyhk"></a><h6>Table&#160;7-1 URL Fields for Servlets Within an Application</h6><table><col width="20%"><col width="79%"><tr><th align="left" valign="top" scope="column"><p>URL element</p></th>
<th align="left" valign="top" scope="column"><p>Description</p></th>
</tr>
<tr><td align="left" valign="top" scope="row"><p><i>server</i><tt>:</tt><i>port</i></p></td>
<td align="left" valign="top" scope="row"><p>The IP address (or host
name) and optional port number.</p><p>To access the <a name="indexterm-205"></a><a name="indexterm-206"></a>default web module for a virtual
server, specify only this URL section. You do not need to specify the
<i>context-root</i> or <b>servlet-name</b> unless you also wish to specify name-value parameters.</p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p><i>context-root</i></p></td>
<td align="left" valign="top" scope="row"><p>For an
application, the <a name="indexterm-207"></a>context root is defined in the <tt>context-root</tt> element of the <tt>application.xml</tt>,
<tt>sun-application.xml</tt>, or <tt>sun-web.xml</tt> file. For an individually deployed web module, the context root is
specified during deployment.</p><p>For both applications and individually deployed web modules, the default context root
is the name of the WAR file minus the <tt>.war</tt> suffix.</p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p><i>servlet-mapping</i></p></td>
<td align="left" valign="top" scope="row"><p>The <tt>servlet-mapping</tt> as
configured in the <tt>web.xml</tt> file.</p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p><tt>?</tt><i>name</i><tt>=</tt><i>value</i><tt>...</tt></p></td>
<td align="left" valign="top" scope="row"><p>Optional request parameters.</p></td>
</tr>
</table><p>In this example, <tt>localhost</tt> is the host name, <tt>MortPages</tt> is the context
root, and <tt>calcMortgage</tt> is the servlet mapping:</p><pre>http://localhost:8080/MortPages/calcMortgage?rate=8.0&#38;per=360&#38;bal=180000</pre><p>When invoking a servlet from within a JSP file, you can use a
relative path. For example:</p><pre>&#60;jsp:forward page="TestServlet"/>
&#60;jsp:include page="TestServlet"/></pre>

<a name="beagl"></a><h4>Servlet Output</h4>
<a name="indexterm-208"></a><a name="indexterm-209"></a><p><a name="indexterm-210"></a><tt>ServletContext.log</tt> messages are sent to the server log.</p><p>By default, the <tt>System.out</tt> and <tt>System.err</tt> output of servlets are sent to
the server log, and during startup, server log messages are echoed to the
<tt>System.err</tt> output. Also by default, there is no Windows-only console for the <tt>System.err</tt>
output.</p><p><a name="indexterm-211"></a>You can change these defaults using the Administration Console. Select the Enterprise Server component
and the Logging tab. Then check or uncheck Write to System Log. If
this box is checked, <tt>System.out</tt> output is sent to the server log. If
it is unchecked, <tt>System.out</tt> output is sent to the system default location only.</p><p>For more information, click the Help button in the Administration Console from the
Logging page.</p>

<a name="beagm"></a><h4>Caching Servlet Results</h4>
<a name="indexterm-212"></a><a name="indexterm-213"></a><p>The Enterprise Server can cache the results of invoking a servlet, a JSP,
or any URL pattern to make subsequent invocations of the same servlet, JSP,
or URL pattern faster. The Enterprise Server caches the request results for a
specific amount of time. In this way, if another data call occurs, the
Enterprise Server can return the cached data instead of performing the operation again.
For example, if your servlet returns a stock quote that updates every 5
minutes, you set the cache to expire after 300 seconds.</p><p>Whether to cache results and how to cache them depends on the data
involved. For example, it makes no sense to cache the results of a
quiz submission, because the input to the servlet is different each time. However,
it makes sense to cache a high level report showing demographic data taken
from quiz results that is updated once an hour.</p><p>To define how an Enterprise Server web application handles response caching, you edit
specific fields in the <tt>sun-web.xml</tt> file.</p>
<hr><p><b>Note - </b>A servlet that uses caching is not portable.</p>
<hr>
<p>For Javadoc tool pages relevant to caching servlet results, go to <a href="https://glassfish.dev.java.net/nonav/api/v3-prelude/index.html">https://glassfish.dev.java.net/nonav/api/v3-prelude/index.html</a> and
click on the <tt>com.sun.appserv.web.cache</tt> package.</p><p>The rest of this section covers the following topics:</p>
<ul><li><p><a href="#beagn">Caching Features</a></p></li>
<li><p><a href="#beago">Default Cache Configuration</a></p></li>
<li><p><a href="#beagp">Caching Example</a></p></li>
<li><p><a href="#beagq">The <tt>CacheKeyGenerator</tt> Interface</a></p></li></ul>


<a name="beagn"></a><h5>Caching Features</h5>
<p>The Enterprise Server has the following web application response caching capabilities:</p>
<ul><li><p>Caching is configurable based on the servlet name or the URI.</p></li>
<li><p>When caching is based on the URI, this includes user specified parameters in the query string. For example, a response from <tt>/garden/catalog?category=roses</tt> is different from a response from <tt>/garden/catalog?category=lilies</tt>. These responses are stored under different keys in the cache.</p></li>
<li><p>Cache size, entry timeout, and other caching behaviors are configurable.</p></li>
<li><p>Entry timeout is measured from the time an entry is created or refreshed. To override this timeout for an individual cache mapping, specify the <tt>cache-mapping</tt> subelement <tt>timeout</tt>.</p></li>
<li><p>To determine caching criteria programmatically, write a <a name="indexterm-214"></a>class that implements the <tt>com.sun.appserv.web.cache.CacheHelper</tt> interface. For example, if only a servlet knows when a back end data source was last modified, you can write a helper class to retrieve the last modified timestamp from the data source and decide whether to cache the response based on that timestamp.</p></li>
<li><p>To determine cache key generation programmatically, write a class that implements the <tt>com.sun.appserv.web.cache.CacheKeyGenerator</tt> interface. See <a href="#beagq">The <tt>CacheKeyGenerator</tt> Interface</a>.</p></li>
<li><p>All non-ASCII request parameter values specified in cache key elements must be URL encoded. The caching subsystem attempts to match the raw parameter values in the request query string.</p></li>
<li><p>The following <a name="indexterm-215"></a><tt>HttpServletRequest</tt> request attributes are exposed.</p>
<ul><li><p><tt>com.sun.appserv.web.cachedServletName</tt>, the cached servlet target</p></li>
<li><p><tt>com.sun.appserv.web.cachedURLPattern</tt>, the URL pattern being cached</p></li></ul>
</li>
<li><p>Results produced by resources that are the target of a <tt>RequestDispatcher.include()</tt> or <tt>RequestDispatcher.forward()</tt> call are cached if caching has been enabled for those resources. For details, see <a href="http://docs.sun.com/doc/820-4502/bearh?a=view">cache-mapping in <i>Sun GlassFish Enterprise Server v3 Prelude Application Deployment Guide</i></a> and <a href="http://docs.sun.com/doc/820-4502/beasp?a=view">dispatcher in <i>Sun GlassFish Enterprise Server v3 Prelude Application Deployment Guide</i></a>. These are elements in the <tt>sun-web.xml</tt> file.</p></li></ul>


<a name="beago"></a><h5>Default Cache Configuration</h5>
<p>If you enable <a name="indexterm-216"></a>caching but do not provide any special configuration for a
servlet or JSP, the default cache configuration is as follows:</p>
<ul><li><p>The default cache timeout is 30 seconds.</p></li>
<li><p>Only the HTTP GET method is eligible for caching.</p></li>
<li><p>HTTP requests with cookies or sessions automatically disable caching.</p></li>
<li><p>No special consideration is given to <tt>Pragma:</tt>, <tt>Cache-control:</tt>, or <tt>Vary:</tt> headers.</p></li>
<li><p>The default key consists of the Servlet Path (minus <tt>pathInfo</tt> and the query string).</p></li>
<li><p>A &#8220;least recently used&#8221; list is maintained to evict cache entries if the maximum cache size is exceeded.</p></li>
<li><p>Key generation concatenates the servlet path with key field values, if any are specified.</p></li>
<li><p>Results produced by resources that are the target of a <tt>RequestDispatcher.include()</tt> or <tt>RequestDispatcher.forward()</tt> call are never cached.</p></li></ul>


<a name="beagp"></a><h5>Caching Example</h5>
<p>Here is an example <a name="indexterm-217"></a>cache element in the <tt>sun-web.xml</tt> file:</p><pre>&#60;cache max-capacity="8192" timeout="60">
&#60;cache-helper name="myHelper" class-name="MyCacheHelper"/>
&#60;cache-mapping>
    &#60;servlet-name>myservlet&#60;/servlet-name>
    &#60;timeout name="timefield">120&#60;/timeout>
    &#60;http-method>GET&#60;/http-method>
    &#60;http-method>POST&#60;/http-method>
&#60;/cache-mapping>
&#60;cache-mapping>
    &#60;url-pattern> /catalog/* &#60;/url-pattern>
    &#60;!-- cache the best selling category; cache the responses to
       -- this resource only when the given parameters exist. Cache
       -- only when the catalog parameter has 'lilies' or 'roses'
       -- but no other catalog varieties:
      -- /orchard/catalog?best&#38;category='lilies'
      -- /orchard/catalog?best&#38;category='roses'
      -- but not the result of
       -- /orchard/catalog?best&#38;category='wild'
    -->
    &#60;constraint-field name='best' scope='request.parameter'/>
    &#60;constraint-field name='category' scope='request.parameter'>
        &#60;value> roses &#60;/value>
        &#60;value> lilies &#60;/value>
    &#60;/constraint-field>
     &#60;!-- Specify that a particular field is of given range but the
       -- field doesn't need to be present in all the requests -->
    &#60;constraint-field name='SKUnum' scope='request.parameter'>
        &#60;value match-expr='in-range'> 1000 - 2000 &#60;/value>
    &#60;/constraint-field>
    &#60;!-- cache when the category matches with any value other than
       -- a specific value -->
    &#60;constraint-field name="category" scope="request.parameter>
        &#60;value match-expr="equals" cache-on-match-failure="true">
       bogus
        &#60;/value>
    &#60;/constraint-field>
&#60;/cache-mapping>
&#60;cache-mapping>
    &#60;servlet-name> InfoServlet &#60;/servlet-name>
    &#60;cache-helper-ref>myHelper&#60;/cache-helper-ref>
&#60;/cache-mapping>
&#60;/cache></pre><p>For more information about the <tt>sun-web.xml</tt> caching settings, see <a href="http://docs.sun.com/doc/820-4502/beard?a=view">cache in <i>Sun GlassFish Enterprise Server v3 Prelude Application Deployment Guide</i></a>.</p>

<a name="beagq"></a><h5>The <tt>CacheKeyGenerator</tt> Interface</h5>
<p>The built-in default <a name="indexterm-218"></a><a name="indexterm-219"></a><tt>CacheHelper</tt> implementation allows web applications to customize the key generation.
An application component (in a servlet or JSP) can set up a custom
<tt>CacheKeyGenerator</tt> implementation as an attribute in the <tt>ServletContext</tt>.</p><p>The name of the context attribute is configurable as the <tt>value</tt> of
the <a name="indexterm-220"></a><tt>cacheKeyGeneratorAttrName</tt> property in the <tt>default-helper</tt> element of the <tt>sun-web.xml</tt> deployment descriptor. For
more information, see <a href="http://docs.sun.com/doc/820-4502/beasm?a=view">default-helper in <i>Sun GlassFish Enterprise Server v3 Prelude Application Deployment Guide</i></a>.</p>

<a name="beagr"></a><h4>About the Servlet Engine</h4>
<p>Servlets exist in and are managed by the <a name="indexterm-221"></a>servlet engine in the Enterprise
Server. The servlet engine is an internal object that handles all servlet meta
functions. These functions include instantiation, initialization, destruction, access from other components, and configuration management.
This section covers the following topics:</p>
<ul><li><p><a href="#beags">Instantiating and Removing Servlets</a></p></li>
<li><p><a href="#beagt">Request Handling</a></p></li></ul>


<a name="beags"></a><h5>Instantiating and Removing Servlets</h5>
<p><a name="indexterm-222"></a><a name="indexterm-223"></a><a name="indexterm-224"></a><a name="indexterm-225"></a><a name="indexterm-226"></a><a name="indexterm-227"></a><a name="indexterm-228"></a>After the servlet engine instantiates the servlet, the servlet engine calls the servlet&#8217;s
<tt>init()</tt> method to perform any necessary initialization. You can override this method to
perform an initialization function for the servlet&#8217;s life, such as initializing a counter.</p><p>When a servlet is removed from service, the servlet engine calls the <tt>destroy()</tt>
method in the servlet so that the servlet can perform any final tasks
and deallocate resources. You can override this method to write log messages or
clean up any lingering connections that won&#8217;t be caught in garbage collection.</p>

<a name="beagt"></a><h5>Request Handling</h5>
<p><a name="indexterm-229"></a><a name="indexterm-230"></a><a name="indexterm-231"></a>When a request is made, the Enterprise Server hands the incoming data to
the servlet engine. The servlet engine processes the request&#8217;s input data, such as
form data, cookies, session information, and URL name-value pairs, into an <tt>HttpServletRequest</tt> request object
type.</p><p>The servlet engine also creates an <tt>HttpServletResponse</tt> response object type. The engine
then passes both as parameters to the servlet&#8217;s <tt>service()</tt> method.</p><p><a name="indexterm-232"></a><a name="indexterm-233"></a><a name="indexterm-234"></a>In an HTTP servlet, the default <tt>service()</tt> method routes requests to another
method based on the HTTP transfer method: <tt>POST</tt>, <tt>GET</tt>, <tt>DELETE</tt>, <tt>HEAD</tt>, <tt>OPTIONS</tt>, <tt>PUT</tt>,
or <tt>TRACE</tt>. For example, HTTP <tt>POST</tt> requests are sent to the <tt>doPost()</tt>
method, HTTP <tt>GET</tt> requests are sent to the <tt>doGet()</tt> method, and so on. This
enables the servlet to process request data differently, depending on which transfer method
is used. Since the routing takes place in the service method, you generally
do not override <tt>service()</tt> in an HTTP servlet. Instead, override <tt>doGet()</tt>, <tt>doPost()</tt>,
and so on, depending on the request type you expect.</p><p><a name="indexterm-235"></a><a name="indexterm-236"></a><a name="indexterm-237"></a>To perform the tasks to answer a request, override the <tt>service()</tt> method for
generic servlets, and the <tt>doGet()</tt> or <tt>doPost()</tt> methods for HTTP servlets. Very often, this
means accessing EJB components to perform business transactions, then collating the information in the
request object or in a JDBC <tt>ResultSet</tt> object.</p>

<a name="beagu"></a><h3>Using JavaServer Pages</h3>
<p>The Enterprise Server supports the following JSP features:</p>
<ul><li><p>JavaServer Pages (JSP) Specification</p></li>
<li><p>Precompilation of JSP files, which is especially useful for production servers</p></li>
<li><p>JSP tag libraries and standard portable tags</p></li></ul>
<p><a name="indexterm-238"></a><a name="indexterm-239"></a>For information about creating JSP files, see Sun Microsystem&#8217;s JavaServer Pages web site
at <a href="http://java.sun.com/products/jsp/index.html">http://java.sun.com/products/jsp/index.html</a>.</p><p><a name="indexterm-240"></a><a name="indexterm-241"></a>For information about Java Beans, see Sun Microsystem&#8217;s JavaBeans web page at <a href="http://java.sun.com/beans/index.html">http://java.sun.com/beans/index.html</a>.</p><p>This section describes how to use JavaServer Pages (JSP files) as page templates
in an Enterprise Server web application. This section contains the following topics:</p>
<ul><li><p><a href="#beagv">JSP Tag Libraries and Standard Portable Tags</a></p></li>
<li><p><a href="#beagz">Options for Compiling JSP Files</a></p></li></ul>


<a name="beagv"></a><h4>JSP Tag Libraries and Standard Portable Tags</h4>
<a name="indexterm-242"></a><a name="indexterm-243"></a><p>Enterprise Server supports tag libraries and standard portable tags. For more information, see
the JavaServer Pages Standard Tag Library (JSTL) page at <a href="http://java.sun.com/products/jsp/jstl/index.jsp">http://java.sun.com/products/jsp/jstl/index.jsp</a>.</p><p>Web applications don&#8217;t need to bundle copies of the <tt>jsf-impl.jar</tt> or <tt>appserv-jstl.jar</tt>
JSP tag libraries (in <i>as-install</i><tt>/lib</tt>) to use JavaServer<sup>TM</sup> Faces technology or JSTL, respectively.
These tag libraries are automatically available to all web applications.</p>

<a name="beagz"></a><h4>Options for Compiling JSP Files</h4>
<a name="indexterm-244"></a><a name="indexterm-245"></a><a name="indexterm-246"></a><a name="indexterm-247"></a><p>Enterprise Server provides the following ways of compiling JSP source files into servlets:</p>
<ul><li><p>JSP files are automatically compiled at runtime.</p></li>
<li><p><a name="indexterm-248"></a><a name="indexterm-249"></a>The <tt>asadmin deploy</tt> command has a <tt>precompilejsp</tt> option. For details, see the <i><a href="http://docs.sun.com/doc/820-4497"><i>Sun GlassFish Enterprise Server v3 Prelude Reference Manual</i></a></i>.</p></li>
<li><p>The <a name="indexterm-250"></a><tt>jspc</tt> command line tool allows you to precompile JSP files at the command line. For details, see the <i><a href="http://docs.sun.com/doc/820-4497"><i>Sun GlassFish Enterprise Server v3 Prelude Reference Manual</i></a></i>.</p></li></ul>


<a name="beaha"></a><h3>Creating and Managing Sessions</h3>
<a name="indexterm-251"></a><p>This chapter describes how to create and manage HTTP sessions that allows users
and transaction information to persist between interactions.</p><p>This chapter contains the following sections:</p>
<ul><li><p><a href="#beahb">Configuring Sessions</a></p></li>
<li><p><a href="#beahf">Session Managers</a></p></li></ul>


<a name="beahb"></a><h4>Configuring Sessions</h4>
<p>This section covers the following topics:</p>
<ul><li><p><a href="#beahc">HTTP Sessions, Cookies, and URL Rewriting</a></p></li>
<li><p><a href="#beahd">Coordinating Session Access</a></p></li>
<li><p><a href="#ghmih">Saving Sessions During Redeployment</a></p></li></ul>


<a name="beahc"></a><h5>HTTP Sessions, Cookies, and URL Rewriting</h5>
<a name="indexterm-252"></a><a name="indexterm-253"></a><a name="indexterm-254"></a><p>To configure whether and how HTTP sessions use cookies and URL rewriting, edit
the <tt>session-properties</tt> and <tt>cookie-properties</tt> elements in the <tt>sun-web.xml</tt> file for an individual web
application. For more about the properties you can configure, see <a href="http://docs.sun.com/doc/820-4502/beaxr?a=view">session-properties in <i>Sun GlassFish Enterprise Server v3 Prelude Application Deployment Guide</i></a> and <a href="http://docs.sun.com/doc/820-4502/beash?a=view">cookie-properties in <i>Sun GlassFish Enterprise Server v3 Prelude Application Deployment Guide</i></a>.</p>

<a name="beahd"></a><h5>Coordinating Session Access</h5>
<p>Make sure that multiple threads don&#8217;t simultaneously modify the same session object in
conflicting ways.</p><p>This is especially likely to occur in web applications that use HTML frames
where multiple servlets are executing simultaneously on behalf of the same client. A
good solution is to ensure that one of the servlets modifies the session
and the others have read-only access.</p>

<a name="ghmih"></a><h5>Saving Sessions During Redeployment</h5>
<a name="indexterm-255"></a><p>Whenever a redeployment is done, the sessions at that transit time become invalid
unless you use the <tt>keepSessions=true</tt> property of the <tt>asadmin redeploy</tt> command. For example:</p><pre>asadmin redeploy --properties keepSessions=true --name hello.war</pre><p>For details, see the <i><a href="http://docs.sun.com/doc/820-4497"><i>Sun GlassFish Enterprise Server v3 Prelude Reference Manual</i></a></i>.</p><p>The new class loader of the redeployed application is used to deserialize any
sessions previously saved. The usual restrictions about serialization and deserialization apply. For example,
any application-specific class referenced by a session attribute may evolve only in a
backward-compatible fashion. For more information about class loaders, see <a href="p6.html">Chapter&#160;2, Class Loaders</a>.</p>

<a name="beahf"></a><h4>Session Managers</h4>
<a name="indexterm-256"></a><a name="indexterm-257"></a><p>A session manager automatically creates new session objects whenever a new session starts.
In some circumstances, clients do not join the session, for example, if the
session manager uses cookies and the client does not accept cookies.</p><p>Enterprise Server offers these session management options, determined by the <tt>session-manager</tt> element&#8217;s <tt>persistence-type</tt>
attribute in the <tt>sun-web.xml</tt> file:</p>
<ul><li><p><a href="#beahg">The <tt>memory</tt> Persistence Type</a>, the default</p></li>
<li><p><a href="#beahh">The <tt>file</tt> Persistence Type</a>, which uses a file to store session data</p></li></ul>

<hr><p><b>Note - </b>If the session manager configuration contains an error, the error is written to
the server log and the default (<tt>memory</tt>) configuration is used.</p>
<hr>
<p>For more information, see <a href="http://docs.sun.com/doc/820-4502/beaxq?a=view">session-manager in <i>Sun GlassFish Enterprise Server v3 Prelude Application Deployment Guide</i></a>.</p>

<a name="beahg"></a><h5>The <tt>memory</tt> Persistence Type</h5>
<p>This persistence type is not designed for a production environment that requires session
persistence. It provides no session persistence. However, you can configure it so that
the session state in memory is written to the file system prior to
server shutdown.</p><p>To specify the <tt>memory</tt> persistence type for a specific web application, edit the
<tt>sun-web.xml</tt> file as in the following example. The <tt>persistence-type</tt> property is optional,
but must be set to <tt>memory</tt> if included. This overrides the web container
availability settings for the web application.</p><pre>&#60;sun-web-app>
...
&#60;session-config>
    &#60;session-manager persistence-type="memory" />
        &#60;manager-properties>
            &#60;property name="sessionFilename" value="sessionstate" />
        &#60;/manager-properties>
    &#60;/session-manager>
    ...
&#60;/session-config>
...
&#60;/sun-web-app></pre><p>The only manager property that the <tt>memory</tt> persistence type supports is <tt>sessionFilename</tt>, which
is listed under <a href="http://docs.sun.com/doc/820-4502/beaum?a=view">manager-properties in <i>Sun GlassFish Enterprise Server v3 Prelude Application Deployment Guide</i></a>. The <tt>sessionFilename</tt> property specifies the name of the file where
sessions are serialized and persisted if the web application or the server is
stopped. To disable this behavior, specify an empty string as the value of
<tt>sessionFilename</tt>.</p><p>For more information about the <tt>sun-web.xml</tt> file, see <a href="http://docs.sun.com/doc/820-4502"><i>Sun GlassFish Enterprise Server v3 Prelude Application Deployment Guide</i></a>.</p>

<a name="beahh"></a><h5>The <tt>file</tt> Persistence Type</h5>
<p>This persistence type provides session persistence to the local file system, and allows
a single server domain to recover the session state after a failure and
restart. The session state is persisted in the background, and the rate at
which this occurs is configurable. The store also provides passivation and activation of
the session state to help control the amount of memory used. This option
is not supported in a production environment. However, it is useful for a development
system with a single server instance.</p>
<hr><p><b>Note - </b>Make sure the <tt>delete</tt> option is set in the <tt>server.policy</tt> file, or expired
file-based sessions might not be deleted properly. For more information about <tt>server.policy</tt>, see
<a href="p9.html#beabx">The <tt>server.policy</tt> File</a>.</p>
<hr>
<p>To specify the <tt>file</tt> persistence type for a specific web application, edit the
<tt>sun-web.xml</tt> file as in the following example. Note that <tt>persistence-type</tt> must be set to
<tt>file</tt>. This overrides the web container availability settings for the web application.</p><pre>&#60;sun-web-app>
...
&#60;session-config>
    &#60;session-manager persistence-type="file">
        &#60;store-properties>
            &#60;property name="directory" value="sessiondir" />
        &#60;/store-properties>
    &#60;/session-manager>
    ...
&#60;/session-config>
...
&#60;/sun-web-app></pre><p>The <tt>file</tt> persistence type supports all the manager properties listed under <a href="http://docs.sun.com/doc/820-4502/beaum?a=view">manager-properties in <i>Sun GlassFish Enterprise Server v3 Prelude Application Deployment Guide</i></a> except
<tt>sessionFilename</tt>, and supports the <tt>directory</tt> store property listed under <a href="http://docs.sun.com/doc/820-4502/beaxu?a=view">store-properties in <i>Sun GlassFish Enterprise Server v3 Prelude Application Deployment Guide</i></a>.</p><p>For more information about the <tt>sun-web.xml</tt> file, see <a href="http://docs.sun.com/doc/820-4502"><i>Sun GlassFish Enterprise Server v3 Prelude Application Deployment Guide</i></a>.</p>

<a name="ggrgt"></a><h3>Using Comet</h3>
<a name="indexterm-258"></a><p>This section explains the Comet programming technique and how to create and deploy
a Comet-enabled application with the Sun GlassFish Enterprise Server.</p>

<a name="ggrgy"></a><h4>Introduction to Comet</h4>
<p>Comet is a programming technique that allows a web server to send updates
to clients without requiring the clients to explicitly request them. </p><p>This kind of programming technique is called <b>server push</b>, which means that the
server pushes data to the client. The opposite style is <b>client pull</b>, which means that
the client must pull the data from the server, usually through a user-initiated
event, such as a button click. </p><p>Web applications that use the Comet technique can deliver updates to clients in
a more timely manner than those that use the client-pull style while avoiding
the latency that results from clients frequently polling the server.</p><p>One of the many use cases for Comet is a chat room
application. When the server receives a message from one of the chat clients,
it needs to send the message to the other clients without requiring them to
ask for it. With Comet, the server can deliver messages to the clients
as they are posted rather than expecting the clients to poll the server
for new messages.</p><p>To accomplish this scenario, a Comet application establishes a long-lived HTTP connection. This
connection is suspended on the server side, waiting for an event to happens
before being resumed. This kind of connection remains open, allowing an application that uses
the Comet technique to send updates to clients when they are available rather
than expecting clients to reopen the connection to poll the server for updates.</p>

<a name="ggrib"></a><h5>The Grizzly Implementation of Comet</h5>
<p>One limitation of the Comet technique is that you must use it with
a web server that supports non-blocking connections in order to avoid poor performance.
Non-blocking connections are those that do not need to allocate one thread for
each request. If the web server were to use blocking connections then it
might end up holding many thousands of threads, thereby hindering its scalability.</p><p>The GlassFish server includes the Grizzly HTTP Engine, which enables asynchronous request processing
(ARP) by avoiding blocking connections. Grizzly's ARP implementation accomplishes this by using the Java
NIO API.</p><p>With Java NIO, Grizzly enables greater performance and scalability by avoiding the limitations
experienced by traditional web servers that must run a thread for each request.
Instead, Grizzly's ARP mechanism makes efficient use of a thread pool system and
also keeps the state of requests so that it can keep requests alive
without holding a single thread for each of them.</p><p>Grizzly supports two different implementations of Comet:</p>
<ul><li><p><a href="#ghgxk">Grizzly Comet</a> &#8212; Based on ARP, this includes a set of APIs that you use from a web component to enable Comet functionality in your web application. Grizzly Comet is specific to the Sun GlassFish Enterprise Server.</p></li>
<li><p><a href="#ghgxn">Bayeux Protocol</a> &#8212; Often referred to as Cometd. This consists of the JSON-based Bayeux message protocol, a set of Dojo or Ajax libraries, and an event handler. The Bayeux protocol uses a publish/subscribe model for server/client communication. The Bayeux protocol is portable, but it is container dependent if you want to invoke it from an EJB component. The Grizzly implementation of Cometd consists of a servlet that you reference from your web application.</p></li></ul>


<a name="ggrim"></a><h5>Client Technologies to Use With Comet</h5>
<p>In addition to creating a web component that uses the Comet APIs, you
need to enable your client to accept asynchronous updates from the web component.
To accomplish this, you can use JavaScript, IFrames, or a framework, such as
<a href="http://dojotoolkit.org">Dojo</a>.</p><p>An IFrame is an HTML element that allows you to include other content
in an HTML page. As a result, the client can embed updated content
in the IFrame without having to reload the page.</p><p>The example explained in this tutorial employs a combination of JavaScript and IFrames
to allow the client to accept asynchronous updates. A servlet included in the
example writes out JavaScript code to one of the IFrames. The JavaScript code
contains the updated content and invokes a function in the page that updates
the appropriate elements in the page with the new content.</p><p>The next section explains the two kinds of connections that you can make
to the server. While you can use any of the client technologies listed
in this section with either kind of connection, it is more difficult to
use JavaScript with an HTTP-streaming connection.</p>

<a name="ggrgo"></a><h5>Kinds of Comet Connections</h5>
<p>When working with Comet, as implemented in Grizzly, you have two different ways
to handle client connections to the server:</p>
<ul><li><p>HTTP Streaming</p></li>
<li><p>long-polling</p></li></ul>


<a name="ggriu"></a><h5>HTTP Streaming</h5>
<p>The HTTP Streaming technique keeps a connection open indefinitely. It never closes, even
after the server pushes data to the client.</p><p>In the case of HTTP streaming, the application sends a single request and
receives responses as they come, reusing the same connection forever. This technique significantly
reduces the network latency because the client and the server don't need to
open and close the connection.</p><p>The basic life cycle of an application using HTTP-streaming is:</p><p>request --> suspend --> data available --> write response --> data available -->
write response </p><p>The client makes an initial request and then suspends the request, meaning that
it waits for a response. Whenever data is available, the server writes it
to the response.</p>

<a name="ggrhv"></a><h5>Long Polling</h5>
<p>The long-polling technique is a combination of server-push and client-pull because the client
needs to resume the connection after a certain amount of time or after
the server pushes an update to the client.</p><p>The basic life cycle of an application using long-polling is:</p><p> request -> suspend --> data available --> write response --> resume</p><p>The client makes an initial request and then suspends the request. When an
update is available, the server writes it to the response. The connection closes,
and the client optionally resumes the connection.</p>

<a name="ggtjb"></a><h5>How to Choose the Kind of Connection</h5>
<p>If you anticipate that your web application will need to send frequent updates
to the client, you should use the HTTP-streaming connection so that the client
does not have to frequently reestablish a connection.  If you anticipate less
frequent updates, you should use the long-polling connection so that the web server
does not need to keep a connection open when no updates are occurring.
One caveat to using the HTTP-streaming connection is that if you are streaming through
a proxy, the proxy can buffer the response from the server. So, be
sure to test your application if you plan to use HTTP-streaming behind a
proxy.</p>

<a name="ghgxk"></a><h4>Grizzly Comet</h4>
<a name="indexterm-259"></a><p>The following sections describe how to use Grizzly Comet.</p>
<ul><li><p><a href="#ggrgb">The Grizzly Comet API</a></p></li>
<li><p><a href="#ggrgr">The Hidden Frame Example</a></p></li>
<li><p><a href="#ggrha">Creating a Comet-Enabled Application</a></p></li>
<li><p><a href="#ggrgp">Developing the Web Component</a></p></li>
<li><p><a href="#ggrih">Creating the Client Pages</a></p></li>
<li><p><a href="#ghgwn">Creating the Deployment Descriptor</a></p></li>
<li><p><a href="#ggrla">Deploying and Running a Comet-Enabled Application</a></p></li></ul>


<a name="ggrgb"></a><h5>The Grizzly Comet API</h5>
<p>Grizzly's support for Comet includes a small set of APIs that make it
easy to add Comet functionality to your web applications. The Grizzly Comet APIs
that developers will use most often are the following:</p>
<ul><li><p><tt>CometContext</tt>: A Comet context, which is a shareable space to which applications subscribe in order to receive updates.</p></li>
<li><p><tt>CometEngine</tt>: The entry point to any component using Comet. Components can be servlets, JavaServer Pages<sup>TM</sup> (JSP<sup>TM</sup>), JavaServer Faces components, or pure Java classes. </p></li>
<li><p><tt>CometEvent</tt>: Contains the state of the <tt>CometContext</tt> object</p></li>
<li><p><tt>CometHandler</tt>: The interface an application implements to be part of one or more Comet contexts.</p></li></ul>
<p>The way a developer would use this API in a web component
is to perform the following tasks:</p>
<ol><li><p>Register the context path of the application with the <tt>CometContext</tt> object:</p><pre>CometEngine cometEngine = 
    CometEngine.getEngine();
CometContext cometContext = 
    cometEngine.register(contextPath) </pre></li>
<li><p> Register the <tt>CometHandler</tt> implementation with the <tt>CometContext</tt> object:</p><pre>cometContext.addCometHandler(handler)</pre></li>
<li><p>Notify one or more <tt>CometHandler</tt> implementations when an event happens:</p><pre>cometContext.notify((Object)(handler))</pre></li></ol>


<a name="ggrgr"></a><h5>The Hidden Frame Example</h5>
<p>This rest of this tutorial uses the Hidden Frame example to explain how
to develop Comet-enabled web applications. You can download the example from <tt>grizzly.dev.java.net</tt> at
<a href="http://download.java.net/maven/2/com/sun/grizzly/samples/grizzly-comet-hidden/1.7.3.1/">Hidden example download</a>. From there, you can download a prebuilt WAR file as well as
a JAR file containing the servlet code.</p><p>The Hidden Frame example is so called because it uses hidden IFrames. What
the example does is it allows multiple clients to increment a counter on
the server. When a client increments the counter, the server broadcasts the new
count to the clients using the Comet technique.</p><p>The Hidden Frame example uses the long-polling technique, but you can easily modify
it to use HTTP-streaming by removing two lines. See <a href="#ggqkx">Notifying the Comet Handler of an Event</a> and <a href="#ggqnt">Creating the HTML Page That Updates and Displays the Content</a> for
more information on converting the example to use the HTTP-streaming technique.</p><p>The client side of the example uses hidden IFrames with embedded JavaScript tags
to connect to the server and to asynchronously post content to and accept
updates from the server.</p><p>The server side of the example consists of a single servlet that listens
for updates from clients, updates the counter, and writes JavaScript code to the
client that allows it to update the counter on its page.</p><p>See <a href="#ggrla">Deploying and Running a Comet-Enabled Application</a> for instructions on how to deploy and run the example.</p><p>When you run the example, the following happens:</p>
<ol><li><p>The <tt>index.html</tt> page opens.</p></li>
<li><p>The browser loads three frames: the first one accesses the servlet using an HTTP GET; the second one loads the <tt>count.html</tt> page, which displays the current count; and the third one loads the <tt>button.html</tt> page, which is used to send the POST request.</p></li>
<li><p>After clicking the button on the <tt>button.html</tt> page, the page submits a POST request to the servlet.</p></li>
<li><p>The <tt>doPost</tt> method calls the <tt>onEvent</tt> method of the Comet handler and redirects the incremented count along with some JavaScript to the <tt>count.html</tt> page on the client.</p></li>
<li><p>The <tt>updateCount</tt> JavaScript function on the <tt>count.html</tt> page updates the counter on the page.</p></li>
<li><p>Because this example uses long-polling, the JavaScript code on <tt>count.html</tt> calls <tt>doGet</tt> again to resume the connection after the servlet pushes the update.</p></li></ol>


<a name="ggrha"></a><h5>Creating a Comet-Enabled Application</h5>
<p>This section uses the Hidden Frame example application to demonstrate how to develop
a Comet application. The main tasks for creating a simple Comet-enabled application are
the following:</p>
<ul><li><p><a href="#ggrgp">Developing the Web Component</a>, such as a servlet to support the Comet requests and a Comet handler to send updates to the client</p></li>
<li><p><a href="#ggrih">Creating the Client Pages</a>, one or more HTML pages that include some client-side technology to open an asynchronous connection to the server and to receive updates from the web component</p></li>
<li><p><a href="#ghgwn">Creating the Deployment Descriptor</a>, which configures the web component</p></li></ul>


<a name="ggrgp"></a><h5>Developing the Web Component</h5>
<p>This section shows you how to create a Comet-enabled web component by giving
you instructions for creating the servlet in the Hidden Frame example.</p><p>Developing the web component involves performing the following steps:</p>
<ol><li><p>Create a web component to support Comet requests.</p></li>
<li><p>Register the component with the Comet engine.</p></li>
<li><p>Define a Comet handler that sends updates to the client.</p></li>
<li><p>Add the Comet handler to the Comet context.</p></li>
<li><p>Notify the Comet handler of an event using the Comet context.</p></li></ol>


<a name="ggqlx"></a><h5>Creating a Web Component to Support Comet</h5>
<ol>
<li><b>Create an empty servlet class, like the following:</b><pre>import javax.servlet.*;

public class HiddenCometServlet extends HttpServlet {
    private static final long serialVersionUID = 1L;
private String contextPath = null;
    @Override
    public void init(ServletConfig config) throws ServletException {}

    @Override
    protected void doGet(HttpServletRequest req, 
    HttpServletResponse res) 
    throws ServletException, IOException {}

    @Override
    protected void doPost(HttpServletRequest req, 
    HttpServletResponse res)
    throws ServletException, IOException {);
}</pre></li>
<li><b>Import the following Comet packages into the servlet class:</b><pre>import com.sun.grizzly.comet.CometContext;
import com.sun.grizzly.comet.CometEngine;
import com.sun.grizzly.comet.CometEvent;
import com.sun.grizzly.comet.CometHandler;</pre></li>
<li><b>Import these additional classes that you need for incrementing a counter and writing
output to the clients:</b><pre>import java.io.IOException;
import java.io.PrintWriter;
import java.util.concurrent.atomic.AtomicInteger;</pre></li>
<li><b>Add a private variable for the counter:</b><pre>private final AtomicInteger counter = new AtomicInteger();</pre></li></ol>

<a name="ggqla"></a><h5>Registering the Servlet with the Comet Engine</h5>
<ol>
<li><b>In the servlet's <tt>init</tt> method, add the following code to get the component's
context path:</b><pre>ServletContext context = config.getServletContext();
contextPath = context.getContextPath() + "/hidden_comet";</pre></li>
<li><b>Get an instance of the Comet engine by adding this line after the
lines from step 1:</b><pre> CometEngine engine = CometEngine.getEngine();</pre></li>
<li><b>Register the component with the Comet engine by adding the following lines after
those from step 2:</b><pre>CometContext cometContext = engine.register(contextPath);
cometContext.setExpirationDelay(30 * 1000);</pre></li></ol>

<a name="ggqlt"></a><h5>Defining a Comet Handler to Send Updates to the Client</h5>
<ol>
<li><b>Create a private class that implements <tt>CometHandler</tt> and add it to the servlet
class:</b><pre>private class CounterHandler 
    implements CometHandler&#60;HttpServletResponse> {
    private HttpServletResponse response;
}</pre></li>
<li><b>Add the following methods to the class:</b><pre>public void onInitialize(CometEvent event) 
    throws IOException {}

    public void onInterrupt(CometEvent event) 
        throws IOException {
        removeThisFromContext();
    }
    
    public void onTerminate(CometEvent event) 
        throws IOException {
        removeThisFromContext();
    }

    public void attach(HttpServletResponse attachment) {
            this.response = attachment;
    }

    private void removeThisFromContext() throws IOException {
        response.getWriter().close();
        CometContext context = 
            CometEngine.getEngine().getCometContext(contextPath);
        context.removeCometHandler(this);
    }</pre><p>You need to provide implementations of these methods when implementing <tt>CometHandler</tt>. The
<tt>onInterrupt</tt> and <tt>onTerminate</tt> methods execute when certain changes occur in the status of
the underlying TCP communication. The <tt>onInterrupt</tt> method executes when communication is resumed. The
<tt>onTerminate</tt> method executes when communication is closed. Both methods call <tt>removeThisFromContext</tt>, which removes
the <tt>CometHandler</tt> object from the <tt>CometContext</tt> object.</p></li></ol>

<a name="ggqjn"></a><h5>Adding the Comet Handler to the Comet Context</h5>
<ol>
<li><b>Get an instance of the Comet handler and attach the response to it
by adding the following lines to the <tt>doGet</tt> method:</b><pre>CounterHandler handler = new CounterHandler();
handler.attach(res);</pre></li>
<li><b>Get the Comet context by adding the following lines to <tt>doGet</tt>:</b><pre>CometEngine engine = CometEngine.getEngine();
CometContext context = engine.getCometContext(contextPath);</pre></li>
<li><b>Add the Comet handler to the Comet context by adding this line to
<tt>doGet</tt>:</b><pre>context.addCometHandler(handler);</pre></li></ol>

<a name="ggqkx"></a><h5>Notifying the Comet Handler of an Event</h5>
<ol>
<li><b>Add an <tt>onEvent</tt> method to the <tt>CometHandler</tt> class to define what happens
when an event occurs:</b><pre>public void onEvent(CometEvent event) 
    throws IOException {
    if (CometEvent.NOTIFY == event.getType()) {
        int count = counter.get();
        PrintWriter writer = response.getWriter();
        writer.write("&#60;script type='text/javascript'>" + 
            "parent.counter.updateCount('" + count + "')" +
            "&#60;/script>\n");
        writer.flush();
        event.getCometContext().resumeCometHandler(this);
    }
}</pre><p>This method first checks if the event type is <tt>NOTIFY</tt>, which means that
the web component is notifying the <tt>CometHandler</tt> object that a client has
incremented the count. If the event type is <tt>NOTIFY</tt>, the <tt>onEvent</tt> method gets the
updated count, and writes out JavaScript to the client. The JavaScript includes a
call to the <tt>updateCount</tt> function, which will update the count on the clients'
pages.</p><p>The last line resumes the Comet request and removes it from the list
of active <tt>CometHandler</tt> objects. By this line, you can tell that this application
uses the long-polling technique. If you were to delete this line, the application
would use the HTTP-Streaming technique.</p><ul>
<li><b>For HTTP-Streaming:</b><p>Add the same code as for long-polling, except do not include the following
line:</p><pre>event.getCometContext().resumeCometHandler(this);</pre></li></ul><p>You don't include this line because you do not want to resume the
request. Instead, you want the connection to remain open.</p></li>
<li><b>Increment the counter and forward the response by adding the following lines to
the <tt>doPost</tt> method:</b><pre>counter.incrementAndGet();
CometEngine engine = CometEngine.getEngine();
CometContext&#60;?> context = 
    engine.getCometContext(contextPath);
context.notify(null);
req.getRequestDispatcher("count.html").forward(req, res);</pre><p>When a user clicks the button, the <tt>doPost</tt> method is called. The <tt>doPost</tt>
method increments the counter. It then obtains the current <tt>CometContext</tt> object and calls its
<tt>notify</tt> method. By calling <tt>context.notify</tt>, the <tt>doPost</tt> method triggers the <tt>onEvent</tt> method
you created in the previous step. After <tt>onEvent</tt> executes, <tt>doPost</tt> forwards the
response to the clients.</p></li></ol>

<a name="ggrih"></a><h5>Creating the Client Pages</h5>
<p>Developing the HTML pages for the client involves performing these steps:</p>
<ol><li><p>Create a welcome HTML page, called <tt>index.html</tt>, that contains: one hidden frame for connecting to the servlet through an HTTP GET; one IFrame that embeds the <tt>count.html</tt> page, which contains the updated content; and one IFrame that embeds the <tt>button.html</tt> page, which is used for posting updates using HTTP POST.</p></li>
<li><p>Create the <tt>count.html</tt> page that contains an HTML element that displays the current count and the JavaScript for updating the HTML element with the new count.</p></li>
<li><p>Create the <tt>button.html</tt> page that contains a button for the users to submit updates.</p></li></ol>


<a name="ggqnu"></a><h5>Creating a Welcome HTML Page That Contains IFrames for Receiving and Sending Updates</h5>
<ol>
<li><b>Create an HTML page called <tt>index.html</tt>.</b></li>
<li><b>Add the following content to the page:</b><pre>&#60;html>
    &#60;head>
        &#60;title>Comet Example: Counter with Hidden Frame&#60;/title>
    &#60;/head>
    &#60;body>
  &#60;/body>
&#60;/html></pre></li>
<li><b>Add IFrames for connecting to the server and receiving and sending updates to
<tt>index.html</tt> in between the <tt>body</tt> tags:</b><pre>&#60;frameset>
    &#60;iframe name="hidden" src="hidden_comet" 
        frameborder="0" height="0" width="100%">&#60;/iframe>
    &#60;iframe name="counter" src="count.html" 
        frameborder="0" height="100%" width="100%">&#60;/iframe>
&#60;iframe name="button" src="button.html" frameborder="0" height="30%" widget="100%">&#60;/iframe>
&#60;/frameset></pre><p>The first frame, which is hidden, points to the servlet by referencing its
context path. The second frame displays the content from <tt>count.html</tt>, which displays
the current count. The second frame displays the content from <tt>button.html</tt>, which contains
the submit button for incrementing the counter.</p></li></ol>

<a name="ggqnt"></a><h5>Creating the HTML Page That Updates and Displays the Content</h5>
<ol>
<li><b>Create an HTML page called <tt>count.html</tt> and add the following content to it:</b><pre>&#60;html>
    &#60;head>
    &#60;/head>
        &#60;body>
            &#60;center>
                &#60;h3>Comet Example: Counter with Hidden Frame&#60;/h3>
                &#60;p>
                &#60;b id="count">&#38;nbsp;&#60;/b>
                &#60;p>
            &#60;/center>
        &#60;/body>
&#60;/html></pre><p>This page displays the current count.</p></li>
<li><b>Add JavaScript code that updates the count in the page . Add the
following lines in between the <tt>head</tt> tags of <tt>count.html</tt>:</b><pre>&#60;script type='text/javascript'>
    function updateCount(c) {
        document.getElementById('count').innerHTML = c;
        parent.hidden.location.href = "hidden_comet";
    };
&#60;/script></pre><p>The JavaScript takes the updated count it receives from the servlet and updates
the count element in the page. The last line in the <tt>updateCount</tt> function
invokes the servlet's <tt>doGet</tt> method again to reestablish the connection.</p><ul>
<li><b>For HTTP-Streaming:</b><p>Add the same code as for long-polling, except for the following line:</p><pre>parent.hidden.location.href = &#8220;hidden_comet&#8221;</pre><p>This line invokes the <tt>doGet</tt> method of <tt>CometServlet</tt> again, which would reestablish
the connection. In the case of HTTP-Streaming, you want the connection to remain
open. Therefore, you don't include this line of code.</p></li></ul></li></ol>

<a name="ggraz"></a><h5>Creating the HTML Page That Allows Submitting Updates</h5>
<ul>
<li><b>Create an HTML page called <tt>button.html</tt> and add the following content to it:</b><pre>&#60;html>
    &#60;head>
    &#60;/head>
        &#60;body>
            &#60;center>
                &#60;form method="post" action="hidden_comet">
                    &#60;input type="submit" value="Click">
                &#60;/form>
            &#60;/center>
        &#60;/body>
&#60;/html></pre><p>This page displays a form with a button that allows a user
to update the count on the server. The servlet will then broadcast the updated
count to all clients.</p></li></ul>

<a name="ghgwn"></a><h5>Creating the Deployment Descriptor</h5>
<p>This section describes how to create a deployment descriptor to specify how your
Comet-enabled web application should be deployed.</p>

<a name="ggqnc"></a><h5>Creating the Deployment Descriptor</h5>
<ul>
<li><b>Create a file called <tt>web.xml</tt> and put the following contents in it:</b><pre>&#60;?xml version="1.0" encoding="UTF-8"?>
    &#60;web-app version="2.5"
        xmlns="http://java.sun.com/xml/ns/javaee"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:schemaLocation=
            "http://java.sun.com/xml/ns/javaee 
            http://java.sun.com/xml/ns/javaee/web-app_2_5.xsd ">
            
        &#60;servlet>
            &#60;servlet-name>HiddenCometServlet&#60;/servlet-name>
            &#60;servlet-class>
                com.sun.grizzly.samples.comet.HiddenCometServlet
            &#60;/servlet-class>
            &#60;load-on-startup>0&#60;/load-on-startup>
        &#60;/servlet>
        &#60;servlet-mapping>
            &#60;servlet-name>HiddenCometServlet&#60;/servlet-name>
            &#60;url-pattern>/hidden_comet&#60;/url-pattern>
        &#60;/servlet-mapping>
    &#60;/web-app></pre><p>This deployment descriptor contains a servlet declaration and mapping for <tt>HiddenCometServlet</tt>. The <tt>load-on-startup</tt>
attribute must be set to 0 so that the Comet-enabled servlet will not
load until the client makes a request to it.</p></li></ul>

<a name="ggrla"></a><h5>Deploying and Running a Comet-Enabled Application</h5>
<p>Before running a Comet-enabled application in the Enterprise Server, you need to enable
Comet in the server. Then you can deploy the application just as you
would any other web application. </p><p>When running the application, you need to connect to it from at least
two different browsers to experience the effect of the servlet updating all clients
in response to one client posting an update to the server.</p>

<a name="ggqof"></a><h5>Enabling Comet in the Enterprise Server</h5>
<p>Before running a Comet-enabled application, you need to enable Comet in your application
server by adding a special property to the <tt>http-listener</tt> element of the
<tt>domain.xml</tt> file.</p><p>The following steps tell you how to add this property.</p><ol>
<li><b>Open <i>domain-dir</i><tt>/config/domain.xml</tt> in a text editor.</b></li>
<li><b>Add the following property in between the <tt>http-listener</tt> start and end tags:</b><pre>&#60;property name="cometSupport" value="true"/></pre></li>
<li><b>Save <tt>domain.xml</tt> and restart the server.</b></li></ol>

<a name="ggqoq"></a><h5>Deploying the Example</h5>
<p>These instructions tell you how to deploy the Hidden Frame example.</p><ol>
<li><b>Download <a href="http://download.java.net/maven/2/com/sun/grizzly/samples/grizzly-comet-hidden/1.7.3.1/">grizzly-comet-hidden-1.7.3.1.war</a>.</b></li>
<li><b>Run the following command to deploy the example:</b><pre><i>as-install</i>/bin/asadmin deploy grizzly-comet-hidden-1.7.3.1.war</pre></li></ol>

<a name="ggqme"></a><h5>Running the Example</h5>
<p>These instructions tell you how to run the Hidden Frame example.</p><ol>
<li><b>Open two web browsers, preferably two different brands of web browser.</b></li>
<li><b>Enter the following URL in both browsers:</b><pre>http://localhost:8080/grizzly-comet-hidden/index.html</pre></li>
<li><b>When the first page loads in both browsers, click the button in one
of the browsers and watch the count change in the other browser window.</b></li></ol>

<a name="ghgxn"></a><h4>Bayeux Protocol</h4>
<a name="indexterm-260"></a><a name="indexterm-261"></a><p>The Bayeux protocol, often referred to as Cometd, greatly simplifies the use of
Comet. No server-side coding is needed for servers such as Enterprise Server that
support the Bayeux protocol. Just enable Comet and the Bayeux protocol, then write
and deploy the client as described in the following tasks:</p>
<ul><li><p><a href="#ghhaw">Enabling Comet</a></p></li>
<li><p><a href="#ghhap">Configuring the <tt>web.xml</tt> File</a></p></li>
<li><p><a href="#ghhtv">Writing, Deploying, and Running the Client</a></p></li></ul>


<a name="ghhaw"></a><h5>Enabling Comet</h5>
<p>Before running a Comet-enabled application, you need to enable Comet in your application
server by adding a special property to the <tt>http-listener</tt> element of the
<tt>domain.xml</tt> file.</p><p>The following steps tell you how to add this property.</p><ol>
<li><b>Open <i>domain-dir</i><tt>/config/domain.xml</tt> in a text editor.</b></li>
<li><b>Add the following property in between the <tt>http-listener</tt> start and end tags:</b><pre>&#60;property name="cometSupport" value="true"/></pre></li>
<li><b>Save <tt>domain.xml</tt> and restart the server.</b></li></ol>

<a name="ghhap"></a><h5>Configuring the <tt>web.xml</tt> File</h5>
<p>To enable the Bayeux protocol on the Enterprise Server, you must reference the
<tt>CometdServlet</tt> in your web application's <tt>web.xml</tt> file. In addition, if your web
application includes a servlet, set the <tt>load-on-startup</tt> value for your servlet to <tt>0</tt> (zero)
so that it will not load until the client makes a request to
it.</p><ol>
<li><b>Open the <tt>web.xml</tt> file for your web application in a text editor.</b></li>
<li><b>Add the following XML code to the <tt>web.xml</tt> file:</b><pre>&#60;servlet>
   &#60;servlet-name>Grizzly Cometd Servlet&#60;/servlet-name>
   &#60;servlet-class>
      com.sun.grizzly.cometd.servlet.CometdServlet
   &#60;/servlet-class>
   &#60;init-param>
      &#60;description>
         expirationDelay is the long delay before a request is
         resumed. -1 means never.
      &#60;/description>
      &#60;param-name>expirationDelay&#60;/param-name>
      &#60;param-value>-1&#60;/param-value>
   &#60;/init-param>
   &#60;load-on-startup>1&#60;/load-on-startup>
&#60;/servlet>
&#60;servlet-mapping>
   &#60;servlet-name>Grizzly Cometd Servlet&#60;/servlet-name>
   &#60;url-pattern>/cometd/*&#60;/url-pattern>
&#60;/servlet-mapping></pre><p>Note that the <tt>load-on-startup</tt> value for the <tt>CometdServlet</tt> is <tt>1</tt>.</p></li>
<li><b>If your web application includes a servlet, set the <tt>load-on-startup</tt> value to
<tt>0</tt> for your servlet (not the <tt>CometdServlet</tt>) as follows:</b><pre>&#60;servlet>
   ...
   &#60;load-on-startup>0&#60;/load-on-startup>
&#60;/servlet></pre></li>
<li><b>Save the <tt>web.xml</tt> file.</b></li></ol>

<a name="ghhtv"></a><h5>Writing, Deploying, and Running the Client</h5>
<p>The examples in this task are taken from the example chat application posted
and discussed at <a href="http://weblogs.java.net/blog/jfarcand/archive/2007/02/gcometd_introdu_1.html">http://weblogs.java.net/blog/jfarcand/archive/2007/02/gcometd_introdu_1.html</a>.</p><ol>
<li><b>Add script tags to the HTML page. For example:</b><pre>&#60;script type="text/javascript" src="chat.js">&#60;/script></pre></li>
<li><b>In the script, call the needed libraries. For example:</b><pre>dojo.require("dojo.io.cometd");</pre></li>
<li><b>In the script, use publish and subscribe methods to send and receive messages.
For example:</b><pre>cometd.subscribe("/chat/demo", false, room, "_chat");
cometd.publish("/chat/demo", { user: room._username, chat: text});</pre></li>
<li><b>Deploy the web application as you would any other web application. For example:</b><pre>asadmin deploy cometd-example.war</pre></li>
<li><b>Run the application as you would any other web application.</b><p>The context root for the example chat application is <tt>/cometd</tt> and the
HTML page is <tt>index.html</tt>. So the URL might look like this:</p><pre>http://localhost:8080/cometd/index.html</pre></li></ol><h6>See Also</h6><p>For more information about deployment in the Enterprise Server, see the <a href="http://docs.sun.com/doc/820-4502"><i>Sun GlassFish Enterprise Server v3 Prelude Application Deployment Guide</i></a>.</p><p>For more information about the Bayeux protocol, see <a href="http://svn.xantus.org/shortbus/trunk/bayeux/bayeux.html">Bayeux Protocol</a>.</p><p>For more information about the Dojo toolkit, see <a href="http://dojotoolkit.org/">http://dojotoolkit.org/</a>.</p><p>For information about pushing data from an external component such as an EJB
module, see the example at <a href="http://blogs.sun.com/swchan/entry/java_api_for_cometd">http://blogs.sun.com/swchan/entry/java_api_for_cometd</a>. Using this Grizzly Java API for Cometd
makes your web application non-portable. Running your application on a server that doesn't
support Grizzly Comet will not work.</p><p>For information about RESTful (REpresentational State Transfer) web services and Comet, see <a href="http://developers.sun.com/appserver/reference/techart/cometslideshow.html">RESTful Web Services and Comet</a>.</p>

<a name="ghfme"></a><h3>Developing Grails Applications</h3>
<a name="indexterm-262"></a><a name="indexterm-263"></a><p>This section shows you how to get started using Groovy on Grails on
the Enterprise Server by covering the following topics:</p>
<ul><li><p><a href="#ghfmi">Introduction to Groovy and Grails</a></p></li>
<li><p><a href="#ghfkn">Installing Grails</a></p></li>
<li><p><a href="#ghflj">Creating a Simple Grails Application</a></p></li>
<li><p><a href="#ghflk">Deploying and Running a Grails Application</a></p></li></ul>


<a name="ghfmi"></a><h4>Introduction to Groovy and Grails</h4>
<p>Groovy  is a dynamic, object-oriented language for the Java Virtual Machine, which
builds on the strengths of Java but has additional features inspired by languages
such as Python, Ruby, and Smalltalk. For more information about Groovy, see <a href="http://groovy.codehaus.org">Groovy</a>.</p><p>Grails is an open-source web application framework that leverages the Groovy language and
complements Java web development. Grails is a stand-alone development environment that can hide
all configuration details or allow integration of Java business logic. For more information about
Grails, see <a href="http://www.grails.org">Grails</a>.</p>

<a name="ghfkn"></a><h4>Installing Grails</h4>
<p>To develop and deploy Grails applications on the Enterprise Server, first install the
Grails plug-in module.</p>

<a name="ghfna"></a><h5>Installing the Grails Plug-in Module</h5>
<ol>
<li><b>Install the Grails add-on component from the Update Tool.</b><p>For information about the Update Tool, see the <a href="http://docs.sun.com/doc/820-5968"><i>Sun GlassFish Enterprise Server v3 Prelude Installation Guide</i></a>.</p></li>
<li><b>Create a <tt>GRAILS_HOME</tt> environment variable that points to the Grails directory, <i>as-install</i><tt>/grails</tt>.</b></li>
<li><b>Add the <i>as-install</i><tt>/grails/bin</tt> directory to the <tt>PATH</tt> environment variable.</b></li></ol><a name="ghnot"></a><h6>Example&#160;7-1 Setting UNIX Environment Variables</h6><p>On Solaris, Linux, and other operating systems related to UNIX, use the following
commands for steps 2 and 3:</p><pre>set GRAILS_HOME=~/glassfish/grails
export GRAILS_HOME
cd $GRAILS_HOME
set PATH=$GRAILS_HOME/bin:$PATH
export PATH
chmod a+x $GRAILS_HOME/bin/*</pre><a name="ghnqg"></a><h6>Example&#160;7-2 Setting Windows Environment Variables</h6><p>On the Windows operating system, use the following commands for steps 2 and
3:</p><pre>set GRAILS_HOME=C:\GlassFish\grails
set PATH=%GRAILS_HOME%\bin;%PATH%</pre>

<a name="ghflj"></a><h4>Creating a Simple Grails Application</h4>
<p>To create the <tt>helloworld</tt> application, perform both these tasks:</p>
<ul><li><p><a href="#ghfks">Creating the <tt>helloworld</tt> Application</a></p></li>
<li><p><a href="#ghfmj">Creating the <tt>hello</tt> Controller</a></p></li></ul>
<p>For more information on creating Grails applications, see the <a href="http://grails.org/Quick+Start">Grails Quick Start</a>.</p>

<a name="ghfks"></a><h5>Creating the <tt>helloworld</tt> Application</h5>
<ol>
<li><b>Go to the <i>as-install</i><tt>/grails/samples</tt> directory.</b></li>
<li><b>Run the <tt>grails create-app helloworld</tt> command.</b><p>The <tt>grails create-app</tt> command creates an application framework that you can modify.</p></li></ol>

<a name="ghfmj"></a><h5>Creating the <tt>hello</tt> Controller</h5>
<ol>
<li><b>Go to the <i>as-install</i><tt>/grails/samples/helloworld</tt> directory.</b></li>
<li><b>Run the <tt>grails create-controller hello</tt> command.</b><p>The <tt>grails create-controller</tt> command creates a controller file that you can modify.</p></li>
<li><b>Edit the generated <tt>HelloController.groovy</tt> file so it looks like this:</b><pre>class HelloController {

       def world = {
                render "Hello World!"
        }
    //def index = { }
}</pre></li></ol>

<a name="ghflk"></a><h4>Deploying and Running a Grails Application</h4>
<p>To deploy and run your application, perform one of these tasks:</p>
<ul><li><p><a href="#ghfny">Running a Grails Application Using <tt>run-app</tt></a></p></li>
<li><p><a href="#ghfkh">Running a Grails Application Using Standard Deployment</a></p></li></ul>


<a name="ghfny"></a><h5>Running a Grails Application Using <tt>run-app</tt></h5>
<ol>
<li><b>Go to the application directory.</b><p>For example, go to the <i>as-install</i><tt>/grails/samples/helloworld</tt> directory.</p></li>
<li><b>Run the <tt>grails run-app</tt> command.</b><p>The <tt>grails run-app</tt> command starts the Enterprise Server in the background and runs the
application in one step. You don't need to create a WAR file or
deploy your application.</p></li>
<li><b>To test your application, point your browser to <tt>http://</tt><i>host</i><tt>:</tt><i>port</i><tt>/</tt><i>app-dir-name</i>.</b><p>For example, point to <tt>http://localhost:8080/helloworld</tt>. You should see a screen that begins,
&#8220;Welcome to Grails.&#8221; Selecting the HelloController link should change the display to, &#8220;Hello World!&#8221;</p></li></ol><h6>See Also</h6><p>For details about the <tt>grails run-app</tt> command, see the <i><a href="http://docs.sun.com/doc/820-4497"><i>Sun GlassFish Enterprise Server v3 Prelude Reference Manual</i></a></i>.</p>

<a name="ghfkh"></a><h5>Running a Grails Application Using Standard Deployment</h5>
<ol>
<li><b>Go to the application directory.</b><p>For example, go to the <i>as-install</i><tt>/grails/samples/helloworld</tt> directory.</p></li>
<li><b>Create the WAR file in one of the following ways:</b><ul>
<li><b>Run the <tt>grails war</tt> command.</b><p>This command creates a large WAR file containing all the application's dependencies.</p></li>
<li><b>Run the <tt>grails shared-war</tt> command.</b><p>This command creates a small WAR file, but requires referencing of the Grails
library JAR at deployment.</p></li></ul><p>In the <tt>helloworld</tt> application, this step creates the <tt>helloworld-0.1.war</tt> file.</p></li>
<li><b>Deploy the WAR file in one of the following ways:</b><ul>
<li><b>In the Administration Console, open the Applications component, go to the Web Applications
page, select the Deploy button, and type the path to the WAR file.</b><p>The path to the <tt>helloworld</tt> WAR file is <i>as-install</i><tt>/grails/samples/helloworld/helloworld-0.1.war</tt>.</p><p>If you used the <tt>grails shared-war</tt> command, specify the <i>as-install</i><tt>/grails/lib/glassfish-grails.jar</tt> file in the Libraries field.</p></li>
<li><b>On the command line, use the <tt>asadmin deploy</tt> command and specify the WAR file.
For example:</b><pre>asadmin deploy helloworld-0.1.war</pre><p>If you used the <tt>grails shared-war</tt> command, specify the libraries using the <tt>--libraries</tt> option. For
example:</p><pre>asadmin deploy --libraries $GRAILS_HOME/lib/glassfish-grails.jar helloworld-0.1.war</pre></li></ul></li>
<li><b>To test your application, point your browser to <tt>http://</tt><i>host</i><tt>:</tt><i>port</i><tt>/</tt><i>war-file-name</i>. Do not include the
<tt>.war</tt> extension.</b><p>For example, point to <tt>http://localhost:8080/helloworld-0.1</tt>. You should see a screen that begins, &#8220;Welcome to
Grails.&#8221; Selecting the HelloController link should change the display to, &#8220;Hello World!&#8221;</p></li></ol><h6>See Also</h6><p>For details about the Administration Console, see the online help.</p><p>For details about the <tt>asadmin deploy</tt> command, see the <i><a href="http://docs.sun.com/doc/820-4497"><i>Sun GlassFish Enterprise Server v3 Prelude Reference Manual</i></a></i>.</p><p>For details about the <tt>grails war</tt> and <tt>grails shared-war</tt> commands, see the <a href="http://grails.org/Quick+Start">Grails Quick Start</a>.</p><p>For general information about deployment, see the <a href="http://docs.sun.com/doc/820-4502"><i>Sun GlassFish Enterprise Server v3 Prelude Application Deployment Guide</i></a>.</p>

<a name="beaft"></a><h3>Advanced Web Application Features</h3>
<p>This section includes summaries of the following topics:</p>
<ul><li><p><a href="#beafu">Internationalization Issues</a></p></li>
<li><p><a href="#beafz">Virtual Servers</a></p></li>
<li><p><a href="#beaga">Default Web Modules</a></p></li>
<li><p><a href="#beagb">Class Loader Delegation</a></p></li>
<li><p><a href="#beagc">Using the <tt>default-web.xml</tt> File</a></p></li>
<li><p><a href="#beagd">Configuring Logging and Monitoring in the Web Container</a></p></li>
<li><p><a href="#beagi">Header Management</a></p></li>
<li><p><a href="#geqrh">Configuring Valves and Catalina Listeners</a></p></li>
<li><p><a href="#geqpl">Alternate Document Roots</a></p></li>
<li><p><a href="#ggjaa">Redirecting URLs</a></p></li>
<li><p><a href="#geurd">Using a context.xml File</a></p></li>
<li><p><a href="#gezcx">Enabling WebDav</a></p></li>
<li><p><a href="#gfaad">Using mod_jk</a></p></li>
<li><p><a href="#ghepd">Using SSI</a></p></li>
<li><p><a href="#ghepi">Using CGI</a></p></li>
<li><p><a href="#ghett">Using PHP</a></p></li>
<li><p><a href="#ghqyg">Using Scala and Lift</a></p></li></ul>


<a name="beafu"></a><h4>Internationalization Issues</h4>
<p>This section covers <a name="indexterm-264"></a>internationalization as it applies to the following:</p>
<ul><li><p><a href="#beafv">The Server's Default Locale</a></p></li>
<li><p><a href="#beafw">Servlet Character Encoding</a></p></li></ul>


<a name="beafv"></a><h5>The Server's Default Locale</h5>
<a name="indexterm-265"></a><a name="indexterm-266"></a><p>To set the default locale of the entire Enterprise Server, which determines the
locale of the Administration Console, the logs, and so on, use the Administration
Console. Select the Enterprise Server component, the Advanced tab, and the Domain Attributes tab.
Then type a value in the Locale field. For details, click the Help
button in the Administration Console.</p>

<a name="beafw"></a><h5>Servlet Character Encoding</h5>
<a name="indexterm-267"></a><a name="indexterm-268"></a><p>This section explains how the Enterprise Server determines the character encoding for the
servlet request and the servlet response. For encodings you can use, see <a href="http://java.sun.com/j2se/1.5.0/docs/guide/intl/encoding.doc.html">http://java.sun.com/j2se/1.5.0/docs/guide/intl/encoding.doc.html</a>.</p>

<a name="beafx"></a><h5>Servlet Request</h5>
<p>When processing a servlet request, the server uses the following order of precedence,
first to last, to determine the request character encoding:</p>
<ul><li><p><a name="indexterm-269"></a>The <tt></tt><tt>getCharacterEncoding()</tt> method</p></li>
<li><p>A hidden field in the form, specified by the <tt>form-hint-field</tt> attribute of the <tt>parameter-encoding</tt> element in the <tt>sun-web.xml</tt> file</p></li>
<li><p>The <tt>default-charset</tt> attribute of the <tt>parameter-encoding</tt> element in the <tt>sun-web.xml</tt> file</p></li>
<li><p>The default, which is <tt>ISO-8859-1</tt></p></li></ul>
<p>For details about the <tt>parameter-encoding</tt> element, see <a href="http://docs.sun.com/doc/820-4502/beavn?a=view">parameter-encoding in <i>Sun GlassFish Enterprise Server v3 Prelude Application Deployment Guide</i></a>.</p>

<a name="beafy"></a><h5>Servlet Response</h5>
<p>When processing a servlet response, the server uses the following order of precedence,
first to last, to determine the response character encoding:</p>
<ul><li><p><a name="indexterm-270"></a><a name="indexterm-271"></a>The <tt>setCharacterEncoding()</tt> or <tt></tt><tt>setContentType()</tt> method</p></li>
<li><p><a name="indexterm-272"></a>The <tt></tt><tt>setLocale()</tt> method</p></li>
<li><p>The default, which is <tt>ISO-8859-1</tt></p></li></ul>


<a name="beafz"></a><h4>Virtual Servers</h4>
<a name="indexterm-273"></a><p>A virtual server, also called a virtual host, is a virtual web server
that serves content targeted for a specific URL. Multiple virtual servers can serve
content using the same or different host names, port numbers, or IP addresses.
The HTTP service directs incoming web requests to different virtual servers based on
the URL.</p><p>When you first install the Enterprise Server, a default virtual server is created.
You can also assign a default virtual server to each new HTTP listener
you create.</p><p>Web applications can be assigned to virtual servers during deployment. A web module
can be assigned to more than one virtual server, and a virtual server can
have more than one web module assigned to it.<a name="indexterm-274"></a></p><p>If you deploy a web application and don't specify any assigned virtual servers,
the web application is assigned to all currently defined virtual servers. If you
then create additional virtual servers and want to assign existing web applications to
them, you must redeploy the web applications. For more information about deployment, see
the <a href="http://docs.sun.com/doc/820-4502"><i>Sun GlassFish Enterprise Server v3 Prelude Application Deployment Guide</i></a>.</p><p>For more information about virtual servers, see <a href="http://docs.sun.com/doc/820-4507/abhfg?a=view">virtual-server in <i>Sun GlassFish Enterprise Server v3 Prelude Administration Reference</i></a>.</p>

<a name="gehdt"></a><h5>To Assign a Default Virtual Server</h5>
<ol>
<li><b><a name="indexterm-275"></a>In the Administration Console, open the HTTP Service component under the relevant configuration.</b></li>
<li><b>Open the HTTP Listeners component under the HTTP Service component.</b></li>
<li><b>Select or create a new HTTP listener.</b></li>
<li><b><a name="indexterm-276"></a><a name="indexterm-277"></a><a name="indexterm-278"></a>Select from the Default Virtual Server drop-down list. </b><p>For more information, see <a href="#beaga">Default Web Modules</a>.</p></li></ol><h6>See Also</h6><p>For details, click the Help button in the Administration Console from the HTTP
Listeners page.</p>

<a name="fvycf"></a><h5>To Assign Virtual Servers</h5>
<ol>
<li><b>Deploy the application or web module and assign the desired virtual servers to
it.</b><p>For more information, see <a href="http://docs.sun.com/doc/820-4502"><i>Sun GlassFish Enterprise Server v3 Prelude Application Deployment Guide</i></a>.</p></li>
<li><b><a name="indexterm-279"></a>In the Administration Console, open the HTTP Service component under the relevant configuration.</b></li>
<li><b>Open the Virtual Servers component under the HTTP Service component.</b></li>
<li><b>Select the virtual server to which you want to assign a default web
module.</b></li>
<li><b>Select the application or web module from the Default Web Module drop-down list.
</b><p>For more information, see <a href="#beaga">Default Web Modules</a>.</p></li></ol><h6>See Also</h6><p>For details, click the Help button in the Administration Console from the Virtual
Servers page.</p>

<a name="beaga"></a><h4>Default Web Modules</h4>
<a name="indexterm-280"></a><a name="indexterm-281"></a><p>A default web module can be assigned to the default virtual server and
to each new virtual server. For details, see <a href="#beafz">Virtual Servers</a>. To access the
default web module for a virtual server, point the browser to the URL
for the virtual server, but do not supply a context root. For example:</p><pre>http://myvserver:3184/</pre><p><a name="indexterm-282"></a>A virtual server with no default web module assigned serves HTML or JavaServer Pages
(JSP) content from its document root, which is usually <i>domain-dir</i><tt>/docroot</tt>. To access this HTML
or JSP content, point your browser to the URL for the virtual server,
do not supply a context root, but specify the target file.</p><p>For example:</p><pre>http://myvserver:3184/hellothere.jsp</pre>

<a name="beagb"></a><h4>Class Loader Delegation</h4>
<a name="indexterm-283"></a><a name="indexterm-284"></a><a name="indexterm-285"></a><a name="indexterm-286"></a><p>The Servlet specification recommends that a web application class loader look in the
local class loader before delegating to its parent. To make the web application
class loader follow the delegation model in the Servlet specification, set <tt>delegate="false"</tt> in
the <tt>class-loader</tt> element of the <tt>sun-web.xml</tt> file. It&#8217;s safe to do this only for
a web module that does not interact with any other modules.</p><p>The default value is <tt>delegate="true"</tt>, which causes the web application class loader to delegate
in the same manner as the other class loaders. Use <tt>delegate="true"</tt> for
a web application that accesses EJB components or that acts as a web
service client or endpoint. For details about <tt>sun-web.xml</tt>, see <a href="http://docs.sun.com/doc/820-4502"><i>Sun GlassFish Enterprise Server v3 Prelude Application Deployment Guide</i></a>.</p>
<hr><p><b>Note - </b>For Prelude, the <tt>delegate</tt> value is ignored and assumed to be set to
<tt>true</tt>.</p>
<hr>
<p>For general information about class loaders, see <a href="p6.html">Chapter&#160;2, Class Loaders</a>.</p>

<a name="beagc"></a><h4>Using the <tt>default-web.xml</tt> File</h4>
<a name="indexterm-287"></a><p>You can use the <tt>default-web.xml</tt> file to define features such as filters and
security constraints that apply to all web applications.</p><p><a name="indexterm-288"></a><a name="indexterm-289"></a>For example, you can disable directory listings for added security. In your domain's
<tt>default-web.xml</tt> file, search for the definition of the servlet whose <tt>servlet-name</tt> is
equal to <tt>default</tt>, and set the value of the <tt>init-param</tt> named <tt>listings</tt> to
<tt>false</tt>. Then redeploy your web application if it has already been deployed.</p><pre>&#60;init-param>
   &#60;param-name>listings&#60;/param-name>
   &#60;param-value>false&#60;/param-value>
&#60;/init-param></pre><p><a name="indexterm-290"></a><a name="indexterm-291"></a>The <tt>mime-mapping</tt> elements in <tt>default-web.xml</tt> are global and inherited by all web applications. You
can override these mappings or define your own using <tt>mime-mapping</tt> elements in your
web application's <tt>web.xml</tt> file. For more information about <tt>mime-mapping</tt> elements, see the Servlet
specification.</p><p>You can use the Administration Console to edit the <tt>default-web.xml</tt> file. For
details, click the Help button in the Administration Console. As an alternative, you
can edit the file directly using the following steps.</p>

<a name="fvymc"></a><h5>To Use the <tt>default-web.xml</tt> File</h5>
<ol>
<li><b>Place the JAR file for the filter, security constraint, or other feature in
the <i>domain-dir</i><tt>/lib</tt> directory.</b></li>
<li><b>Edit the <i>domain-dir</i><tt>/config/default-web.xml</tt> file to refer to the JAR file.</b></li>
<li><b>Restart the server.</b></li></ol>

<a name="beagd"></a><h4>Configuring Logging and Monitoring in the Web Container</h4>
<a name="indexterm-292"></a><a name="indexterm-293"></a><a name="indexterm-294"></a><a name="indexterm-295"></a><a name="indexterm-296"></a><p>For information about configuring logging and monitoring in the web container using the
Administration Console, click the Help button in the Administration Console. Logging and Monitor tabs
are accessible from the Application Server page.</p>

<a name="beagi"></a><h4>Header Management</h4>
<a name="indexterm-297"></a><a name="indexterm-298"></a><p>In all Editions of the Enterprise Server, the <tt>Enumeration</tt> from <tt>request.</tt><tt>getHeaders()</tt> contains
multiple elements (one element per request header) instead of a single, aggregated value.</p><p>The header names used in <tt>HttpServletResponse.add</tt><i>XXX</i><tt>Header()</tt> and <tt>HttpServletResponse.set</tt><i>XXX</i><tt>Header()</tt> are returned as they were
created.</p>

<a name="geqrh"></a><h4>Configuring Valves and Catalina Listeners</h4>
<a name="indexterm-299"></a><a name="indexterm-300"></a><a name="indexterm-301"></a><p>You can configure custom valves and Catalina listeners for web modules or virtual
servers by defining properties. A valve class must implement the <tt>org.apache.catalina.Valve</tt> interface from Tomcat
or previous Enterprise Server releases, or the <tt>org.glassfish.web.valve.GlassFishValve</tt> interface from the current
Enterprise Server release. A listener class for a virtual server must implement the
<tt>org.apache.catalina.ContainerListener</tt> or <tt>org.apache.catalina.LifecycleListener</tt> interface. A listener class for a web module must implement
the <tt>org.apache.catalina.ContainerListener</tt>, <tt>org.apache.catalina.LifecycleListener</tt>, or <tt>org.apache.catalina.InstanceListener</tt> interface.</p><p>In the <tt>sun-web.xml</tt> file, valve and listener properties for a web module look
like this:</p><pre>&#60;sun-web-app ...>
   ...
   &#60;property name="valve_1" value="org.glassfish.extension.Valve"/>
   &#60;property name="listener_1" value="org.glassfish.extension.MyLifecycleListener"/>
&#60;/sun-web-app></pre><p>In the <tt>domain.xml</tt> file, valve and listener properties for a virtual server look
like this:</p><pre>&#60;virtual-server ...>
   ...
   &#60;property name="valve_1" value="org.glassfish.extension.Valve"/>
   &#60;property name="listener_1" value="org.glassfish.extension.MyLifecycleListener"/>
&#60;/virtual-server></pre><p>You can define these properties for a virtual server in one of the
following ways, then restart the server:</p>
<ul><li><p>You can define properties using the <tt>asadmin set</tt> command. For example:</p><pre>asadmin set server-config.http-service.virtual-server.MyVS.property.valve_1="org.glassfish.extension.Valve"</pre></li>
<li><p>You can define virtual server properties using the Administration Console. Select the HTTP Service component under the relevant configuration, select Virtual Servers, and select the desired virtual server. Select Add Property, enter the property name and value, check the enable box, and select Save. For details, click the Help button in the Administration Console.</p></li></ul>


<a name="geqpl"></a><h4>Alternate Document Roots</h4>
<a name="indexterm-302"></a><a name="indexterm-303"></a><p>An alternate document root (docroot) allows a web application to serve requests for
certain resources from outside its own docroot, based on whether those requests match
one (or more) of the URI patterns of the web application's alternate docroots.</p><p>To specify an alternate docroot for a web application or a virtual server,
use the <tt>alternatedocroot_</tt><i>n</i> property, where <i>n</i> is a positive integer that allows specification of
more than one. This property can be a subelement of a <tt>sun-web-app</tt> element
in the <tt>sun-web.xml</tt> file or a <tt>virtual-server</tt> element in the <tt>domain.xml</tt> file. For
more information about these elements, see <a href="http://docs.sun.com/doc/820-4502/beayb?a=view">sun-web-app in <i>Sun GlassFish Enterprise Server v3 Prelude Application Deployment Guide</i></a> and <a href="http://docs.sun.com/doc/820-4507/abhfg?a=view">virtual-server in <i>Sun GlassFish Enterprise Server v3 Prelude Administration Reference</i></a>.</p><p>A virtual server's alternate docroots are considered only if a request does not
map to any of the web modules deployed on that virtual server. A
web module's alternate docroots are considered only once a request has been mapped
to that web module.</p><p>If a request matches an alternate docroot's URI pattern, it is mapped to
the alternate docroot by appending the request URI (minus the web application's context
root) to the alternate docroot's physical location (directory). If a request matches multiple
URI patterns, the alternate docroot is determined according to the following precedence order:</p>
<ul><li><p>Exact match</p></li>
<li><p>Longest path match</p></li>
<li><p>Extension match</p></li></ul>
<p>For example, the following properties specify three docroots. The URI pattern of the
first alternate docroot uses an exact match, whereas the URI patterns of the
second and third alternate docroots use extension and longest path prefix matches, respectively.</p><pre>&#60;property name="alternatedocroot_1" value="from=/my.jpg dir=/srv/images/jpg"/>
&#60;property name="alternatedocroot_2" value="from=*.jpg dir=/srv/images/jpg"/>
&#60;property name="alternatedocroot_3" value="from=/jpg/* dir=/src/images"/></pre><p>The <tt>value</tt> of each alternate docroot has two components: The first component, <tt>from</tt>,
specifies the alternate docroot's URI pattern, and the second component, <tt>dir</tt>, specifies the
alternate docroot's physical location (directory).</p><p>Suppose the above examples belong to a web application deployed at <tt>http://company22.com/myapp</tt>. The
first alternate docroot maps any requests with this URL:</p><pre>http://company22.com/myapp/my.jpg</pre><p>To this resource:</p><pre>/svr/images/jpg/my.jpg</pre><p>The second alternate docroot maps any requests with a <tt>*.jpg</tt> suffix, such
as:</p><pre>http://company22.com/myapp/*.jpg</pre><p>To this physical location:</p><pre>/svr/images/jpg</pre><p>The third alternate docroot maps any requests whose URI starts with <tt>/myapp/jpg/</tt>, such
as:</p><pre>http://company22.com/myapp/jpg/*</pre><p>To the same directory as the second alternate docroot.</p><p>For example, the second alternate docroot maps this request:</p><pre>http://company22.com/myapp/abc/def/my.jpg</pre><p>To:</p><pre>/srv/images/jpg/abc/def/my.jpg</pre><p>The third alternate docroot maps:</p><pre>http://company22.com/myapp/jpg/abc/resource</pre><p>To:</p><pre>/srv/images/jpg/abc/resource</pre><p>If a request does not match any of the target web application's alternate
docroots, or if the target web application does not specify any alternate docroots,
the request is served from the web application's standard docroot, as usual.</p>

<a name="ggjaa"></a><h4>Redirecting URLs</h4>
<a name="indexterm-304"></a><a name="indexterm-305"></a><p>You can specify that a request for an old URL is treated
as a request for a new URL. This is called <b>redirecting</b> a URL.</p><p>To specify a redirected URL for a virtual server, use the <tt>redirect_</tt><i>n</i>
property, where <i>n</i> is a positive integer that allows specification of more than
one. This property is a subelement of a <tt>virtual-server</tt> element in the
<tt>domain.xml</tt> file. For more information about this element, see <a href="http://docs.sun.com/doc/820-4507/abhfg?a=view">virtual-server in <i>Sun GlassFish Enterprise Server v3 Prelude Administration Reference</i></a>. Each of these
<tt>redirect_</tt><i>n</i> properties is inherited by all web applications deployed on the virtual server.
</p><p>The value of each <tt>redirect_</tt><i>n</i> property has two components, which may be specified
in any order:</p><p>The first component, <tt>from</tt>, specifies the prefix of the requested URI to match.</p><p>The second component, <tt>url-prefix</tt>, specifies the new URL prefix to return to the
client. The from prefix is simply replaced by this URL prefix.</p><p>For example:</p><pre>&#60;property name="redirect_1" value="from=/dummy url-prefix=http://etude"/></pre>

<a name="geurd"></a><h4>Using a context.xml File</h4>
<a name="indexterm-306"></a><p>You can define a <tt>context.xml</tt> file for all web applications, for web applications
assigned to a specific virtual server, or for a specific web application.</p><p>To define a global <tt>context.xml</tt> file, place the file in the <i>domain-dir</i><tt>/config</tt> directory
and name it <tt>context.xml</tt>.</p><p>Use the <tt>contextXmlDefault</tt> property to specify the name and the location, relative to
<i>domain-dir</i>, of the <tt>context.xml</tt> file for a specific virtual server. Specify this
property in one of the following ways:</p>
<ul><li><p>In the Administration Console, open the HTTP Service component under the relevant configuration. Open the Virtual Servers component and scroll down to the bottom of the page. Enter <tt>contextXmlDefault</tt> as the property name and the path and file name relative to <i>domain-dir</i> as the property value.</p></li>
<li><p>Use the <tt>asadmin create-virtual-server</tt> command. For example:</p><pre>asadmin create-virtual-server --hosts localhost --property contextXmlDefault=config/vs1context.xml vs1</pre></li>
<li><p>Use the <tt>asadmin set</tt> command for an existing virtual server. For example:</p><pre>asadmin set server-config.http-service.virtual-server.server.property.contextXmlDefault=config/mycontext.xml</pre></li></ul>
<p>To define a <tt>context.xml</tt> file for a specific web application, place the file
in the <tt>META-INF</tt> directory and name it <tt>context.xml</tt>.</p><p>For more information about virtual servers, see <a href="#beafz">Virtual Servers</a>. For more information about the
<tt>context.xml</tt> file, see <a href="http://tomcat.apache.org/tomcat-5.5-doc/config/context.html">The Context Container</a>. Context parameters, environment entries, and resource definitions in <tt>context.xml</tt>
are supported in the Enterprise Server.</p>

<a name="gezcx"></a><h4>Enabling WebDav</h4>
<a name="indexterm-307"></a><p>To enable WebDav in the Enterprise Server, you edit the <tt>web.xml</tt> and
<tt>sun-web.xml</tt> files as follows.</p><p>First, enable the WebDav servlet in your <tt>web.xml</tt> file:</p><pre>&#60;servlet>
   &#60;servlet-name>webdav&#60;/servlet-name>
   &#60;servlet-class>org.apache.catalina.servlets.WebdavServlet&#60;/servlet-class>
   &#60;init-param>
      &#60;param-name>debug&#60;/param-name>
      &#60;param-value>0&#60;/param-value>
   &#60;/init-param>
   &#60;init-param>
      &#60;param-name>listings&#60;/param-name>
      &#60;param-value>true&#60;/param-value>
   &#60;/init-param>
   &#60;init-param>
      &#60;param-name>readonly&#60;/param-name>
      &#60;param-value>false&#60;/param-value>
   &#60;/init-param>
&#60;/servlet></pre><p>Then define the servlet mapping associated with your WebDav servlet in your <tt>web.xml</tt>
file:</p><pre>&#60;servlet-mapping>
   &#60;servlet-name>webdav&#60;/servlet-name>
   &#60;url-pattern>/webdav/*&#60;/url-pattern>
&#60;/servlet-mapping></pre><p>To protect the WebDav servlet so other users can't modify it, add a
security constraint in your <tt>web.xml</tt> file:</p><pre>&#60;security-constraint>
   &#60;web-resource-collection>
      &#60;web-resource-name>Login Resources&#60;/web-resource-name>
      &#60;url-pattern>/webdav/*&#60;/url-pattern>
   &#60;/web-resource-collection>
   &#60;auth-constraint>
      &#60;role-name>Admin&#60;/role-name>
   &#60;/auth-constraint>
   &#60;user-data-constraint>
      &#60;transport-guarantee>NONE&#60;/transport-guarantee>
   &#60;/user-data-constraint>
   &#60;login-config>
      &#60;auth-method>BASIC&#60;/auth-method>
      &#60;realm-name>default&#60;/realm-name>
   &#60;/login-config>
   &#60;security-role>
      &#60;role-name>Admin&#60;/role-name>
   &#60;/security-role>
&#60;/security-constraint></pre><p>Then define a security role mapping in your <tt>sun-web.xml</tt> file:</p><pre>&#60;security-role-mapping>
   &#60;role-name>Admin&#60;/role-name>
   &#60;group-name>Admin&#60;/group-name>
&#60;/security-role-mapping></pre><p>If you are using the <tt>file</tt> realm, create a user and password. For
example:</p><pre>asadmin create-file-user --user admin --host localhost --port 4848 --terse=true 
--groups Admin --authrealmname default admin</pre><p>Enable the security manager as described in <a href="p9.html#gbyah">Enabling and Disabling the Security Manager</a>.</p><p>You can now use any WebDav client by connecting to the WebDav servlet
URL, which has this format:</p><pre>http://<i>host</i>:<i>port</i>/<i>context-root</i>/webdav/<i>file</i></pre><p>For example:</p><pre>http://localhost:80/glassfish-webdav/webdav/index.html</pre><p>You can add the WebDav servlet to your <tt>default-web.xml</tt> file to enable it
for all applications, but you can't set up a security role mapping to
protect it.</p>

<a name="gfaad"></a><h4>Using mod_jk</h4>
<p>To set up <tt>mod_jk</tt>, follow these steps:</p>
<ol><li><p>Obtain and install Apache 2.0.<i>x</i> or 2.2.<i>x</i> HTTP Server (<a href="http://httpd.apache.org/">http://httpd.apache.org/</a>).</p></li>
<li><p>Configure the following files:</p>
<ul><li><p><tt>/etc/httpd/conf/httpd.conf</tt></p></li>
<li><p><tt>/etc/httpd/conf/worker.properties</tt> or <i>domain-dir</i><tt>/config/glassfish-jk.properties</tt> (to use non-default values of attributes described at <a href="http://tomcat.apache.org/tomcat-5.5-doc/config/ajp.html">http://tomcat.apache.org/tomcat-5.5-doc/config/ajp.html</a>)</p></li></ul>
<p>Examples of these files are shown after these steps. If you use both <tt>worker.properties</tt> and <tt>glassfish-jk.properties</tt> files, the file referenced by <tt>httpd.conf</tt>, or referenced by <tt>httpd.conf</tt> first, takes precedence.</p></li>
<li><p>Start <tt>httpd</tt>.</p></li>
<li><p>Enable <tt>mod_jk</tt> using the following command:</p><pre>asadmin set server-config.http-service.http-listener.<i>listener</i>.property.jkEnabled=true</pre><p>For example:</p><pre>asadmin set server-config.http-service.http-listener.http-listener1.property.jkEnabled=true</pre><p>Or you can use the following deprecated command, provided for backward compatibility:</p><pre>asadmin create-jvm-options -Dcom.sun.enterprise.web.connector.enableJK=8009</pre></li>
<li><p>If you are using the <tt>glassfish-jk.properties</tt> file and not referencing it in <tt>httpd.conf</tt>, point to it using the following command:</p><pre>asadmin create-jvm-options 
-Dcom.sun.enterprise.web.connector.enableJK.propertyFile=<i>domain-dir</i>/config/glassfish-jk.properties</pre></li>
<li><p>Restart the Enterprise Server.</p></li></ol>
<p>Here is an example <tt>httpd.conf</tt> file:</p><pre>LoadModule jk_module /usr/lib/httpd/modules/mod_jk.so
JkWorkersFile /etc/httpd/conf/worker.properties
# Where to put jk logs
JkLogFile /var/log/httpd/mod_jk.log
# Set the jk log level [debug/error/info]
JkLogLevel debug
# Select the log format
JkLogStampFormat "[%a %b %d %H:%M:%S %Y] "
# JkOptions indicate to send SSL KEY SIZE,
JkOptions +ForwardKeySize +ForwardURICompat -ForwardDirectories
# JkRequestLogFormat set the request format
JkRequestLogFormat "%w %V %T"
# Send all jsp requests to GlassFish
JkMount /*.jsp worker1
# Send all glassfish-test requests to GlassFish
JkMount /glassfish-test/* worker1</pre><p>Here is an example <tt>worker.properties</tt> or <tt>glassfish-jk.properties</tt> file:</p><pre># Define 1 real worker using ajp13
worker.list=worker1
# Set properties for worker1 (ajp13)
worker.worker1.type=ajp13
worker.worker1.host=localhost.localdomain
worker.worker1.port=8009
worker.worker1.lbfactor=50
worker.worker1.cachesize=10
worker.worker1.cache_timeout=600
worker.worker1.socket_keepalive=1
worker.worker1.socket_timeout=300</pre>

<a name="ghepd"></a><h4>Using SSI</h4>
<a name="indexterm-308"></a><a name="indexterm-309"></a><p>To enable SSI (server-side includes) processing for a specific web module, add the
<tt>SSIServlet</tt> to your <tt>web.xml</tt> file as follows:</p><pre>&#60;web-app>
   &#60;servlet>
      &#60;servlet-name>ssi&#60;/servlet-name>
      &#60;servlet-class>org.apache.catalina.ssi.SSIServlet&#60;/servlet-class>
   &#60;/servlet>
   ...
   &#60;servlet-mapping>
      &#60;servlet-name>ssi&#60;/servlet-name>
      &#60;url-pattern>*.shtml&#60;/url-pattern>
   &#60;/servlet-mapping>
   ...
   &#60;mime-mapping>
      &#60;extension>shtml&#60;/extension>
      &#60;mime-type>text/html&#60;/mime-type>
   &#60;/mime-mapping>
&#60;/web-app></pre><p>To enable SSI processing for all web modules, un-comment the corresponding sections in
the <tt>default-web.xml</tt> file.</p><p>If the <tt>mime-mapping</tt> is not specified in <tt>web.xml</tt>, Enterprise Server attempts to
determine the MIME type from <tt>default-web.xml</tt> or the operating system default.</p><p>You can configure the following <tt>init-param</tt> values for the <tt>SSIServlet</tt>.</p><a name="gheoy"></a><h6>Table&#160;7-2 <tt>SSIServlet</tt> <tt>init-param</tt> Values</h6><table><col width="24%"><col width="10%"><col width="21%"><col width="43%"><tr><th align="left" valign="top" scope="column"><p>init-param</p></th>
<th align="left" valign="top" scope="column"><p>Type</p></th>
<th align="left" valign="top" scope="column"><p>Default</p></th>
<th align="left" valign="top" scope="column"><p>Description</p></th>
</tr>
<tr><td align="left" valign="top" scope="row"><p><tt>buffered</tt></p></td>
<td align="left" valign="top" scope="row"><p><tt>boolean</tt></p></td>
<td align="left" valign="top" scope="row"><p><tt>false</tt></p></td>
<td align="left" valign="top" scope="row"><p>Specifies whether the output
should be buffered.</p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p><tt>debug</tt></p></td>
<td align="left" valign="top" scope="row"><p><tt>int</tt></p></td>
<td align="left" valign="top" scope="row"><p><tt>0</tt> (for no debugging)</p></td>
<td align="left" valign="top" scope="row"><p>Specifies the debugging level. </p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p><tt>expires</tt></p></td>
<td align="left" valign="top" scope="row"><p><tt>Long</tt></p></td>
<td align="left" valign="top" scope="row"><p><tt>Expires</tt> header in
HTTP response not set</p></td>
<td align="left" valign="top" scope="row"><p>Specifies the expiration time in seconds.</p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p><tt>inputEncoding</tt></p></td>
<td align="left" valign="top" scope="row"><p><tt>String</tt></p></td>
<td align="left" valign="top" scope="row"><p>operating system encoding</p></td>
<td align="left" valign="top" scope="row"><p>Specifies encoding
for the SSI input if there is no URL content encoding specified.</p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p><tt>isVirtualWebappRelative</tt></p></td>
<td align="left" valign="top" scope="row"><p><tt>boolean</tt></p></td>
<td align="left" valign="top" scope="row"><p><tt>false</tt> (relative
to the given SSI file)</p></td>
<td align="left" valign="top" scope="row"><p>Specifies whether the virtual path of the <tt>#include</tt>
directive is relative to the <tt>content-root</tt>.</p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p><tt>outputEncoding</tt></p></td>
<td align="left" valign="top" scope="row"><p><tt>String</tt></p></td>
<td align="left" valign="top" scope="row"><p>UTF-8</p></td>
<td align="left" valign="top" scope="row"><p>Specifies encoding for the SSI output.</p></td>
</tr>
</table><p>For more information about SSI, see <a href="http://httpd.apache.org/docs/2.2/mod/mod_include.html">http://httpd.apache.org/docs/2.2/mod/mod_include.html</a>.</p>

<a name="ghepi"></a><h4>Using CGI</h4>
<a name="indexterm-310"></a><a name="indexterm-311"></a><p>To enable CGI (common gateway interface) processing for a specific web module, add
the <tt>CGIServlet</tt> to your <tt>web.xml</tt> file as follows:</p><pre>&#60;web-app>
   &#60;servlet>
      &#60;servlet-name>cgi&#60;/servlet-name>
      &#60;servlet-class>org.apache.catalina.servlets.CGIServlet&#60;/servlet-class>
   &#60;/servlet>
   ...
   &#60;servlet-mapping>
      &#60;servlet-name>cgi&#60;/servlet-name>
      &#60;url-pattern>/cgi-bin/*&#60;/url-pattern>
   &#60;/servlet-mapping>
&#60;/web-app></pre><p>To enable CGI processing for all web modules, un-comment the corresponding sections in
the <tt>default-web.xml</tt> file.</p><p>Package the CGI program under the <tt>cgiPathPrefix</tt>. The default <tt>cgiPathPrefix</tt> is <tt>WEB-INF/cgi</tt>. For security,
it is highly recommended that the contents and binaries of CGI programs be
prohibited from direct viewing or download. For information about hiding directory listings, see
<a href="#beagc">Using the <tt>default-web.xml</tt> File</a>.</p><p>Invoke the CGI program using a URL of the following format:</p><pre>http://<i>host</i>:<i>8080</i>/<i>context-root</i>/cgi-bin/<i>cgi-name</i></pre><p>For example:</p><pre>http://localhost:8080/mycontext/cgi-bin/hello</pre><p>You can configure the following <tt>init-param</tt> values for the <tt>CGIServlet</tt>.</p><a name="ghern"></a><h6>Table&#160;7-3 <tt>CGIServlet</tt> <tt>init-param</tt> Values</h6><table><col width="22%"><col width="10%"><col width="25%"><col width="41%"><tr><th align="left" valign="top" scope="column"><p>init-param</p></th>
<th align="left" valign="top" scope="column"><p>Type</p></th>
<th align="left" valign="top" scope="column"><p>Default</p></th>
<th align="left" valign="top" scope="column"><p>Description</p></th>
</tr>
<tr><td align="left" valign="top" scope="row"><p><tt>cgiPathPrefix</tt></p></td>
<td align="left" valign="top" scope="row"><p><tt>String</tt></p></td>
<td align="left" valign="top" scope="row"><p><tt>WEB-INF/cgi</tt></p></td>
<td align="left" valign="top" scope="row"><p>Specifies the subdirectory containing
the CGI programs.</p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p><tt>debug</tt></p></td>
<td align="left" valign="top" scope="row"><p><tt>int</tt></p></td>
<td align="left" valign="top" scope="row"><p><tt>0</tt> (for no debugging)</p></td>
<td align="left" valign="top" scope="row"><p>Specifies the debugging level. </p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p><tt>executable</tt></p></td>
<td align="left" valign="top" scope="row"><p><tt>String</tt></p></td>
<td align="left" valign="top" scope="row"><p><tt>perl</tt></p></td>
<td align="left" valign="top" scope="row"><p>Specifies the executable
for running the CGI script.</p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p><tt>parameterEncoding</tt></p></td>
<td align="left" valign="top" scope="row"><p><tt>String</tt></p></td>
<td align="left" valign="top" scope="row"><p><tt>System.getProperty("file.encoding", "UTF-8")</tt></p></td>
<td align="left" valign="top" scope="row"><p>Specifies the parameter's encoding.</p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p><tt>passShellEnvironment</tt></p></td>
<td align="left" valign="top" scope="row"><p><tt>boolean</tt></p></td>
<td align="left" valign="top" scope="row"><p><tt>false</tt></p></td>
<td align="left" valign="top" scope="row"><p>Specifies whether to pass shell
environment properties to the CGI program.</p></td>
</tr>
</table><p>To work with a native executable, do the following:</p>
<ol><li><p>Set the value of the <tt>init-param</tt> named <tt>executable</tt> to an empty <tt>String</tt> in the <tt>web.xml</tt> file.</p></li>
<li><p>Make sure the executable has its executable bits set correctly.</p></li>
<li><p>Use directory deployment to deploy the web module. Do not deploy it as a WAR file, because the executable bit information is lost during the process of <tt>jar</tt> and <tt>unjar</tt>. For more information about directory deployment, see the <a href="http://docs.sun.com/doc/820-4502"><i>Sun GlassFish Enterprise Server v3 Prelude Application Deployment Guide</i></a>.</p></li></ol>


<a name="ghett"></a><h4>Using PHP</h4>
<a name="indexterm-312"></a><p>To enable PHP, deploy the Quercus PHP interpreter to the Enterprise Server
as a web module as follows:</p>
<ol><li><p>Download the Quercus interpreter from <a href="http://quercus.caucho.com/">http://quercus.caucho.com/</a>.</p></li>
<li><p>Deploy the WAR file you downloaded to the Enterprise Server.</p></li>
<li><p>To verify that your PHP engine is working, point your browser to the default PHP script that comes with the Quercus interpreter, which is <tt>http://localhost:8080/quercus-3.1.6/</tt>.</p></li>
<li><p>The Quercus application directory is located at <i>domain-dir</i><tt>/applications/quercus-3.1.6/</tt>. Place your PHP application in a subdirectory of the Quercus directory, for example <i>domain-dir</i><tt>/applications/quercus-3.1.6/myapp/</tt>. To point your browser to the PHP application, enter <tt>http://localhost:8080/quercus-3.1.6/myapp/</tt>.</p></li></ol>
<p>For more information about using the Quercus PHP interpreter, see the documentation at
<a href="http://quercus.caucho.com/quercus-3.1/doc/quercus.xtp">http://quercus.caucho.com/quercus-3.1/doc/quercus.xtp</a>.</p>

<a name="ghqyg"></a><h4>Using Scala and Lift</h4>
<a name="indexterm-313"></a><a name="indexterm-314"></a><a name="indexterm-315"></a><p>Scala is a general purpose programming language designed to express common programming patterns
in a concise, elegant, and type-safe way. It smoothly integrates features of object-oriented
and functional languages. It is also fully interoperable with Java. For details, see <a href="http://www.scala-lang.org/">http://www.scala-lang.org/</a>.</p><p>Lift is an expressive and elegant framework for writing web applications using Scala.
Lift stresses the importance of security, maintainability, scalability and performance, while allowing for
high levels of developer productivity. For details, see <a href="http://liftweb.net/index.php/Main_Page">http://liftweb.net/index.php/Main_Page</a>.</p><p>It is common practice to start a Lift web application using Maven. Maven
is a software project management and comprehension tool. Based on the concept of
a project object model (POM), Maven can manage a project's build, reporting and
documentation from a central piece of information. For details, see <a href="http://maven.apache.org/">http://maven.apache.org/</a>.</p><p>To create a new Lift project, use Maven interactively in one of these
ways:</p><pre>mvn archetype:generate -DarchetypeCatalog=http://scala-tools.org/</pre><p>Or:</p><pre>mvn org.apache.maven.plugins:maven-archetype-plugin:1.0-alpha-7:create \ 
 -DarchetypeGroupId=net.liftweb                             \
 -DarchetypeArtifactId=lift-archetype-blank                 \
 -DarchetypeVersion=0.7.1                                   \
 -DremoteRepositories=http://scala-tools.org/repo-releases  \
 -DgroupId=__my.liftapp__ -DartifactId=__liftapp__</pre><p>Or:</p><pre>mvn org.apache.maven.plugins:maven-archetype-plugin:1.0-alpha-7:create \ 
 -DarchetypeGroupId=net.liftweb                             \
 -DarchetypeArtifactId=lift-archetype-basic                 \
 -DarchetypeVersion=0.7.1                                   \
 -DremoteRepositories=http://scala-tools.org/repo-releases  \
 -DgroupId=__my.liftapp__ -DartifactId=__liftapp__</pre><p>After coding your application, build the WAR file using the <tt>mvn package</tt> command.
Then deploy the WAR file to the Enterprise Server as you would any
other web application.</p>


<table border="0" cellpadding="5" cellspacing="0" width="100%">
<tr valign="bottom">
<td></td>
<td style="width: 60%"></td>
<td><a href="p11.html">Previous</a></td>
<td></td>
<td><a href="idx-1.html">Index</a></td>
<td><a href="p13.html">Next</a></td>
</tr>
</table>



</body>
</html>

