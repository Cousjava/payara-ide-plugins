<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-US">
<head>
<meta http-equiv="Content-type" content="text/html; charset=utf-8">
<title>Class Loaders - Sun GlassFish Enterprise Server v3 Prelude Developer's Guide</title>
<meta name="robots" content="index,follow">
<meta name="robots" content="index,follow">
<meta name="date" content="2008-10-01">
</head>

<body>


<table border="0" cellpadding="5" cellspacing="0" width="100%">
<tr><td colspan="5"></td></tr>
<tr>
<td></td>
<td style="width: 60%">&#160;</td>
<td><a href="p5.html">Previous</a></td>
<td></td>
<td><a href="idx-1.html">Index</a></td>
<td><a href="p7.html">Next</a></td>
</tr>
</table>


<a name="beade"></a>Chapter&#160;2<h3>Class Loaders</h3><a name="indexterm-18"></a><p>Understanding Enterprise Server class loaders can help you determine where to place supporting
JAR and resource files for your modules and applications. For general information about
J2SE class loaders, see <a href="http://java.sun.com/developer/technicalArticles/Networking/classloaders/">Understanding Network Class Loaders</a>.</p><p>In a JVM implementation, the class loaders dynamically load a specific Java class
file needed for resolving a dependency. For example, when an instance of <tt>java.util.Enumeration</tt>
needs to be created, one of the class loaders loads the relevant class
into the environment. This section includes the following topics:</p>
<ul><li><p><a href="#beadf">The Class Loader Hierarchy</a></p></li>
<li><p><a href="#gfqpi">Delegation</a></p></li>
<li><p><a href="#beadk">Using the Java Optional Package Mechanism</a></p></li>
<li><p><a href="#gchif">Using the Endorsed Standards Override Mechanism</a></p></li>
<li><p><a href="#beadg">Class Loader Universes</a></p></li>
<li><p><a href="#gatej">Application-Specific Class Loading</a></p></li>
<li><p><a href="#beadh">Circumventing Class Loader Isolation</a></p></li></ul>

<hr><p><b>Note - </b>For GlassFish v3 Prelude, EJB modules are not supported unless the optional EJB
container add-on component is downloaded from the Update Tool. Web services are not supported
unless the optional Metro (JSR 109) add-on component is downloaded from the Update
Tool. For information about the Update Tool, see the <a href="http://docs.sun.com/doc/820-5968"><i>Sun GlassFish Enterprise Server v3 Prelude Installation Guide</i></a>.</p>
<hr>


<a name="beadf"></a><h3>The Class Loader Hierarchy</h3>
<a name="indexterm-19"></a><p>Class loaders in the Enterprise Server runtime follow a delegation hierarchy that is
fully described in <a href="#fvxzq">Table&#160;2-1</a>.</p><a name="fvxzq"></a><h6>Table&#160;2-1 Sun GlassFish Enterprise Server Class Loaders</h6><table><col width="19%"><col width="80%"><tr><th align="left" valign="top" scope="column"><p>Class Loader</p></th>
<th align="left" valign="top" scope="column"><p>Description</p></th>
</tr>
<tr><td align="left" valign="top" scope="row"><p><a name="indexterm-20"></a>Bootstrap</p></td>
<td align="left" valign="top" scope="row"><p>The Bootstrap class loader loads the basic runtime classes
provided by the JVM software.</p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p><a name="indexterm-21"></a>Extension</p></td>
<td align="left" valign="top" scope="row"><p>The Extension class loader loads classes from JAR files
present in the system extensions directory, <i>domain-dir</i><tt>/lib/ext</tt>. It is parent to the Public API
class loader. See <a href="#beadk">Using the Java Optional Package Mechanism</a>.</p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p><a name="indexterm-22"></a>Public API</p></td>
<td align="left" valign="top" scope="row"><p>The Public API class loader makes available all classes
specifically exported by the Enterprise Server runtime for use by deployed applications. This includes,
but is not limited to, Java EE APIs and other Sun GlassFish
APIs. It is parent to the Common class loader.</p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p><a name="indexterm-23"></a>Common</p></td>
<td align="left" valign="top" scope="row"><p><a name="indexterm-24"></a><a name="indexterm-25"></a>The Common class loader loads JAR
files in the <i>as-install</i><tt>/lib</tt> directory, then classes in the <i>domain-dir</i><tt>/lib/classes</tt> directory, followed by JAR
files in the <i>domain-dir</i><tt>/lib</tt> directory. Using <i>domain-dir</i><tt>/lib/classes</tt> or <i>domain-dir</i><tt>/lib</tt> is recommended whenever possible,
and required for custom login modules and realms. It is parent to the
Connector class loader. See <a href="#beadj">Using the Common Class Loader</a>.</p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p><a name="indexterm-26"></a>Connector</p></td>
<td align="left" valign="top" scope="row"><p>The Connector class loader is a single class loader
instance that loads individually deployed connector modules, which are shared across all applications. It
is parent to the Applib class loader.</p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p><a name="indexterm-27"></a>Applib</p></td>
<td align="left" valign="top" scope="row"><p>The Applib class loader loads the
library classes, specified during deployment, for a specific enabled module; see <a href="#gatej">Application-Specific Class Loading</a>. One instance of
this class loader is present in each class loader universe; see <a href="#beadg">Class Loader Universes</a>. It is
parent to the Archive class loader.</p><p>When multiple deployed applications use the same
library, they share the same instance of the library. One library cannot reference classes
from another library.</p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p><a name="indexterm-28"></a>Archive</p></td>
<td align="left" valign="top" scope="row"><p>The Archive class loader loads classes from the WAR and JAR
files or directories (for directory deployment) of modules deployed to the Enterprise Server.
This class loader also loads any application-specific classes generated by the Enterprise Server
runtime, such as stub classes or servlets generated by JSP pages.</p></td>
</tr>
</table>

<a name="gfqpi"></a><h3>Delegation</h3>
<p><a name="indexterm-29"></a>Note that the class loader hierarchy is not a Java inheritance hierarchy, but
a delegation hierarchy. In the delegation design, a class loader delegates class loading
to its parent before attempting to load a class itself. If the parent
class loader cannot load a class, the class loader attempts to load the
class itself. In effect, a class loader is responsible for loading only the
classes not available to the parent. Classes loaded by a class loader higher
in the hierarchy cannot refer to classes available lower in the hierarchy.</p>

<a name="beadk"></a><h3>Using the Java Optional Package Mechanism</h3>
<a name="indexterm-30"></a><p>Optional packages are packages of Java classes and associated native code that application
developers can use to extend the functionality of the core platform.</p><p>To use the Java optional package mechanism, copy the JAR files into the
<i>domain-dir</i><tt>/lib/ext</tt> directory, then restart the server.</p><p>For more information, see <a href="http://java.sun.com/j2se/1.5.0/docs/guide/extensions/extensions.html">Optional Packages - An Overview</a> and <a href="http://java.sun.com/docs/books/tutorial/ext/basics/load.html">Understanding Extension Class Loading</a>.</p>

<a name="gchif"></a><h3>Using the Endorsed Standards Override Mechanism</h3>
<a name="indexterm-31"></a><p>Endorsed standards handle changes to classes and APIs that are bundled in the
JDK but are subject to change by external bodies.</p><p>To use the endorsed standards override mechanism, copy the JAR files into the
<i>domain-dir</i><tt>/lib/endorsed</tt> directory, then restart the server.</p><p>For more information and the list of packages that can be overridden, see
<a href="http://java.sun.com/j2se/1.5.0/docs/guide/standards/">Endorsed Standards Override Mechanism</a>.</p>

<a name="beadg"></a><h3>Class Loader Universes</h3>
<a name="indexterm-32"></a><a name="indexterm-33"></a><p>Access to components within modules installed on the server occurs within the context
of isolated class loader universes, each of which has its own Applib and
Archive class loaders.</p>
<ul><li><p><b>Individually Deployed Module Universe</b> &#8211; Each individually deployed EJB JAR or web WAR has its own class loader universe, which loads the classes in the module.</p></li></ul>
<p>A resource such as a file that is accessed by a servlet,
JSP, or EJB component must be in one of the following locations:</p>
<ul><li><p>A directory pointed to by the Libraries field or <tt>--libraries</tt> option used during deployment</p></li>
<li><p>A directory pointed to by the module&#8217;s classpath; for example, a web module&#8217;s classpath includes these directories:</p><pre><i>module-name</i>/WEB-INF/classes
<i>module-name</i>/WEB-INF/lib</pre></li></ul>


<a name="gatej"></a><h3>Application-Specific Class Loading</h3>
<a name="indexterm-34"></a><a name="indexterm-35"></a><a name="indexterm-36"></a><p>You can specify module-specific library classes during deployment in one of the following
ways:</p>
<ul><li><p><a name="indexterm-37"></a>Use the Administration Console. Open the Applications component, then go to the page for the type of module. Select the Deploy button. Type the comma-separated paths in the Libraries field. For details, click the Help button in the Administration Console.</p></li>
<li><p><a name="indexterm-38"></a><a name="indexterm-39"></a>Use the <tt>asadmin deploy</tt> command with the <tt>--libraries</tt> option and specify comma-separated paths. For details, see the <a href="http://docs.sun.com/doc/820-4497"><i>Sun GlassFish Enterprise Server v3 Prelude Reference Manual</i></a>.</p></li></ul>
<p>Application libraries are included in the Applib class loader. Paths to libraries can
be relative or absolute. A relative path is relative to <i>domain-dir</i><tt>/lib/applibs</tt>. If the
path is absolute, the path must be accessible to the domain administration server (DAS).</p><p>If multiple modules refer to the same libraries, classes in those libraries are
automatically shared. This can reduce the memory footprint and allow sharing of static information.
However, modules using application-specific libraries are not portable. Other ways to make libraries available
are described in <a href="#beadh">Circumventing Class Loader Isolation</a>.</p><p>One library cannot reference classes from another library.</p><p>For general information about deployment, see the <a href="http://docs.sun.com/doc/820-4502"><i>Sun GlassFish Enterprise Server v3 Prelude Application Deployment Guide</i></a>.</p>
<hr><p><b>Note - </b>If you see an access control error message when you try to use
a library, you may need to grant permission to the library in the
<tt>server.policy</tt> file. For more information, see <a href="p9.html#beabz">Changing Permissions for an Application</a>.</p>
<hr>


<a name="beadh"></a><h3>Circumventing Class Loader Isolation</h3>
<a name="indexterm-40"></a><a name="indexterm-41"></a><p>Since each module class loader universe is isolated, a module cannot load classes from
another module. This prevents two similarly named classes in different modules from interfering with
each other.</p><p><a name="indexterm-42"></a><a name="indexterm-43"></a>To circumvent this limitation for libraries, utility classes, or individually deployed modules, you can
include the relevant path to the required classes. See <a href="#beadj">Using the Common Class Loader</a>.</p>

<a name="beadj"></a><h4>Using the Common Class Loader</h4>
<a name="indexterm-44"></a><p>To use the Common class loader, copy the JAR files into the
<i>domain-dir</i><tt>/lib</tt> or <i>as-install</i><tt>/lib</tt> directory or copy the <tt>.class</tt> files into the <i>domain-dir</i><tt>/lib/classes</tt> directory,
then restart the server.</p><p>Using the Common class loader makes a module accessible to all modules deployed on
servers that share the same configuration.</p><p><a name="indexterm-45"></a>For example, using the Common class loader is the recommended way of adding
JDBC drivers to the Enterprise Server. For a list of the JDBC drivers
currently supported by the Enterprise Server, see the <i><a href="http://docs.sun.com/doc/820-4494"><i>Sun GlassFish Enterprise Server v3 Prelude Release Notes</i></a></i>. For configurations of supported and
other drivers, see <a href="http://docs.sun.com/doc/820-4495/beamw?a=view">Configuration Specifics for JDBC Drivers in <i>Sun GlassFish Enterprise Server v3 Prelude Administration Guide</i></a>.</p><p>To activate custom login modules and realms, place the JAR files in the
<i>domain-dir</i><tt>/lib</tt> directory or the class files in the <i>domain-dir</i><tt>/lib/classes</tt> directory, then restart the server.</p>


<table border="0" cellpadding="5" cellspacing="0" width="100%">
<tr valign="bottom">
<td></td>
<td style="width: 60%"></td>
<td><a href="p5.html">Previous</a></td>
<td></td>
<td><a href="idx-1.html">Index</a></td>
<td><a href="p7.html">Next</a></td>
</tr>
</table>



</body>
</html>

