<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-US">
<head>
<meta http-equiv="Content-type" content="text/html; charset=utf-8">
<title>Using the Java Persistence API - Sun GlassFish Enterprise Server 2.1 Developer's Guide</title>
<meta name="robots" content="index,follow">
<meta name="robots" content="index,follow">
<meta name="date" content="2009-01-01">
</head>

<body>


<table border="0" cellpadding="5" cellspacing="0" width="100%">
<tr><td colspan="5"></td></tr>
<tr>
<td></td>
<td style="width: 60%">&#160;</td>
<td><a href="p11.html">Previous</a></td>
<td></td>
<td><a href="idx-1.html">Index</a></td>
<td><a href="p13.html">Next</a></td>
</tr>
</table>


<a name="gbxjk"></a>Chapter&#160;7<h3>Using the Java Persistence API</h3><a name="indexterm-392"></a><a name="indexterm-393"></a><p><a name="indexterm-394"></a><a name="indexterm-395"></a>Sun GlassFish Enterprise Server support for the Java Persistence API includes all required
features described in the Java Persistence Specification. Although officially part of the Enterprise
JavaBeans Specification v3.0, also known as <a href="http://jcp.org/en/jsr/detail?id=220">JSR 220</a>, the Java Persistence API can also be
used with non-EJB components outside the EJB container.</p><p>The Java Persistence API provides an object/relational mapping facility to Java developers for
managing relational data in Java applications. For basic information about the Java Persistence
API, see &#8220;Part Four: Persistence&#8221; in the <a href="http://java.sun.com/javaee/5/docs/tutorial/doc/index.html">Java EE 5 Tutorial</a>.</p><p>This chapter contains Enterprise Server specific information on using the Java Persistence API
in the following topics:</p>
<ul><li><p><a href="#gbwmj">Specifying the Database</a></p></li>
<li><p><a href="#gcnvb">Additional Database Properties</a></p></li>
<li><p><a href="#gdpwv">Configuring the Cache</a></p></li>
<li><p><a href="#gdpwu">Setting the Logging Level</a></p></li>
<li><p><a href="#gertw">Using Lazy Loading</a></p></li>
<li><p><a href="#gescc">Primary Key Generation Defaults</a></p></li>
<li><p><a href="#gbwlh">Automatic Schema Generation</a></p></li>
<li><p><a href="#gbzgp">Query Hints</a></p></li>
<li><p><a href="#gdkwf">Changing the Persistence Provider</a></p></li>
<li><p><a href="#gbxjh">Restrictions and Optimizations</a></p></li></ul>

<hr><p><b>Note - </b><a name="indexterm-396"></a><a name="indexterm-397"></a>The default persistence provider in the Enterprise Server is based on Oracle's TopLink
Essentials Java Persistence API implementation. All configuration options in TopLink Essentials are available to
applications that use the Enterprise Server's default persistence provider.</p>
<hr>


<a name="gbwmj"></a><h3>Specifying the Database</h3>
<a name="indexterm-398"></a><a name="indexterm-399"></a><a name="indexterm-400"></a><a name="indexterm-401"></a><p>The Enterprise Server uses the bundled Java DB (Derby) database by default. If
the <tt>transaction-type</tt> element is omitted or specified as <tt>JTA</tt> and both the <tt>jta-data-source</tt>
and <tt>non-jta-data-source</tt> elements are omitted in the <tt>persistence.xml</tt> file, Java DB is used as
a JTA data source. If <tt>transaction-type</tt> is specified as <tt>RESOURCE_LOCAL</tt> and both <tt>jta-data-source</tt>
and <tt>non-jta-data-source</tt> are omitted, Java DB is used as a non-JTA data source.</p><p>To use a non-default database, either specify a value for the <tt>jta-data-source</tt>
element, or set the <tt>transaction-type</tt> element to <tt>RESOURCE_LOCAL</tt> and specify a value for
the <tt>non-jta-data-source</tt> element.</p><p><a name="indexterm-402"></a>If you are using the default persistence provider, the provider attempts to automatically
detect the database based on the connection metadata. You can specify the optional
<tt>toplink.platform.class.name</tt> property to guarantee that the database is correct. For example:</p><pre>&#60;?xml version="1.0" encoding="UTF-8"?>
    &#60;persistence xmlns="http://java.sun.com/xml/ns/persistence">
        &#60;persistence-unit name ="em1">
            &#60;jta-data-source>jdbc/MyDB2DB&#60;/jta-data-source>
            &#60;properties>
                &#60;property name="toplink.platform.class.name" 
                    value="oracle.toplink.essentials.platform.database.DB2Platform"/>
            &#60;/properties>
        &#60;/persistence-unit>
    &#60;/persistence></pre><p>The following <tt>toplink.platform.class.name</tt> property values are allowed. Supported platforms have been tested with
the Enterprise Server and are found to be Java EE compatible.</p><pre>//Supported platforms
oracle.toplink.essentials.platform.database.DerbyPlatform
oracle.toplink.essentials.platform.database.oracle.OraclePlatform
oracle.toplink.essentials.platform.database.SQLServerPlatform
oracle.toplink.essentials.platform.database.DB2Platform
oracle.toplink.essentials.platform.database.SybasePlatform
oracle.toplink.essentials.platform.database.CloudscapePlatform
oracle.toplink.essentials.platform.database.MySQL4Platform
oracle.toplink.essentials.platform.database.PointBasePlatform
oracle.toplink.essentials.platform.database.PostgreSQLPlatform

//Others available
oracle.toplink.essentials.platform.database.InformixPlatform
oracle.toplink.essentials.platform.database.TimesTenPlatform
oracle.toplink.essentials.platform.database.AttunityPlatform
oracle.toplink.essentials.platform.database.HSQLPlatform
oracle.toplink.essentials.platform.database.SQLAnyWherePlatform
oracle.toplink.essentials.platform.database.DBasePlatform
oracle.toplink.essentials.platform.database.DB2MainframePlatform
oracle.toplink.essentials.platform.database.AccessPlatform</pre><p>To use the Java Persistence API outside the EJB container (in Java SE
mode), do not specify the <tt>jta-data-source</tt> or <tt>non-jta-data-source</tt> elements if the <tt>DataSource</tt>
is not available. Instead, specify the <tt>provider</tt> element and any additional properties required by
the JDBC driver or the database. For example:</p><pre>&#60;?xml version="1.0" encoding="UTF-8"?>
    &#60;persistence xmlns="http://java.sun.com/xml/ns/persistence">
        &#60;persistence-unit name ="em2">
            &#60;provider>oracle.toplink.essentials.ejb.cmp3.EntityManagerFactoryProvider&#60;/provider>
            &#60;transaction-type>RESOURCE_LOCAL&#60;transaction-type>
            &#60;non-jta-data-source>jdbc/MyDB2DB&#60;/non-jta-data-source>
            &#60;properties>
                &#60;property name="toplink.platform.class.name" 
                    value="oracle.toplink.essentials.platform.database.DB2Platform"/>
                &#60;!-- JDBC connection properties -->
                &#60;property name="toplink.jdbc.driver" value="org.apache.derby.jdbc.ClientDriver"/>
                &#60;property name="toplink.jdbc.url" 
value="jdbc:derby://localhost:1527/testdb;retrieveMessagesFromServerOnGetMessage=true;create=true;"/>
                &#60;property name="toplink.jdbc.user" value="APP"/>
                &#60;property name="toplink.jdbc.password" value="APP"/>
            &#60;/properties>
        &#60;/persistence-unit>
    &#60;/persistence></pre><p>For more information about <tt>toplink</tt> properties, see <a href="#gcnvb">Additional Database Properties</a>.</p><p>For a list of the JDBC drivers currently supported by the Enterprise
Server, see the <a href="http://docs.sun.com/doc/820-4329"><i>Sun GlassFish Enterprise Server 2.1 Release Notes</i></a>. For configurations of supported and other drivers, see <a href="http://docs.sun.com/doc/820-4335/beamw?a=view">Configurations for Specific JDBC Drivers in <i>Sun GlassFish Enterprise Server 2.1 Administration Guide</i></a>.</p><p>To change the persistence provider, see <a href="#gdkwf">Changing the Persistence Provider</a>.</p>

<a name="gcnvb"></a><h3>Additional Database Properties</h3>
<a name="indexterm-403"></a><a name="indexterm-404"></a><p>If you are using the default persistence provider, you can specify in the
<tt>persistence.xml</tt> file the database properties listed at <i>Persistence Unit Extensions</i> in <a href="http://www.oracle.com/technology/products/ias/toplink/jpa/essentials/toplink-jpa-extensions.html">TopLink JPA Extensions Reference</a>. </p><p>For schema generation properties, see <a href="#gbwmk">Generation Options</a>. For query hints, see <a href="#gbzgp">Query Hints</a>.</p>

<a name="gdpwv"></a><h3>Configuring the Cache</h3>
<p>If you are using the default persistence provider, you can configure whether caching
occurs, the type of caching, the size of the cache, and whether client
sessions share the cache. Caching properties for the default persistence provider are described
in detail at <i>Extensions for Caching</i> in <a href="http://www.oracle.com/technology/products/ias/toplink/jpa/essentials/toplink-jpa-extensions.html">TopLink JPA Extensions Reference</a>.</p>

<a name="gdpwu"></a><h3>Setting the Logging Level</h3>
<p>One of the default persistence provider's database properties that you can set in
the <tt>persistence.xml</tt> file is <tt>toplink.logging.level</tt>. For example, setting the logging level to <tt>FINE</tt>
or higher logs all SQL statements. For details about this property, see <i>Extensions for Logging</i>
in<a href="http://www.oracle.com/technology/products/ias/toplink/jpa/essentials/toplink-jpa-extensions.html">TopLink JPA Extensions Reference</a>.</p><p>You can also set the TopLink Essentials logging level globally in the Application
Server in any of the following ways:</p>
<ul><li><p>Set a <tt>module-log-levels</tt> property using the <tt>asadmin</tt> command. For example:</p><pre>asadmin set --user adminuser "server.log-service.module-log-levels.property.oracle\.toplink\.essentials"=FINE</pre></li>
<li><p>Set a JVM option using the <tt>asadmin</tt> command. For example:</p><pre>asadmin create-jvm-options --user adminuser -Dtoplink.logging.level=FINE</pre></li>
<li><p>Set a <tt>module-log-levels</tt> property using the Admin Console. In the developer profile, select the Application Server component and the Logging tab. In the cluster profile, select the Logger Settings component under the relevant configuration. Select the Log Levels tab. Then scroll down to Additional Module Log Level Properties, select Add Property, type <tt>oracle.toplink.essentials</tt> in the Name field, and type the desired logging level in the Value field.</p></li></ul>
<p>Setting the logging level to <tt>OFF</tt> disables TopLink Essentials logging. A logging level
set in the <tt>persistence.xml</tt> file takes precedence over the global logging level.</p><p>You can set the logging level for Java Persistence in general using the
Admin Console. In the developer profile, select the Application Server component and the
Logging tab. In the cluster profile, select the Logger Settings component under the
relevant configuration. Select the Log Levels tab. Then set the logging level for
Persistence. Setting the logging level to <tt>OFF</tt> disables Java Persistence logging.</p>

<a name="gertw"></a><h3>Using Lazy Loading</h3>
<p>The default persistence provider treats only <tt>OneToOne</tt>, <tt>ManyToOne</tt>, <tt>OneToMany</tt>, and <tt>ManyToMany</tt> mappings
specially when they are annotated as <tt>LAZY</tt>. <tt>OneToMany</tt> and <tt>ManyToMany</tt> mappings are loaded
lazily by default in compliance with the Java Persistence Specification. Other mappings are
always loaded eagerly. For <tt>OneToOne</tt> and <tt>ManyToOne</tt> mappings, value holder indirection is
used. For <tt>OneToMany</tt> and <tt>ManyToMany</tt> mappings, transparent indirection is used.</p><p>For basic information about lazy loading, see <i>Lazy Loading</i> in <a href="http://www.oracle.com/technology/products/ias/toplink/jpa/essentials/toplink-jpa-extensions.html">TopLink JPA Extensions Reference</a>. For details about
indirection, see <i>Indirection</i> in <a href="http://www.oracle.com/technology/products/ias/toplink/doc/10131/main/_html/mapun002.htm">Mapping Concepts</a>.</p>

<a name="gescc"></a><h3>Primary Key Generation Defaults</h3>
<p>In the descriptions of the <tt>@GeneratedValue</tt>, <tt>@SequenceGenerator</tt>, and <tt>@TableGenerator</tt> annotations in the Java
Persistence Specification, certain defaults are noted as specific to the persistence provider. The
default persistence provider's primary key generation defaults are listed here.</p><p><tt>@GeneratedValue</tt> defaults are as follows:</p>
<ul><li><p>Using <tt>strategy=AUTO</tt> (or no <tt>strategy</tt>) creates a <tt>@TableGenerator</tt> named <tt>SEQ_GEN</tt> with default settings. Specifying a <tt>generator</tt> has no effect.</p></li>
<li><p>Using <tt>strategy=TABLE</tt> without specifying a <tt>generator</tt> creates a <tt>@TableGenerator</tt> named <tt>SEQ_GEN_TABLE</tt> with default settings. Specifying a <tt>generator</tt> but no <tt>@TableGenerator</tt> creates and names a <tt>@TableGenerator</tt> with default settings.</p></li>
<li><p>Using <tt>strategy=IDENTITY</tt> or <tt>strategy=SEQUENCE</tt> produces the same results, which are database-specific.</p>
<ul><li><p>For Oracle databases, not specifying a <tt>generator</tt> creates a <tt>@SequenceGenerator</tt> named <tt>SEQ_GEN_SEQUENCE</tt> with default settings. Specifying a <tt>generator</tt> but no <tt>@SequenceGenerator</tt> creates and names a <tt>@SequenceGenerator</tt> with default settings.</p></li>
<li><p>For PostgreSQL databases, a <tt>SERIAL</tt> column named <i>entity-table</i><tt>_</tt><i>pk-column</i><tt>_SEQ</tt> is created.</p></li>
<li><p>For MySQL databases, an <tt>AUTO_INCREMENT</tt> column is created.</p></li>
<li><p>For other supported databases, an <tt>IDENTITY</tt> column is created.</p></li></ul>
</li></ul>
<p>The <tt>@SequenceGenerator</tt> annotation has one default specific to the default provider. The default
<tt>sequenceName</tt> is the specified <tt>name</tt>.</p><p><tt>@TableGenerator</tt> defaults are as follows:</p>
<ul><li><p>The default <tt>table</tt> is <tt>SEQUENCE</tt>.</p></li>
<li><p>The default <tt>pkColumnName</tt> is <tt>SEQ_NAME</tt>.</p></li>
<li><p>The default <tt>valueColumnName</tt> is <tt>SEQ_COUNT</tt>.</p></li>
<li><p>The default <tt>pkColumnValue</tt> is the specified <tt>name</tt>, or the default <tt>name</tt> if no <tt>name</tt> is specified.</p></li></ul>


<a name="gbwlh"></a><h3>Automatic Schema Generation</h3>
<p>The automatic schema generation feature of the Enterprise Server defines database tables based
on the fields or properties in entities and the relationships between the fields
or properties. This insulates developers from many of the database related aspects of
development, allowing them to focus on entity development. The resulting schema is usable as-is
or can be given to a database administrator for tuning with respect to
performance, security, and so on. This section covers the following topics:</p>
<ul><li><p><a href="#gcjgl">Annotations</a></p></li>
<li><p><a href="#gcmaz">Supported Data Types</a></p></li>
<li><p><a href="#gbwmk">Generation Options</a></p></li></ul>

<hr><p><b>Note - </b>Automatic schema generation is supported on an all-or-none basis: it expects that no
tables exist in the database before it is executed. It is not intended
to be used as a tool to generate extra tables or constraints.</p><p>Deployment won't fail if all tables are not created, and undeployment won't fail
if not all tables are dropped. Instead, an error is written to the
server log. This is done to allow you to investigate the problem and
fix it manually. You should not rely on the partially created database schema
to be correct for running the application.</p>
<hr>


<a name="gcjgl"></a><h4>Annotations</h4>
<a name="indexterm-405"></a><a name="indexterm-406"></a><p>The following annotations are used in automatic schema generation: <tt>@AssociationOverride</tt>, <tt>@AssociationOverrides</tt>, <tt>@AttributeOverride</tt>,
<tt>@AttributeOverrides</tt>, <tt>@Column</tt>, <tt>@DiscriminatorColumn</tt>, <tt>@DiscriminatorValue</tt>, <tt>@Embedded</tt>, <tt>@EmbeddedId</tt>, <tt>@GeneratedValue</tt>, <tt>@Id</tt>, <tt>@IdClass</tt>, <tt>@JoinColumn</tt>, <tt>@JoinColumns</tt>, <tt>@JoinTable</tt>,
<tt>@Lob</tt>, <tt>@ManyToMany</tt>, <tt>@ManyToOne</tt>, <tt>@OneToMany</tt>, <tt>@OneToOne</tt>, <tt>@PrimaryKeyJoinColumn</tt>, <tt>@PrimaryKeyJoinColumns</tt>, <tt>@SecondaryTable</tt>, <tt>@SecondaryTables</tt>, <tt>@SequenceGenerator</tt>, <tt>@Table</tt>, <tt>@TableGenerator</tt>,
<tt>@UniqueConstraint</tt>, and <tt>@Version</tt>. For information about these annotations, see the Java Persistence Specification.</p><p>For <tt>@Column</tt> annotations, the <tt>insertable</tt> and <tt>updatable</tt> elements are not used in automatic
schema generation.</p><p>For <tt>@OneToMany</tt> and <tt>@ManyToOne</tt> annotations, no <tt>ForeignKeyConstraint</tt> is created in the resulting DDL files.</p>

<a name="gcmaz"></a><h4>Supported Data Types</h4>
<a name="indexterm-407"></a><a name="indexterm-408"></a><p>The following table shows mappings of Java types to SQL types when the
default persistence provider and automatic schema generation are used.</p><a name="gcmau"></a><h6>Table&#160;7-1 Java Type to SQL Type Mappings</h6><table><col width="25%"><col width="12%"><col width="12%"><col width="12%"><col width="12%"><col width="12%"><col width="12%"><tr><th align="left" valign="top" scope="column"><p>Java Type</p></th>
<th align="left" valign="top" scope="column"><p>Java DB, Derby, CloudScape</p></th>
<th align="left" valign="top" scope="column"><p>Oracle</p></th>
<th align="left" valign="top" scope="column"><p>DB2</p></th>
<th align="left" valign="top" scope="column"><p>Sybase</p></th>
<th align="left" valign="top" scope="column"><p>MS-SQL
Server</p></th>
<th align="left" valign="top" scope="column"><p>MySQL Server</p></th>
</tr>
<tr><td align="left" valign="top" scope="row"><p><tt>boolean</tt>, <tt>java.lang.Boolean</tt></p></td>
<td align="left" valign="top" scope="row"><p><tt>SMALLINT</tt></p></td>
<td align="left" valign="top" scope="row"><p><tt>NUMBER(1)</tt></p></td>
<td align="left" valign="top" scope="row"><p><tt>SMALLINT</tt></p></td>
<td align="left" valign="top" scope="row"><p><tt>BIT</tt></p></td>
<td align="left" valign="top" scope="row"><p><tt>BIT</tt></p></td>
<td align="left" valign="top" scope="row"><p><tt>TINYINT(1)</tt></p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p><tt>int</tt>, <tt>java.lang.Integer</tt></p></td>
<td align="left" valign="top" scope="row"><p><tt>INTEGER</tt></p></td>
<td align="left" valign="top" scope="row"><p><tt>NUMBER(10)</tt></p></td>
<td align="left" valign="top" scope="row"><p><tt>INTEGER</tt></p></td>
<td align="left" valign="top" scope="row"><p><tt>INTEGER</tt></p></td>
<td align="left" valign="top" scope="row"><p><tt>INTEGER</tt></p></td>
<td align="left" valign="top" scope="row"><p><tt>INTEGER</tt></p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p><tt>long</tt>, <tt>java.lang.Long</tt></p></td>
<td align="left" valign="top" scope="row"><p><tt>BIGINT</tt></p></td>
<td align="left" valign="top" scope="row"><p><tt>NUMBER(19)</tt></p></td>
<td align="left" valign="top" scope="row"><p><tt>INTEGER</tt></p></td>
<td align="left" valign="top" scope="row"><p><tt>NUMERIC(19)</tt></p></td>
<td align="left" valign="top" scope="row"><p><tt>NUMERIC(19)</tt></p></td>
<td align="left" valign="top" scope="row"><p><tt>BIGINT</tt></p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p><tt>float</tt>, <tt>java.lang.Float</tt></p></td>
<td align="left" valign="top" scope="row"><p><tt>FLOAT</tt></p></td>
<td align="left" valign="top" scope="row"><p><tt>NUMBER(19,4)</tt></p></td>
<td align="left" valign="top" scope="row"><p><tt>FLOAT</tt></p></td>
<td align="left" valign="top" scope="row"><p><tt>FLOAT(16)</tt></p></td>
<td align="left" valign="top" scope="row"><p><tt>FLOAT(16)</tt></p></td>
<td align="left" valign="top" scope="row"><p><tt>FLOAT</tt></p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p><tt>double</tt>, <tt>java.lang.Double</tt></p></td>
<td align="left" valign="top" scope="row"><p><tt>FLOAT</tt></p></td>
<td align="left" valign="top" scope="row"><p><tt>NUMBER(19,4)</tt></p></td>
<td align="left" valign="top" scope="row"><p><tt>FLOAT</tt></p></td>
<td align="left" valign="top" scope="row"><p><tt>FLOAT(32)</tt></p></td>
<td align="left" valign="top" scope="row"><p><tt>FLOAT(32)</tt></p></td>
<td align="left" valign="top" scope="row"><p><tt>DOUBLE</tt></p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p><tt>short</tt>, <tt>java.lang.Short</tt></p></td>
<td align="left" valign="top" scope="row"><p><tt>SMALLINT</tt></p></td>
<td align="left" valign="top" scope="row"><p><tt>NUMBER(5)</tt></p></td>
<td align="left" valign="top" scope="row"><p><tt>SMALLINT</tt></p></td>
<td align="left" valign="top" scope="row"><p><tt>SMALLINT</tt></p></td>
<td align="left" valign="top" scope="row"><p><tt>SMALLINT</tt></p></td>
<td align="left" valign="top" scope="row"><p><tt>SMALLINT</tt></p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p><tt>byte</tt>, <tt>java.lang.Byte</tt></p></td>
<td align="left" valign="top" scope="row"><p><tt>SMALLINT</tt></p></td>
<td align="left" valign="top" scope="row"><p><tt>NUMBER(3)</tt></p></td>
<td align="left" valign="top" scope="row"><p><tt>SMALLINT</tt></p></td>
<td align="left" valign="top" scope="row"><p><tt>SMALLINT</tt></p></td>
<td align="left" valign="top" scope="row"><p><tt>SMALLINT</tt></p></td>
<td align="left" valign="top" scope="row"><p><tt>SMALLINT</tt></p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p><tt>java.lang.Number</tt></p></td>
<td align="left" valign="top" scope="row"><p><tt>DECIMAL</tt></p></td>
<td align="left" valign="top" scope="row"><p><tt>NUMBER(38)</tt></p></td>
<td align="left" valign="top" scope="row"><p><tt>DECIMAL(15)</tt></p></td>
<td align="left" valign="top" scope="row"><p><tt>NUMERIC(38)</tt></p></td>
<td align="left" valign="top" scope="row"><p><tt>NUMERIC(28)</tt></p></td>
<td align="left" valign="top" scope="row"><p><tt>DECIMAL(38)</tt></p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p><tt>java.math.BigInteger</tt></p></td>
<td align="left" valign="top" scope="row"><p><tt>BIGINT</tt></p></td>
<td align="left" valign="top" scope="row"><p><tt>NUMBER(38)</tt></p></td>
<td align="left" valign="top" scope="row"><p><tt>BIGINT</tt></p></td>
<td align="left" valign="top" scope="row"><p><tt>NUMERIC(38)</tt></p></td>
<td align="left" valign="top" scope="row"><p><tt>NUMERIC(28)</tt></p></td>
<td align="left" valign="top" scope="row"><p><tt>BIGINT</tt></p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p><tt>java.math.BigDecimal</tt></p></td>
<td align="left" valign="top" scope="row"><p><tt>DECIMAL</tt></p></td>
<td align="left" valign="top" scope="row"><p><tt>NUMBER(38)</tt></p></td>
<td align="left" valign="top" scope="row"><p><tt>DECIMAL(15)</tt></p></td>
<td align="left" valign="top" scope="row"><p><tt>NUMERIC(38)</tt></p></td>
<td align="left" valign="top" scope="row"><p><tt>NUMERIC(28)</tt></p></td>
<td align="left" valign="top" scope="row"><p><tt>DECIMAL(38)</tt></p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p><tt>java.lang.String</tt></p></td>
<td align="left" valign="top" scope="row"><p><tt>VARCHAR(255)</tt></p></td>
<td align="left" valign="top" scope="row"><p><tt>VARCHAR(255)</tt></p></td>
<td align="left" valign="top" scope="row"><p><tt>VARCHAR(255)</tt></p></td>
<td align="left" valign="top" scope="row"><p><tt>VARCHAR(255)</tt></p></td>
<td align="left" valign="top" scope="row"><p><tt>VARCHAR(255)</tt></p></td>
<td align="left" valign="top" scope="row"><p><tt>VARCHAR(255)</tt></p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p><tt>char</tt>, <tt>java.lang.Character</tt></p></td>
<td align="left" valign="top" scope="row"><p><tt>CHAR(1)</tt></p></td>
<td align="left" valign="top" scope="row"><p><tt>CHAR(1)</tt></p></td>
<td align="left" valign="top" scope="row"><p><tt>CHAR(1)</tt></p></td>
<td align="left" valign="top" scope="row"><p><tt>CHAR(1)</tt></p></td>
<td align="left" valign="top" scope="row"><p><tt>CHAR(1)</tt></p></td>
<td align="left" valign="top" scope="row"><p><tt>CHAR(1)</tt></p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p><tt>byte[]</tt>, <tt>java.lang.Byte[]</tt>, <tt>java.sql.Blob</tt></p></td>
<td align="left" valign="top" scope="row"><p><tt>BLOB(64000)</tt></p></td>
<td align="left" valign="top" scope="row"><p><tt>LONG RAW</tt></p></td>
<td align="left" valign="top" scope="row"><p><tt>BLOB(64000)</tt></p></td>
<td align="left" valign="top" scope="row"><p><tt>IMAGE</tt></p></td>
<td align="left" valign="top" scope="row"><p><tt>IMAGE</tt></p></td>
<td align="left" valign="top" scope="row"><p><tt>BLOB(64000)</tt></p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p><tt>char[]</tt>,
<tt>java.lang.Character[]</tt>, <tt>java.sql.Clob</tt></p></td>
<td align="left" valign="top" scope="row"><p><tt>CLOB(64000)</tt></p></td>
<td align="left" valign="top" scope="row"><p><tt>LONG</tt></p></td>
<td align="left" valign="top" scope="row"><p><tt>CLOB(64000)</tt></p></td>
<td align="left" valign="top" scope="row"><p><tt>TEXT</tt></p></td>
<td align="left" valign="top" scope="row"><p><tt>TEXT</tt></p></td>
<td align="left" valign="top" scope="row"><p><tt>TEXT(64000)</tt></p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p><tt>java.sql.Date</tt></p></td>
<td align="left" valign="top" scope="row"><p><tt>DATE</tt></p></td>
<td align="left" valign="top" scope="row"><p><tt>DATE</tt></p></td>
<td align="left" valign="top" scope="row"><p><tt>DATE</tt></p></td>
<td align="left" valign="top" scope="row"><p><tt>DATETIME</tt></p></td>
<td align="left" valign="top" scope="row"><p><tt>DATETIME</tt></p></td>
<td align="left" valign="top" scope="row"><p><tt>DATE</tt></p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p><tt>java.sql.Time</tt></p></td>
<td align="left" valign="top" scope="row"><p><tt>TIME</tt></p></td>
<td align="left" valign="top" scope="row"><p><tt>DATE</tt></p></td>
<td align="left" valign="top" scope="row"><p><tt>TIME</tt></p></td>
<td align="left" valign="top" scope="row"><p><tt>DATETIME</tt></p></td>
<td align="left" valign="top" scope="row"><p><tt>DATETIME</tt></p></td>
<td align="left" valign="top" scope="row"><p><tt>TIME</tt></p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p><tt>java.sql.Timestamp</tt></p></td>
<td align="left" valign="top" scope="row"><p><tt>TIMESTAMP</tt></p></td>
<td align="left" valign="top" scope="row"><p><tt>DATE</tt></p></td>
<td align="left" valign="top" scope="row"><p><tt>TIMESTAMP</tt></p></td>
<td align="left" valign="top" scope="row"><p><tt>DATETIME</tt></p></td>
<td align="left" valign="top" scope="row"><p><tt>DATETIME</tt></p></td>
<td align="left" valign="top" scope="row"><p><tt>DATETIME</tt></p></td>
</tr>
</table>

<a name="gbwmk"></a><h4>Generation Options</h4>
<a name="indexterm-409"></a><a name="indexterm-410"></a><a name="indexterm-411"></a><p>Schema generation properties or <tt>asadmin</tt> command line options can control automatic schema generation
by the following:</p>
<ul><li><p>Creating tables during deployment</p></li>
<li><p>Dropping tables during undeployment</p></li>
<li><p>Dropping and creating tables during redeployment</p></li>
<li><p>Generating the DDL files</p></li></ul>

<hr><p><b>Note - </b>Before using these options, make sure you have a properly configured database. See
<a href="#gbwmj">Specifying the Database</a>.</p>
<hr>
<p><a name="indexterm-412"></a>The following optional schema generation properties control the automatic creation of database tables at
deployment. You can specify them in the <tt>persistence.xml</tt> file.</p><a name="gbwlg"></a><h6>Table&#160;7-2 Schema Generation Properties</h6><table><col width="31%"><col width="14%"><col width="53%"><tr><th align="left" valign="top" scope="column"><p>Property</p></th>
<th align="left" valign="top" scope="column"><p>Default</p></th>
<th align="left" valign="top" scope="column"><p>Description</p></th>
</tr>
<tr><td align="left" valign="top" scope="row"><p><a name="indexterm-413"></a><tt>toplink.ddl-generation</tt></p></td>
<td align="left" valign="top" scope="row"><p><tt>none</tt></p></td>
<td align="left" valign="top" scope="row"><p>Specifies whether tables and DDL
files are created during deployment, and whether tables are dropped first if they
already exist. Allowed values are <tt>create-tables</tt>, <tt>drop-and-create-tables</tt>, and <tt>none</tt>.</p><p>If <tt>create-tables</tt> is specified, database
tables are created for entities that need them.</p><p>If <tt>drop-and-create-tables</tt> is specified, and if tables
were automatically created when this application was last deployed, tables from the earlier
deployment are dropped and fresh ones are created. If tables were <b>not</b> automatically created
when this application was last deployed, no attempt is made to drop any
tables. If tables with the same names as those that would have been
automatically created are found, the deployment proceeds, but a warning is thrown to
indicate that tables could not be created.</p><p>If <tt>none</tt> is specified, no tables
are created or dropped.</p><p>The <tt>asadmin</tt> generation options listed in <a href="#gbwlr">Table&#160;7-3</a> and <a href="#gbwmm">Table&#160;7-4</a> override
the value of this property.</p><p>If you are using persistence outside the EJB
container and would like to create the DDL files without creating tables, additionally define
a Java system property <tt>INTERACT_WITH_DB</tt> and set its value to <tt>false</tt>.</p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p><a name="indexterm-414"></a><tt>toplink.create-ddl-jdbc-file-name</tt></p></td>
<td align="left" valign="top" scope="row"><p><tt>createDDL.jdbc</tt></p></td>
<td align="left" valign="top" scope="row"><p>Specifies the name
of the JDBC file that contains the DDL statements required to create the
required objects (tables, sequences, and constraints) in the database.</p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p><a name="indexterm-415"></a><tt>toplink.drop-ddl-jdbc-file-name</tt></p></td>
<td align="left" valign="top" scope="row"><p><tt>dropDDL.jdbc</tt></p></td>
<td align="left" valign="top" scope="row"><p>Specifies the name of the
JDBC file that contains the DDL statements required to drop the required objects
(tables, sequences, and constraints) from the database.</p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p><a name="indexterm-416"></a><tt>toplink.application-location</tt></p></td>
<td align="left" valign="top" scope="row"><p><tt>.</tt> for the current working directory</p></td>
<td align="left" valign="top" scope="row"><p>Specifies the
location where the DDL files are written.</p><p>For persistence within the EJB container,
if this property is not set, DDL files are written to one of
the following locations, for applications and modules, respectively:</p><p><i>domain-dir</i><tt>/generated/ejb/j2ee-apps/</tt><i>app-name</i></p><p><i>domain-dir</i><tt>/generated/ejb/j2ee-modules/</tt><i>mod-name</i></p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p><a name="indexterm-417"></a><tt>toplink.ddl-generation.output-mode</tt></p></td>
<td align="left" valign="top" scope="row"><p><tt>both</tt></p></td>
<td align="left" valign="top" scope="row"><p>Specifies the DDL generation target if
you are in Java SE mode, outside the EJB container. Values are as
follows:</p>
<ul><li><p><tt>both</tt> &#8211; Generates SQL files and executes them on the database. If <tt>toplink.ddl-generation</tt> is set to <tt>create-tables</tt>, then <tt>toplink.create-ddl-jdbc-file-name</tt> is written to <tt>toplink.application-location</tt> and executed on the database. If <tt>toplink.ddl-generation</tt> is set to <tt>drop-and-create-tables</tt>, then both <tt>toplink.create-ddl-jdbc-file-name</tt> and <tt>toplink.drop-ddl-jdbc-file-name</tt> are written to <tt>toplink.application-location</tt> and both SQL files are executed on the database.</p></li>
<li><p><tt>database</tt> &#8211; Executes SQL on the database only (does not generate SQL files). If <tt>toplink.ddl-generation</tt> is set to <tt>create-tables</tt>, then <tt>toplink.create-ddl-jdbc-file-name</tt> is executed on the database. It is not written to <tt>toplink.application-location</tt>. If <tt>toplink.ddl-generation</tt> is set to <tt>drop-and-create-tables</tt>, then both <tt>toplink.create-ddl-jdbc-file-name</tt> and <tt>toplink.drop-ddl-jdbc-file-name</tt> are executed on the database. Neither is written to <tt>toplink.application-location</tt>.</p></li>
<li><p><tt>sql-script</tt> &#8211; Generates SQL files only (does not execute them on the database). If <tt>toplink.ddl-generation</tt> is set to <tt>create-tables</tt>, then <tt>toplink.create-ddl-jdbc-file-name</tt> is written to <tt>toplink.application-location</tt>. It is not executed on the database. If <tt>toplink.ddl-generation</tt> is set to <tt>drop-and-create-tables</tt>, then both <tt>toplink.create-ddl-jdbc-file-name</tt> and <tt>toplink.drop-ddl-jdbc-file-name</tt> are written to <tt>toplink.application-location</tt>. Neither is executed on the database.</p></li></ul>
</td>
</tr>
</table><p><a name="indexterm-418"></a><a name="indexterm-419"></a><a name="indexterm-420"></a><a name="indexterm-421"></a>The following options of the <tt>asadmin deploy</tt> or <tt>asadmin deploydir</tt> command control the automatic creation
of database tables at deployment.</p><a name="gbwlr"></a><h6>Table&#160;7-3 The <tt>asadmin deploy</tt> and <tt>asadmin deploydir</tt> Generation Options</h6><table><col width="28%"><col width="7%"><col width="63%"><tr><th align="left" valign="top" scope="column"><p>Option</p></th>
<th align="left" valign="top" scope="column"><p>Default</p></th>
<th align="left" valign="top" scope="column"><p>Description</p></th>
</tr>
<tr><td align="left" valign="top" scope="row"><p><tt>--createtables</tt></p></td>
<td align="left" valign="top" scope="row"><p>none</p></td>
<td align="left" valign="top" scope="row"><p>If <tt>true</tt>, causes database tables to be created for entities
that need them. If <tt>false</tt>, does not create tables. If not specified, the
value of the <tt>toplink.ddl-generation</tt> property in <tt>persistence.xml</tt> is used.</p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p><tt>--dropandcreatetables</tt></p></td>
<td align="left" valign="top" scope="row"><p>none</p></td>
<td align="left" valign="top" scope="row"><p>If <tt>true</tt>, and if
tables were automatically created when this application was last deployed, tables from the
earlier deployment are dropped and fresh ones are created.</p><p>If <tt>true</tt>, and if tables
were <b>not</b> automatically created when this application was last deployed, no attempt is
made to drop any tables. If tables with the same names as those
that would have been automatically created are found, the deployment proceeds, but a warning
is thrown to indicate that tables could not be created.</p><p>If <tt>false</tt>, the
<tt>toplink.ddl-generation</tt> property setting in <tt>persistence.xml</tt> is overridden.</p></td>
</tr>
</table><p><a name="indexterm-422"></a><a name="indexterm-423"></a>The following options of the <tt>asadmin undeploy</tt> command control the automatic removal of database tables
at undeployment.</p><a name="gbwmm"></a><h6>Table&#160;7-4 The <tt>asadmin undeploy</tt> Generation Options</h6><table><col width="17%"><col width="8%"><col width="73%"><tr><th align="left" valign="top" scope="column"><p>Option</p></th>
<th align="left" valign="top" scope="column"><p>Default</p></th>
<th align="left" valign="top" scope="column"><p>Description</p></th>
</tr>
<tr><td align="left" valign="top" scope="row"><p><tt>--droptables</tt></p></td>
<td align="left" valign="top" scope="row"><p>none</p></td>
<td align="left" valign="top" scope="row"><p>If <tt>true</tt>, causes database tables that were automatically created when the entities
were last deployed to be dropped when the entities are undeployed. If <tt>false</tt>,
does not drop tables.</p><p>If not specified, tables are dropped only if the <tt>toplink.ddl-generation</tt>
property setting in <tt>persistence.xml</tt> is <tt>drop-and-create-tables</tt>.</p></td>
</tr>
</table><p>For more information about the <tt>asadmin deploy</tt>, <tt>asadmin deploydir</tt>, and <tt>asadmin undeploy</tt> commands, see the <a href="http://docs.sun.com/doc/820-4332"><i>Sun GlassFish Enterprise Server 2.1 Reference Manual</i></a>.</p><p>When <tt>asadmin</tt> deployment options and <tt>persistence.xml</tt> options are both specified, the <tt>asadmin</tt>
deployment options take precedence.</p><p>The <tt>asant</tt> tasks <tt>sun-appserv-deploy</tt> and <tt>sun-appserv-undeploy</tt> are equivalent to <tt>asadmin deploy</tt> and <tt>asadmin undeploy</tt>,
respectively. These <tt>asant</tt> tasks also override the <tt>persistence.xml</tt> options. For details, see <a href="p7.html">Chapter&#160;3, The <tt>asant</tt> Utility</a>.</p>

<a name="gbzgp"></a><h3>Query Hints</h3>
<a name="indexterm-424"></a><p>Query hints are additional, implementation-specific configuration settings. You can use hints in your
queries in the following format:</p><pre>setHint("<i>hint-name</i>", <i>hint-value</i>)</pre><p>For example:</p><pre>Customer customer = (Customer)entityMgr.
     createNamedQuery("findCustomerBySSN").
     setParameter("SSN", "123-12-1234").
     setHint("toplink.refresh", true).
     getSingleResult();</pre><p>For more information about the query hints available with the default provider, see
<i>Query Hints</i> in <a href="http://www.oracle.com/technology/products/ias/toplink/jpa/essentials/toplink-jpa-extensions.html">TopLink JPA Extensions Reference</a>.</p>

<a name="gdkwf"></a><h3>Changing the Persistence Provider</h3>
<a name="indexterm-425"></a>
<hr><p><b>Note - </b>The previous sections in this chapter apply only to the default persistence provider.
If you change the provider for a module or application, the provider-specific database
properties, query hints, and schema generation features described in this chapter do not
apply.</p><p>The <tt>verifier</tt> utility always uses the default provider to verify persistence settings. For
information about the <tt>verifier</tt> utility, see <a href="http://docs.sun.com/doc/820-4337/beadq?a=view">The verifier Utility in <i>Sun GlassFish Enterprise Server 2.1 Application Deployment Guide</i></a>.</p>
<hr>
<p>You can change the persistence provider for an application in the manner described
in the Java Persistence API Specification.</p><p>First, install the provider. Copy the provider JAR files to the <i>domain-dir</i><tt>/lib</tt> directory,
and restart the Enterprise Server. For more information about the <i>domain-dir</i><tt>/lib</tt> directory, see <a href="p6.html#beadj">Using the Common Class Loader</a>. The
new persistence provider is now available to all modules and applications deployed on
servers that share the same configuration. However, the <b>default</b> provider remains the
same.</p><p>In your persistence unit, specify the provider and any properties the provider requires
in the <tt>persistence.xml</tt> file. For example:</p><pre>&#60;?xml version="1.0" encoding="UTF-8"?>
    &#60;persistence xmlns="http://java.sun.com/xml/ns/persistence">
        &#60;persistence-unit name ="em3">
            &#60;provider>com.company22.persistence.PersistenceProviderImpl&#60;/provider>
            &#60;properties>
                &#60;property name="company22.database.name" value="MyDB"/>
            &#60;/properties>
        &#60;/persistence-unit>
    &#60;/persistence></pre>

<a name="gbxjh"></a><h3>Restrictions and Optimizations</h3>
<a name="indexterm-426"></a><p>This section discusses restrictions and performance optimizations that affect using the Java Persistence
API.</p>
<ul><li><p><a href="#ghdtr">Extended Persistence Context Failover</a></p></li>
<li><p><a href="#gezxw">Using @OrderBy with a Shared Session Cache</a></p></li>
<li><p><a href="#gdwqi">Using BLOB or CLOB Types with the Inet Oraxo JDBC Driver</a></p></li>
<li><p><a href="#geqvh">Database Case Sensitivity</a></p></li>
<li><p><a href="#gbxjg">Sybase Finder Limitation</a></p></li>
<li><p><a href="#gbxjp">MySQL Database Restrictions</a></p></li></ul>


<a name="ghdtr"></a><h4>Extended Persistence Context Failover</h4>
<p>A reference to an extended persistence context in a stateful session bean or
an <tt>HttpSession</tt> may not fail over successfully.</p><p>The Java Persistence API specification is not clear how the container and persistence
provider should work together to passivate a stateful session bean with an extended
persistence context in a stand-alone server instance. This also prevents successful serialization and storage
of a reference to an extended persistence context in an <tt>HttpSession</tt>.</p><p>Even in a single-instance environment, if a stateful session bean is passivated, its
extended persistence context could be lost when the stateful session bean is activated.
In this environment, it is safe to store an extended persistence context in
a stateful session bean only if you can safely disable stateful session bean passivation
altogether. This is possible, but trade-offs in memory utilization must be carefully examined
before choosing this option.</p><p>In a single-instance environment, it is safe to store a reference to an
extended persistence context in an <tt>HttpSession</tt>.</p>

<a name="gezxw"></a><h4>Using @OrderBy with a Shared Session Cache</h4>
<a name="indexterm-427"></a><a name="indexterm-428"></a><a name="indexterm-429"></a><p>Setting <tt>@OrderBy</tt> on a <tt>ManyToMany</tt> or <tt>OneToMany</tt> relationship field in which a
<tt>List</tt> represents the Many side doesn't work if the session cache is shared.
Use one of the following workarounds:</p>
<ul><li><p>Have the application maintain the order so the <tt>List</tt> is cached properly.</p></li>
<li><p>Refresh the session cache using <tt>EntityManager.refresh()</tt> if you don't want to maintain the order during creation or modification of the <tt>List</tt>.</p></li>
<li><p>Disable session cache sharing in <tt>persistence.xml</tt> as follows:</p><pre>&#60;property name="toplink.cache.shared.default" value="false"/></pre></li></ul>


<a name="gdwqi"></a><h4>Using BLOB or CLOB Types with the Inet Oraxo JDBC Driver</h4>
<p><a name="indexterm-430"></a><a name="indexterm-431"></a>To use BLOB or CLOB data types larger than 4 KB for persistence
using the Inet Oraxo JDBC Driver for Oracle Databases, you must set the
database's <tt>streamstolob</tt> property value to <tt>true</tt>.</p>

<a name="geqvh"></a><h4>Database Case Sensitivity</h4>
<p>Mapping references to column or table names must be in accordance with the
expected column or table name case, and ensuring this is the programmer's responsibility.
If column or table names are not explicitly specified for a field or
entity, the Enterprise Server uses upper case column names by default, so any
mapping references to the column or table names must be in upper case.
If column or table names are explicitly specified, the case of all mapping
references to the column or table names must be in accordance with the
case used in the specified names.</p><p>The following are examples of how case sensitivity affects mapping elements that refer
to columns or tables. Programmers must keep case sensitivity in mind when writing
these mappings.</p>

<a name="geqvc"></a><h5>Unique Constraints</h5>
<p>If column names are not explicitly specified on a field, unique constraints and
foreign key mappings must be specified using uppercase references. For example:</p><pre>@Table(name="Department", uniqueConstraints={ @UniqueConstraint ( columnNames= { "DEPTNAME" } ) } )</pre><p>The other way to handle this is by specifying explicit column names for
each field with the required case. For example:</p><pre>@Table(name="Department", uniqueConstraints={ @UniqueConstraint ( columnNames= { "deptName" } ) } )
public class Department{ @Column(name="deptName") private String deptName; }</pre><p>Otherwise, the <tt>ALTER TABLE</tt> statement generated by the Enterprise Server uses the incorrect case,
and the creation of the unique constraint fails.</p>

<a name="geqvk"></a><h5>Foreign Key Mapping</h5>
<p>Use <tt>@OneToMany(mappedBy="COMPANY")</tt> or specify an explicit column name for the <tt>Company</tt> field on the
<tt>Many</tt> side of the relationship.</p>

<a name="geqvi"></a><h5>SQL Result Set Mapping</h5>
<p>Use the following elements:</p><pre>&#60;sql-result-set-mapping name="SRSMName" >
   &#60;entity-result entity-class="entities.someEntity" />
   &#60;column-result name="UPPERCASECOLUMNNAME" />
&#60;/sql-result-set-mapping></pre><p>Or specify an explicit column name for the <tt>upperCaseColumnName</tt> field.</p>

<a name="geqvo"></a><h5>Named Native Queries and JDBC Queries</h5>
<p>Column or table names specified in SQL queries must be in accordance with
the expected case. For example, MySQL requires column names in the <tt>SELECT</tt> clause
of JDBC queries to be uppercase, while PostgreSQL and Sybase require table names
to be uppercase in all JDBC queries.</p>

<a name="geqxc"></a><h5>PostgreSQL Case Sensitivity</h5>
<p>PostgreSQL stores column and table names in lower case. JDBC queries on PostgreSQL
retrieve column or table names in lowercase unless the names are quoted. For
example:</p><pre>use aliases Select m.ID AS \"ID\" from Department m</pre><p>Use the backslash as an escape character in the class file, but not
in the <tt>persistence.xml</tt> file.</p>

<a name="gbxjg"></a><h4>Sybase Finder Limitation</h4>
<a name="indexterm-432"></a><a name="indexterm-433"></a><p>If a finder method with an input greater than 255 characters is executed
and the primary key column is mapped to a VARCHAR column, Sybase attempts
to convert type VARCHAR to type TEXT and generates the following error:</p><pre>com.sybase.jdbc2.jdbc.SybSQLException: Implicit conversion from datatype 
'TEXT' to 'VARCHAR' is not allowed.  Use the CONVERT function to run this 
query.</pre><p>To avoid this error, make sure the finder method input is less than
255 characters.</p>

<a name="gbxjp"></a><h4>MySQL Database Restrictions</h4>
<a name="indexterm-434"></a><p>The following restrictions apply when you use a MySQL database with the Enterprise
Server for persistence.</p>
<ul><li><p>MySQL treats <tt>int1</tt> and <tt>int2</tt> as reserved words. If you want to define <tt>int1</tt> and <tt>int2</tt> as fields in your table, use <tt>`int1`</tt> and <tt>`int2`</tt> field names in your SQL file. </p></li>
<li><p>When <tt>VARCHAR</tt> fields get truncated, a warning is displayed instead of an error. To get an error message, start the MySQL database in strict SQL mode. </p></li>
<li><p>The order of fields in a foreign key index must match the order in the explicitly created index on the primary table.</p></li>
<li><p>The <tt>CREATE TABLE</tt> syntax in the SQL file must end with the following line.</p><pre>)  Engine=InnoDB;</pre><p><tt>InnoDB</tt> provides MySQL with a transaction-safe (ACID compliant) storage engine having commit, rollback, and crash recovery capabilities.</p></li>
<li><p>For a <tt>FLOAT</tt> type field, the correct precision must be defined. By default, MySQL uses four bytes to store a <tt>FLOAT</tt> type that does not have an explicit precision definition. For example, this causes a number such as 12345.67890123 to be rounded off to 12345.7 during an <tt>INSERT</tt>. To prevent this, specify <tt>FLOAT(10,2)</tt> in the DDL file, which forces the database to use an eight-byte double-precision column. For more information, see <a href="http://dev.mysql.com/doc/mysql/en/numeric-types.html">http://dev.mysql.com/doc/mysql/en/numeric-types.html</a>.</p></li>
<li><p>To use <tt>||</tt> as the string concatenation symbol, start the MySQL server with the <tt>--sql-mode="PIPES_AS_CONCAT"</tt> option. For more information, see <a href="http://dev.mysql.com/doc/refman/5.0/en/server-sql-mode.html">http://dev.mysql.com/doc/refman/5.0/en/server-sql-mode.html</a> and <a href="http://dev.mysql.com/doc/mysql/en/ansi-mode.html">http://dev.mysql.com/doc/mysql/en/ansi-mode.html</a>.</p></li>
<li><p>MySQL always starts a new connection when <tt>autoCommit==true</tt> is set. This ensures that each SQL statement forms a single transaction on its own. If you try to rollback or commit an SQL statement, you get an error message.</p><pre>javax.transaction.SystemException: java.sql.SQLException: 
Can't call rollback when autocommit=true</pre><pre>javax.transaction.SystemException: java.sql.SQLException: 
Error open transaction is not closed</pre><p>To resolve this issue, add <tt>relaxAutoCommit=true</tt> to the JDBC URL. For more information, see <a href="http://forums.mysql.com/read.php?39,31326,31404">http://forums.mysql.com/read.php?39,31326,31404</a>.</p></li>
<li><p>MySQL does not allow a <tt>DELETE</tt> on a row that contains a reference to itself. Here is an example that illustrates the issue.</p><pre>create table EMPLOYEE (
        empId   int         NOT NULL,
        salary  float(25,2) NULL,
        mgrId   int         NULL,
        PRIMARY KEY (empId),
        FOREIGN KEY (mgrId) REFERENCES EMPLOYEE (empId)
        ) ENGINE=InnoDB;

        insert into Employee values (1, 1234.34, 1);
        delete from Employee where empId = 1;</pre><p>This example fails with the following error message.</p><pre>ERROR 1217 (23000): Cannot delete or update a parent row: 
a foreign key constraint fails</pre><p>To resolve this issue, change the table creation script to the following:</p><pre>create table EMPLOYEE (
        empId   int         NOT NULL,
        salary  float(25,2) NULL,
        mgrId   int         NULL,
        PRIMARY KEY (empId),
        FOREIGN KEY (mgrId) REFERENCES EMPLOYEE (empId)
        ON DELETE SET NULL
        ) ENGINE=InnoDB;

        insert into Employee values (1, 1234.34, 1);
        delete from Employee where empId = 1;</pre><p>This can be done only if the foreign key field is allowed to be null. For more information, see <a href="http://bugs.mysql.com/bug.php?id=12449">http://bugs.mysql.com/bug.php?id=12449</a> and <a href="http://dev.mysql.com/doc/mysql/en/innodb-foreign-key-constraints.html">http://dev.mysql.com/doc/mysql/en/innodb-foreign-key-constraints.html</a>.</p></li></ul>



<table border="0" cellpadding="5" cellspacing="0" width="100%">
<tr valign="bottom">
<td></td>
<td style="width: 60%"></td>
<td><a href="p11.html">Previous</a></td>
<td></td>
<td><a href="idx-1.html">Index</a></td>
<td><a href="p13.html">Next</a></td>
</tr>
</table>



</body>
</html>

